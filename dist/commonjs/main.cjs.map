{
  "version": 3,
  "file": "main.cjs",
  "sources": [
    "../../src/internal/compositionMappingToComposeStrict.js",
    "../../src/internal/compositionMappingToCompose.js",
    "../../src/internal/composeResponseHeaders.js",
    "../../src/composeResponse.js",
    "../../src/convertFileSystemErrorToResponseProperties.js",
    "../../src/internal/observable.js",
    "../../src/createSSERoom.js",
    "../../node_modules/@jsenv/core/src/internal/import-meta/import-meta-url-commonjs.js",
    "../../src/internal/applyContentNegotiation.js",
    "../../src/internal/multiple-header.js",
    "../../src/negotiateContentType.js",
    "../../src/serverTiming.js",
    "../../src/jsenvContentTypeMap.js",
    "../../src/urlToContentType.js",
    "../../src/negotiateContentEncoding.js",
    "../../src/serveFile.js",
    "../../src/fetchUrl.js",
    "../../src/internal/listen.js",
    "../../src/findFreePort.js",
    "../../src/headersToObject.js",
    "../../src/service-composition.js",
    "../../src/jsenvAccessControlAllowedHeaders.js",
    "../../src/jsenvAccessControlAllowedMethods.js",
    "../../src/jsenvServerInternalErrorToResponse.js",
    "../../src/jsenvSignature.js",
    "../../src/negotiateContentLanguage.js",
    "../../src/urlToSearchParamValue.js",
    "../../src/readRequestBody.js",
    "../../src/internal/createTracker.js",
    "../../src/internal/createServer.js",
    "../../src/internal/trackServerPendingConnections.js",
    "../../src/internal/trackServerPendingRequests.js",
    "../../src/internal/nodeStreamToObservable.js",
    "../../src/internal/normalizeHeaderName.js",
    "../../src/internal/normalizeHeaderValue.js",
    "../../src/internal/headersFromObject.js",
    "../../src/internal/nodeRequestToRequest.js",
    "../../src/internal/valueToObservable.js",
    "../../src/internal/populateNodeResponse.js",
    "../../src/internal/colorizeResponseStatus.js",
    "../../src/internal/getServerOrigins.js",
    "../../src/stopReasons.js",
    "../../src/internal/trackServerRequest.js",
    "../../src/internal/checkContentNegotiation.js",
    "../../src/startServer.js"
  ],
  "sourcesContent": [
    "export const compositionMappingToComposeStrict = (\n  compositionMapping,\n  createInitial = () => ({}),\n) => {\n  const reducer = compositionMappingToStrictReducer(compositionMapping)\n  return (...objects) => objects.reduce(reducer, createInitial())\n}\n\nconst compositionMappingToStrictReducer = (compositionMapping) => {\n  const propertyComposeStrict = (key, previous, current) => {\n    const propertyExistInCurrent = key in current\n    if (!propertyExistInCurrent) return previous[key]\n\n    const propertyExistInPrevious = key in previous\n    if (!propertyExistInPrevious) return current[key]\n\n    const composeProperty = compositionMapping[key]\n    return composeProperty(previous[key], current[key])\n  }\n\n  return (previous, current) => {\n    if (typeof current !== \"object\" || current === null) return previous\n\n    const composed = {}\n    Object.keys(compositionMapping).forEach((key) => {\n      composed[key] = propertyComposeStrict(key, previous, current)\n    })\n    return composed\n  }\n}\n",
    "export const compositionMappingToCompose = (\n  compositionMapping,\n  createInitial = () => {\n    return {}\n  },\n  { lowercase = false } = {},\n) => {\n  const reducer = compositionMappingToReducer(compositionMapping, { lowercase })\n  return (...objects) => objects.reduce(reducer, createInitial())\n}\n\nconst compositionMappingToReducer = (compositionMapping, { lowercase }) => {\n  const composeProperty = (key, previous, current) => {\n    const propertyExistInCurrent = key in current\n    if (!propertyExistInCurrent) return previous[key]\n\n    const propertyExistInPrevious = key in previous\n    if (!propertyExistInPrevious) return current[key]\n\n    const propertyHasComposer = key in compositionMapping\n    if (!propertyHasComposer) return current[key]\n\n    const composerForProperty = compositionMapping[key]\n    return composerForProperty(previous[key], current[key])\n  }\n\n  return (previous, current) => {\n    if (typeof current !== \"object\" || current === null) return previous\n\n    const composed = {}\n    Object.keys(previous).forEach((key) => {\n      if (lowercase) key = key.toLowerCase()\n      composed[key] = previous[key]\n    })\n    Object.keys(current).forEach((key) => {\n      if (lowercase) key = key.toLowerCase()\n      composed[key] = composeProperty(key, previous, current)\n    })\n    return composed\n  }\n}\n",
    "import { compositionMappingToCompose } from \"./compositionMappingToCompose.js\"\n\nconst composeHeaderValues = (value, nextValue) => {\n  const headerValues = value.split(\", \")\n  nextValue.split(\", \").forEach((value) => {\n    if (!headerValues.includes(value)) {\n      headerValues.push(value)\n    }\n  })\n  return headerValues.join(\", \")\n}\n\nconst headerCompositionMapping = {\n  \"accept\": composeHeaderValues,\n  \"accept-charset\": composeHeaderValues,\n  \"accept-language\": composeHeaderValues,\n  \"access-control-allow-headers\": composeHeaderValues,\n  \"access-control-allow-methods\": composeHeaderValues,\n  \"access-control-allow-origin\": composeHeaderValues,\n  // https://www.w3.org/TR/server-timing/\n  // https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Server-Timing\n  \"server-timing\": composeHeaderValues,\n  // 'content-type', // https://github.com/ninenines/cowboy/issues/1230\n  \"vary\": composeHeaderValues,\n}\n\nexport const composeResponseHeaders = compositionMappingToCompose(\n  headerCompositionMapping,\n  () => ({}),\n  { lowercase: true },\n)\n",
    "import { compositionMappingToComposeStrict } from \"./internal/compositionMappingToComposeStrict.js\"\nimport { composeResponseHeaders } from \"./internal/composeResponseHeaders.js\"\n\nconst responseCompositionMapping = {\n  status: (prevStatus, status) => status,\n  statusText: (prevStatusText, statusText) => statusText,\n  headers: composeResponseHeaders,\n  body: (prevBody, body) => body,\n  bodyEncoding: (prevEncoding, encoding) => encoding,\n  timing: (prevTiming, timing) => {\n    return { ...prevTiming, ...timing }\n  },\n}\n\nexport const composeResponse = compositionMappingToComposeStrict(responseCompositionMapping)\n",
    "export const convertFileSystemErrorToResponseProperties = (error) => {\n  // https://iojs.org/api/errors.html#errors_eacces_permission_denied\n  if (isErrorWithCode(error, \"EACCES\")) {\n    return {\n      status: 403,\n      statusText: `EACCES: No permission to read file at ${error.path}`,\n    }\n  }\n\n  if (isErrorWithCode(error, \"EPERM\")) {\n    return {\n      status: 403,\n      statusText: `EPERM: No permission to read file at ${error.path}`,\n    }\n  }\n\n  if (isErrorWithCode(error, \"ENOENT\")) {\n    return {\n      status: 404,\n      statusText: `ENOENT: File not found at ${error.path}`,\n    }\n  }\n\n  // file access may be temporarily blocked\n  // (by an antivirus scanning it because recently modified for instance)\n  if (isErrorWithCode(error, \"EBUSY\")) {\n    return {\n      status: 503,\n      statusText: `EBUSY: File is busy ${error.path}`,\n      headers: {\n        \"retry-after\": 0.01, // retry in 10ms\n      },\n    }\n  }\n\n  // emfile means there is too many files currently opened\n  if (isErrorWithCode(error, \"EMFILE\")) {\n    return {\n      status: 503,\n      statusText: \"EMFILE: too many file opened\",\n      headers: {\n        \"retry-after\": 0.1, // retry in 100ms\n      },\n    }\n  }\n\n  if (isErrorWithCode(error, \"EISDIR\")) {\n    return {\n      status: 500,\n      statusText: `EISDIR: Unexpected directory operation at ${error.path}`,\n    }\n  }\n\n  return Promise.reject(error)\n}\n\nconst isErrorWithCode = (error, code) => {\n  return typeof error === \"object\" && error.code === code\n}\n",
    "if (\"observable\" in Symbol === false) {\n  Symbol.observable = Symbol.for(\"observable\")\n}\n\nexport const createObservable = ({ subscribe }) => {\n  const observable = {\n    [Symbol.observable]: () => observable,\n    subscribe,\n  }\n  return observable\n}\n\nexport const subscribe = (\n  observable,\n  {\n    next = () => {},\n    error = (value) => {\n      throw value\n    },\n    complete = () => {},\n  },\n) => {\n  const { subscribe } = observable[Symbol.observable]()\n  const subscription = subscribe({\n    next,\n    error,\n    complete,\n  })\n  return subscription || { unsubscribe: () => {} }\n}\n\nexport const isObservable = (value) => {\n  if (value === null) return false\n  if (value === undefined) return false\n  if (typeof value === \"object\") return Symbol.observable in value\n  if (typeof value === \"function\") return Symbol.observable in value\n  return false\n}\n",
    "import { createLogger } from \"@jsenv/logger\"\nimport { createObservable } from \"./internal/observable.js\"\n\n// https://www.html5rocks.com/en/tutorials/eventsource/basics/\nexport const createSSERoom = ({\n  logLevel,\n  // do not keep process alive because of rooms, something else must keep it alive\n  keepProcessAlive = false,\n  keepaliveDuration = 30 * 1000,\n  retryDuration = 1 * 1000,\n  historyLength = 1 * 1000,\n  maxConnectionAllowed = 100, // max 100 users accepted\n  computeEventId = (event, lastEventId) => lastEventId + 1,\n  welcomeEvent = false,\n  welcomeEventPublic = false,\n} = {}) => {\n  const logger = createLogger({ logLevel })\n\n  const connections = new Set()\n  const eventHistory = createEventHistory(historyLength)\n  // what about previousEventId that keeps growing ?\n  // we could add some limit\n  // one limit could be that an event older than 24h is deleted\n  let previousEventId = 0\n  let state = \"closed\"\n  let interval\n\n  const eventsSince = (id) => {\n    const events = eventHistory.since(id)\n    if (welcomeEvent && !welcomeEventPublic) {\n      return events.filter((event) => event.type !== \"welcome\")\n    }\n    return events\n  }\n\n  const connect = (lastKnownId) => {\n    if (connections.size >= maxConnectionAllowed) {\n      return {\n        status: 503,\n      }\n    }\n    if (state === \"closed\") {\n      return {\n        status: 204,\n      }\n    }\n\n    const firstEvent = {\n      retry: retryDuration,\n      type: welcomeEvent ? \"welcome\" : \"comment\",\n      data: new Date().toLocaleTimeString(),\n    }\n\n    if (welcomeEvent) {\n      firstEvent.id = computeEventId(firstEvent, previousEventId)\n      previousEventId = firstEvent.id\n      eventHistory.add(firstEvent)\n    }\n\n    const events = [\n      // send events which occured between lastKnownId & now\n      ...(lastKnownId === undefined ? [] : eventsSince(lastKnownId)),\n      firstEvent,\n    ]\n\n    const body = createObservable({\n      subscribe: ({ next }) => {\n        events.forEach((event) => {\n          logger.debug(`send ${event.type} event to this new client`)\n          next(stringifySourceEvent(event))\n        })\n\n        const connection = {\n          write: next,\n        }\n\n        const unsubscribe = () => {\n          if (connections.has(connection)) {\n            connections.delete(connection)\n            logger.debug(\n              `connection closed by us, number of client connected to event source: ${connections.size}`,\n            )\n          }\n        }\n\n        connection.unsubscribe = unsubscribe\n        connections.add(connection)\n\n        return {\n          unsubscribe,\n        }\n      },\n    })\n\n    logger.debug(\n      `client joined, number of client connected to event source: ${connections.size}, max allowed: ${maxConnectionAllowed}`,\n    )\n\n    return {\n      status: 200,\n      headers: {\n        \"content-type\": \"text/event-stream\",\n        \"cache-control\": \"no-store\",\n        \"connection\": \"keep-alive\",\n      },\n      body,\n    }\n  }\n\n  const write = (data) => {\n    connections.forEach((connection) => {\n      connection.write(data)\n    })\n  }\n\n  const sendEvent = (event) => {\n    if (event.type !== \"comment\") {\n      logger.debug(\n        `send ${event.type} event, number of client listening event source: ${connections.size}`,\n      )\n      if (typeof event.id === \"undefined\") {\n        event.id = computeEventId(event, previousEventId)\n      }\n      previousEventId = event.id\n      eventHistory.add(event)\n    }\n\n    write(stringifySourceEvent(event))\n  }\n\n  const keepAlive = () => {\n    // maybe that, when an event occurs, we can delay the keep alive event\n    logger.debug(\n      `send keep alive event, number of client listening event source: ${connections.size}`,\n    )\n    sendEvent({\n      type: \"comment\",\n      data: new Date().toLocaleTimeString(),\n    })\n  }\n\n  const start = () => {\n    state = \"started\"\n    interval = setInterval(keepAlive, keepaliveDuration)\n    if (!keepProcessAlive) {\n      interval.unref()\n    }\n  }\n\n  const stop = () => {\n    logger.debug(`stopping, number of client to close: ${connections.size}`)\n    connections.forEach((connection) => connection.unsubscribe())\n    clearInterval(interval)\n    eventHistory.reset()\n    state = \"stopped\"\n  }\n\n  return {\n    start,\n    stop,\n    connect,\n    eventsSince,\n    sendEvent,\n\n    clientCountGetter: () => connections.size,\n  }\n}\n\n// https://github.com/dmail-old/project/commit/da7d2c88fc8273850812972885d030a22f9d7448\n// https://github.com/dmail-old/project/commit/98b3ae6748d461ac4bd9c48944a551b1128f4459\n\n// https://github.com/dmail-old/http-eventsource/blob/master/lib/event-source.js\n\n// http://html5doctor.com/server-sent-events/\nconst stringifySourceEvent = ({ data, type = \"message\", id, retry }) => {\n  let string = \"\"\n\n  if (id !== undefined) {\n    string += `id:${id}\\n`\n  }\n\n  if (retry) {\n    string += `retry:${retry}\\n`\n  }\n\n  if (type !== \"message\") {\n    string += `event:${type}\\n`\n  }\n\n  string += `data:${data}\\n\\n`\n\n  return string\n}\n\nconst createEventHistory = (limit) => {\n  const events = []\n\n  const add = (data) => {\n    events.push(data)\n\n    if (events.length >= limit) {\n      events.shift()\n    }\n  }\n\n  const since = (id) => {\n    const index = events.findIndex((event) => String(event.id) === id)\n    return index === -1 ? [] : events.slice(index + 1)\n  }\n\n  const reset = () => {\n    events.length = 0\n  }\n\n  return { add, since, reset }\n}\n",
    "/* global __filename */\n\nconst filenameContainsBackSlashes = __filename.indexOf(\"\\\\\") > -1\n\nconst url = filenameContainsBackSlashes\n  ? `file:///${__filename.replace(/\\\\/g, \"/\")}`\n  : `file://${__filename}`\n\nexport default url\n",
    "export const applyContentNegotiation = ({ availables, accepteds, getAcceptanceScore }) => {\n  let highestScore = -1\n  let availableWithHighestScore = null\n\n  let availableIndex = 0\n  while (availableIndex < availables.length) {\n    const available = availables[availableIndex]\n    availableIndex++\n\n    let acceptedIndex = 0\n    while (acceptedIndex < accepteds.length) {\n      const accepted = accepteds[acceptedIndex]\n      acceptedIndex++\n\n      const score = getAcceptanceScore(accepted, available)\n      if (score > highestScore) {\n        availableWithHighestScore = available\n        highestScore = score\n      }\n    }\n  }\n\n  return availableWithHighestScore\n}\n",
    "/**\n\n A multiple header is a header with multiple values like\n\n \"text/plain, application/json;q=0.1\"\n\n Each, means it's a new value (it's optionally followed by a space)\n\n Each; mean it's a property followed by =\n if \"\" is a string\n if not it's likely a number\n */\n\nexport const parseMultipleHeader = (\n  multipleHeaderString,\n  { validateName = () => true, validateProperty = () => true } = {},\n) => {\n  const values = multipleHeaderString.split(\",\")\n  const multipleHeader = {}\n  values.forEach((value) => {\n    const valueTrimmed = value.trim()\n    const valueParts = valueTrimmed.split(\";\")\n    const name = valueParts[0]\n    const nameValidation = validateName(name)\n    if (!nameValidation) {\n      return\n    }\n\n    const properties = parseHeaderProperties(valueParts.slice(1), { validateProperty })\n    multipleHeader[name] = properties\n  })\n  return multipleHeader\n}\n\nconst parseHeaderProperties = (headerProperties, { validateProperty }) => {\n  const properties = headerProperties.reduce((previous, valuePart) => {\n    const [propertyName, propertyValueString] = valuePart.split(\"=\")\n    const propertyValue = parseHeaderPropertyValue(propertyValueString)\n    const property = { name: propertyName, value: propertyValue }\n    const propertyValidation = validateProperty(property)\n    if (!propertyValidation) {\n      return previous\n    }\n    return {\n      ...previous,\n      [property.name]: property.value,\n    }\n  }, {})\n  return properties\n}\n\nconst parseHeaderPropertyValue = (headerPropertyValueString) => {\n  const firstChar = headerPropertyValueString[0]\n  const lastChar = headerPropertyValueString[headerPropertyValueString.length - 1]\n  if (firstChar === '\"' && lastChar === '\"') {\n    return headerPropertyValueString.slice(1, -1)\n  }\n  if (isNaN(headerPropertyValueString)) {\n    return headerPropertyValueString\n  }\n  return parseFloat(headerPropertyValueString)\n}\n\nexport const stringifyMultipleHeader = (\n  multipleHeader,\n  { validateName = () => true, validateProperty = () => true } = {},\n) => {\n  return Object.keys(multipleHeader)\n    .filter((name) => {\n      const headerProperties = multipleHeader[name]\n      if (!headerProperties) {\n        return false\n      }\n      if (typeof headerProperties !== \"object\") {\n        return false\n      }\n      const nameValidation = validateName(name)\n      if (!nameValidation) {\n        return false\n      }\n      return true\n    })\n    .map((name) => {\n      const headerProperties = multipleHeader[name]\n      const headerPropertiesString = stringifyHeaderProperties(headerProperties, {\n        validateProperty,\n      })\n      if (headerPropertiesString.length) {\n        return `${name};${headerPropertiesString}`\n      }\n      return name\n    })\n    .join(\", \")\n}\n\nconst stringifyHeaderProperties = (headerProperties, { validateProperty }) => {\n  const headerPropertiesString = Object.keys(headerProperties)\n    .map((name) => {\n      const property = {\n        name,\n        value: headerProperties[name],\n      }\n      return property\n    })\n    .filter((property) => {\n      const propertyValidation = validateProperty(property)\n      if (!propertyValidation) {\n        return false\n      }\n      return true\n    })\n    .map(stringifyHeaderProperty)\n    .join(\";\")\n  return headerPropertiesString\n}\n\nconst stringifyHeaderProperty = ({ name, value }) => {\n  if (typeof value === \"string\") {\n    return `${name}=\"${value}\"`\n  }\n  return `${name}=${value}`\n}\n",
    "import { applyContentNegotiation } from \"./internal/applyContentNegotiation.js\"\nimport { parseMultipleHeader } from \"./internal/multiple-header.js\"\n\nexport const negotiateContentType = (request, availableContentTypes) => {\n  const { headers = {} } = request\n  const requestAcceptHeader = headers.accept\n  if (!requestAcceptHeader) {\n    return null\n  }\n\n  const contentTypesAccepted = parseAcceptHeader(requestAcceptHeader)\n  return applyContentNegotiation({\n    accepteds: contentTypesAccepted,\n    availables: availableContentTypes,\n    getAcceptanceScore: getContentTypeAcceptanceScore,\n  })\n}\n\nconst parseAcceptHeader = (acceptHeader) => {\n  const acceptHeaderObject = parseMultipleHeader(acceptHeader, {\n    validateProperty: ({ name }) => {\n      // read only q, anything else is ignored\n      return name === \"q\"\n    },\n  })\n\n  const accepts = []\n  Object.keys(acceptHeaderObject).forEach((key) => {\n    const { q = 1 } = acceptHeaderObject[key]\n    const value = key\n    accepts.push({\n      value,\n      quality: q,\n    })\n  })\n  accepts.sort((a, b) => {\n    return b.quality - a.quality\n  })\n  return accepts\n}\n\nconst getContentTypeAcceptanceScore = ({ value, quality }, availableContentType) => {\n  const [acceptedType, acceptedSubtype] = decomposeContentType(value)\n  const [availableType, availableSubtype] = decomposeContentType(availableContentType)\n\n  const typeAccepted = acceptedType === \"*\" || acceptedType === availableType\n  const subtypeAccepted = acceptedSubtype === \"*\" || acceptedSubtype === availableSubtype\n\n  if (typeAccepted && subtypeAccepted) {\n    return quality\n  }\n  return -1\n}\n\nconst decomposeContentType = (fullType) => {\n  const [type, subtype] = fullType.split(\"/\")\n  return [type, subtype]\n}\n",
    "import { performance } from \"perf_hooks\"\nimport { parseMultipleHeader, stringifyMultipleHeader } from \"./internal/multiple-header.js\"\n\nexport const timeStart = (name) => {\n  // as specified in https://w3c.github.io/server-timing/#the-performanceservertiming-interface\n  // duration is a https://www.w3.org/TR/hr-time-2/#sec-domhighrestimestamp\n  const startTimestamp = performance.now()\n  const timeEnd = () => {\n    const endTimestamp = performance.now()\n    const timing = {\n      [name]: endTimestamp - startTimestamp,\n    }\n    return timing\n  }\n  return timeEnd\n}\n\nexport const timeFunction = (name, fn) => {\n  const timeEnd = timeStart(name)\n  const returnValue = fn()\n  if (returnValue && typeof returnValue.then === \"function\") {\n    return returnValue.then((value) => {\n      return [timeEnd(), value]\n    })\n  }\n  return [timeEnd(), returnValue]\n}\n\n// to predict order in chrome devtools we should put a,b,c,d,e or something\n// because in chrome dev tools they are shown in alphabetic order\n// also we should manipulate a timing object instead of a header to facilitate\n// manipulation of the object so that the timing header response generation logic belongs to @jsenv/server\n// so response can return a new timing object\n// yes it's awful, feel free to PR with a better approach :)\nexport const timingToServerTimingResponseHeaders = (timing) => {\n  const serverTimingHeader = {}\n  Object.keys(timing).forEach((key, index) => {\n    const name = letters[index] || \"zz\"\n    serverTimingHeader[name] = {\n      desc: key,\n      dur: timing[key],\n    }\n  })\n  const serverTimingHeaderString = stringifyServerTimingHeader(serverTimingHeader)\n\n  return { \"server-timing\": serverTimingHeaderString }\n}\n\nconst letters = [\n  \"a\",\n  \"b\",\n  \"c\",\n  \"d\",\n  \"e\",\n  \"f\",\n  \"g\",\n  \"h\",\n  \"i\",\n  \"j\",\n  \"k\",\n  \"l\",\n  \"m\",\n  \"n\",\n  \"o\",\n  \"p\",\n  \"q\",\n  \"r\",\n  \"s\",\n  \"t\",\n  \"u\",\n  \"v\",\n  \"w\",\n  \"x\",\n  \"y\",\n  \"z\",\n]\n\nexport const parseServerTimingHeader = (serverTimingHeaderString) => {\n  const serverTimingHeaderObject = parseMultipleHeader(serverTimingHeaderString, {\n    validateName: validateServerTimingName,\n    validateProperty: ({ name }) => {\n      return name === \"desc\" || name === \"dur\"\n    },\n  })\n\n  const serverTiming = {}\n  Object.keys(serverTimingHeaderObject).forEach((key) => {\n    const { desc, dur } = serverTimingHeaderObject[key]\n    serverTiming[key] = {\n      ...(desc ? { description: desc } : {}),\n      ...(dur ? { duration: dur } : {}),\n    }\n  })\n  return serverTiming\n}\n\nexport const stringifyServerTimingHeader = (serverTimingHeader) => {\n  return stringifyMultipleHeader(serverTimingHeader, {\n    validateName: validateServerTimingName,\n  })\n}\n\n// (),/:;<=>?@[\\]{}\" Don't allowed\n// Minimal length is one symbol\n// Digits, alphabet characters,\n// and !#$%&'*+-.^_`|~ are allowed\n// https://www.w3.org/TR/2019/WD-server-timing-20190307/#the-server-timing-header-field\n// https://tools.ietf.org/html/rfc7230#section-3.2.6\nconst validateServerTimingName = (name) => {\n  const valid = /^[!#$%&'*+\\-.^_`|~0-9a-z]+$/gi.test(name)\n  if (!valid) {\n    console.warn(`server timing contains invalid symbols`)\n    return false\n  }\n  return true\n}\n",
    "export const jsenvContentTypeMap = {\n  \"application/javascript\": {\n    extensions: [\"js\", \"cjs\", \"mjs\", \"ts\", \"jsx\"],\n  },\n  \"application/json\": {\n    extensions: [\"json\"],\n  },\n  \"application/importmap+json\": {\n    extensions: [\"importmap\"],\n  },\n  \"application/manifest+json\": {\n    extensions: [\"webmanifest\"],\n  },\n  \"application/octet-stream\": {},\n  \"application/pdf\": {\n    extensions: [\"pdf\"],\n  },\n  \"application/xml\": {\n    extensions: [\"xml\"],\n  },\n  \"application/x-gzip\": {\n    extensions: [\"gz\"],\n  },\n  \"application/wasm\": {\n    extensions: [\"wasm\"],\n  },\n  \"application/zip\": {\n    extensions: [\"zip\"],\n  },\n  \"audio/basic\": {\n    extensions: [\"au\", \"snd\"],\n  },\n  \"audio/mpeg\": {\n    extensions: [\"mpga\", \"mp2\", \"mp2a\", \"mp3\", \"m2a\", \"m3a\"],\n  },\n  \"audio/midi\": {\n    extensions: [\"midi\", \"mid\", \"kar\", \"rmi\"],\n  },\n  \"audio/mp4\": {\n    extensions: [\"m4a\", \"mp4a\"],\n  },\n  \"audio/ogg\": {\n    extensions: [\"oga\", \"ogg\", \"spx\"],\n  },\n  \"audio/webm\": {\n    extensions: [\"weba\"],\n  },\n  \"audio/x-wav\": {\n    extensions: [\"wav\"],\n  },\n  \"font/ttf\": {\n    extensions: [\"ttf\"],\n  },\n  \"font/woff\": {\n    extensions: [\"woff\"],\n  },\n  \"font/woff2\": {\n    extensions: [\"woff2\"],\n  },\n  \"image/png\": {\n    extensions: [\"png\"],\n  },\n  \"image/gif\": {\n    extensions: [\"gif\"],\n  },\n  \"image/jpeg\": {\n    extensions: [\"jpg\"],\n  },\n  \"image/svg+xml\": {\n    extensions: [\"svg\", \"svgz\"],\n  },\n  \"text/plain\": {\n    extensions: [\"txt\"],\n  },\n  \"text/html\": {\n    extensions: [\"html\"],\n  },\n  \"text/css\": {\n    extensions: [\"css\"],\n  },\n  \"text/x-sass\": {\n    extensions: [\"sass\"],\n  },\n  \"text/cache-manifest\": {\n    extensions: [\"appcache\"],\n  },\n  \"video/mp4\": {\n    extensions: [\"mp4\", \"mp4v\", \"mpg4\"],\n  },\n  \"video/mpeg\": {\n    extensions: [\"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\"],\n  },\n  \"video/ogg\": {\n    extensions: [\"ogv\"],\n  },\n  \"video/webm\": {\n    extensions: [\"webm\"],\n  },\n}\n",
    "// https://github.com/jshttp/mime-db/blob/master/src/apache-types.json\n\nimport { extname } from \"path\"\nimport { jsenvContentTypeMap } from \"./jsenvContentTypeMap.js\"\n\nexport const urlToContentType = (\n  url,\n  contentTypeMap = jsenvContentTypeMap,\n  contentTypeDefault = \"application/octet-stream\",\n) => {\n  if (typeof contentTypeMap !== \"object\") {\n    throw new TypeError(`contentTypeMap must be an object, got ${contentTypeMap}`)\n  }\n  const pathname = new URL(url).pathname\n\n  const extensionWithDot = extname(pathname)\n\n  if (!extensionWithDot || extensionWithDot === \".\") {\n    return contentTypeDefault\n  }\n\n  const extension = extensionWithDot.slice(1)\n  const availableContentTypes = Object.keys(contentTypeMap)\n  const contentTypeForExtension = availableContentTypes.find((contentTypeName) => {\n    const contentType = contentTypeMap[contentTypeName]\n    return contentType.extensions && contentType.extensions.indexOf(extension) > -1\n  })\n  return contentTypeForExtension || contentTypeDefault\n}\n",
    "import { applyContentNegotiation } from \"./internal/applyContentNegotiation.js\"\nimport { parseMultipleHeader } from \"./internal/multiple-header.js\"\n\nexport const negotiateContentEncoding = (request, availableEncodings) => {\n  const { headers = {} } = request\n  const requestAcceptEncodingHeader = headers[\"accept-encoding\"]\n  if (!requestAcceptEncodingHeader) {\n    return null\n  }\n\n  const encodingsAccepted = parseAcceptEncodingHeader(requestAcceptEncodingHeader)\n  return applyContentNegotiation({\n    accepteds: encodingsAccepted,\n    availables: availableEncodings,\n    getAcceptanceScore: getEncodingAcceptanceScore,\n  })\n}\n\nconst parseAcceptEncodingHeader = (acceptEncodingHeaderString) => {\n  const acceptEncodingHeader = parseMultipleHeader(acceptEncodingHeaderString, {\n    validateProperty: ({ name }) => {\n      // read only q, anything else is ignored\n      return name === \"q\"\n    },\n  })\n\n  const encodingsAccepted = []\n  Object.keys(acceptEncodingHeader).forEach((key) => {\n    const { q = 1 } = acceptEncodingHeader[key]\n    const value = key\n    encodingsAccepted.push({\n      value,\n      quality: q,\n    })\n  })\n  encodingsAccepted.sort((a, b) => {\n    return b.quality - a.quality\n  })\n  return encodingsAccepted\n}\n\nconst getEncodingAcceptanceScore = ({ value, quality }, availableEncoding) => {\n  if (value === \"*\") {\n    return quality\n  }\n\n  // normalize br to brotli\n  if (value === \"br\") value = \"brotli\"\n  if (availableEncoding === \"br\") availableEncoding = \"brotli\"\n\n  if (value === availableEncoding) {\n    return quality\n  }\n\n  return -1\n}\n",
    "import { createReadStream, promises, statSync } from \"fs\"\nimport {\n  assertAndNormalizeDirectoryUrl,\n  resolveUrl,\n  resolveDirectoryUrl,\n  bufferToEtag,\n  readDirectory,\n  urlToFileSystemPath,\n  urlToRelativeUrl,\n} from \"@jsenv/util\"\nimport { createOperation } from \"@jsenv/cancellation\"\nimport { negotiateContentType } from \"./negotiateContentType.js\"\nimport { timeFunction } from \"./serverTiming.js\"\nimport { convertFileSystemErrorToResponseProperties } from \"./convertFileSystemErrorToResponseProperties.js\"\nimport { urlToContentType } from \"./urlToContentType.js\"\nimport { jsenvContentTypeMap } from \"./jsenvContentTypeMap.js\"\nimport { composeResponse } from \"./composeResponse.js\"\nimport { negotiateContentEncoding } from \"./negotiateContentEncoding.js\"\n\nconst { readFile } = promises\n\nconst ETAG_CACHE = new Map()\nconst ETAG_CACHE_MAX_SIZE = 500\n\nexport const serveFile = async (\n  request,\n  {\n    rootDirectoryUrl,\n    contentTypeMap = jsenvContentTypeMap,\n    etagEnabled = false,\n    etagCacheDisabled = false,\n    mtimeEnabled = false,\n    compressionEnabled = false,\n    compressionSizeThreshold = 1024,\n    cacheControl = etagEnabled || mtimeEnabled ? \"private,max-age=0,must-revalidate\" : \"no-store\",\n    canReadDirectory = false,\n    readableStreamLifetimeInSeconds = 5,\n  } = {},\n) => {\n  try {\n    rootDirectoryUrl = assertAndNormalizeDirectoryUrl(rootDirectoryUrl)\n  } catch (e) {\n    const body = `Cannot serve file because rootDirectoryUrl parameter is not a directory url: ${rootDirectoryUrl}`\n    return {\n      status: 404,\n      headers: {\n        \"content-type\": \"text/plain\",\n        \"content-length\": Buffer.byteLength(body),\n      },\n      body,\n    }\n  }\n  // here you might be tempted to add || cacheControl === 'no-cache'\n  // but no-cache means ressource can be cache but must be revalidated (yeah naming is strange)\n  // https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control#Cacheability\n  if (cacheControl === \"no-store\") {\n    if (etagEnabled) {\n      console.warn(`cannot enable etag when cache-control is ${cacheControl}`)\n      etagEnabled = false\n    }\n    if (mtimeEnabled) {\n      console.warn(`cannot enable mtime when cache-control is ${cacheControl}`)\n      mtimeEnabled = false\n    }\n  }\n  if (etagEnabled && mtimeEnabled) {\n    console.warn(`cannot enable both etag and mtime, mtime disabled in favor of etag.`)\n    mtimeEnabled = false\n  }\n\n  const { method, ressource } = request\n  if (method !== \"GET\" && method !== \"HEAD\") {\n    return {\n      status: 501,\n    }\n  }\n\n  let sourceUrl = resolveUrl(ressource.slice(1), rootDirectoryUrl)\n  const sourceFileSystemPath = urlToFileSystemPath(sourceUrl)\n\n  try {\n    const [readStatTiming, sourceStat] = await timeFunction(\"file service>read file stat\", () =>\n      statSync(sourceFileSystemPath),\n    )\n\n    if (sourceStat.isDirectory()) {\n      sourceUrl = resolveDirectoryUrl(ressource.slice(1), rootDirectoryUrl)\n\n      if (canReadDirectory === false) {\n        return {\n          status: 403,\n          statusText: \"not allowed to read directory\",\n          timing: readStatTiming,\n        }\n      }\n\n      const [readDirectoryTiming, directoryContentArray] = await timeFunction(\n        \"file service>read directory\",\n        () =>\n          createOperation({\n            cancellationToken: request.cancellationToken,\n            start: () => readDirectory(sourceUrl),\n          }),\n      )\n\n      const responseProducers = {\n        \"application/json\": () => {\n          const directoryContentJson = JSON.stringify(directoryContentArray)\n          return {\n            status: 200,\n            headers: {\n              \"content-type\": \"application/json\",\n              \"content-length\": directoryContentJson.length,\n            },\n            body: directoryContentJson,\n            timing: {\n              ...readStatTiming,\n              ...readDirectoryTiming,\n            },\n          }\n        },\n        \"text/html\": () => {\n          const directoryAsHtml = `<!DOCTYPE html>\n<html>\n  <head>\n    <title>Directory explorer</title>\n    <meta charset=\"utf-8\" />\n    <link rel=\"icon\" href=\"data:,\" />\n  </head>\n\n  <body>\n    <h1>Content of directory ${sourceUrl}</h1>\n    <ul>\n      ${directoryContentArray.map((filename) => {\n        const fileUrl = resolveUrl(filename, sourceUrl)\n        const fileUrlRelativeToServer = urlToRelativeUrl(fileUrl, rootDirectoryUrl)\n        return `<li>\n        <a href=\"/${fileUrlRelativeToServer}\">${fileUrlRelativeToServer}</a>\n      </li>`\n      }).join(`\n      `)}\n    </ul>\n  </body>\n</html>`\n\n          return {\n            status: 200,\n            headers: {\n              \"content-type\": \"text/html\",\n              \"content-length\": Buffer.byteLength(directoryAsHtml),\n            },\n            body: directoryAsHtml,\n          }\n        },\n      }\n      const bestContentType = negotiateContentType(request, Object.keys(responseProducers))\n      return responseProducers[bestContentType || \"application/json\"]()\n    }\n\n    // not a file, give up\n    if (!sourceStat.isFile()) {\n      return {\n        status: 404,\n        timing: readStatTiming,\n      }\n    }\n\n    const clientCacheResponse = await getClientCacheResponse(request, {\n      etagEnabled,\n      etagCacheDisabled,\n      mtimeEnabled,\n      sourceStat,\n      sourceUrl,\n    })\n\n    // send 304 (redirect response to client cache)\n    // because the response body does not have to be transmitted\n    if (clientCacheResponse.status === 304) {\n      return composeResponse(\n        {\n          timing: readStatTiming,\n          headers: {\n            ...(cacheControl ? { \"cache-control\": cacheControl } : {}),\n          },\n        },\n        clientCacheResponse,\n      )\n    }\n\n    let response\n    if (compressionEnabled && sourceStat.size >= compressionSizeThreshold) {\n      const compressedResponse = await getCompressedResponse(request, {\n        sourceUrl,\n        contentTypeMap,\n      })\n      if (compressedResponse) {\n        response = compressedResponse\n      }\n    }\n    if (!response) {\n      response = await getRawResponse(request, {\n        sourceStat,\n        sourceUrl,\n        contentTypeMap,\n      })\n    }\n\n    if (response.body) {\n      // do not keep readable stream opened on that file\n      // otherwise file is kept open forever.\n      // moreover it will prevent to unlink the file on windows.\n      if (clientCacheResponse.body) {\n        response.body.destroy()\n      } else if (readableStreamLifetimeInSeconds && readableStreamLifetimeInSeconds !== Infinity) {\n        // safe measure, ensure the readable stream gets used in the next ${readableStreamLifetimeInSeconds} otherwise destroys it\n        const timeout = setTimeout(() => {\n          console.warn(\n            `readable stream on ${sourceUrl} still unused after ${readableStreamLifetimeInSeconds} seconds -> destroying it to release file handle`,\n          )\n          response.body.destroy()\n        }, readableStreamLifetimeInSeconds * 1000)\n        onceReadableStreamUsedOrClosed(response.body, () => {\n          clearTimeout(timeout)\n        })\n      }\n    }\n\n    return composeResponse(\n      {\n        timing: readStatTiming,\n        headers: {\n          ...(cacheControl ? { \"cache-control\": cacheControl } : {}),\n          // even if client cache is disabled, server can still\n          // send his own cache control but client should just ignore it\n          // and keep sending cache-control: 'no-store'\n          // if not, uncomment the line below to preserve client\n          // desire to ignore cache\n          // ...(headers[\"cache-control\"] === \"no-store\" ? { \"cache-control\": \"no-store\" } : {}),\n        },\n      },\n      response,\n      clientCacheResponse,\n    )\n  } catch (e) {\n    return convertFileSystemErrorToResponseProperties(e)\n  }\n}\n\nconst getClientCacheResponse = async (\n  request,\n  { etagEnabled, etagCacheDisabled, mtimeEnabled, sourceStat, sourceUrl },\n) => {\n  // here you might be tempted to add || headers[\"cache-control\"] === \"no-cache\"\n  // but no-cache means ressource can be cache but must be revalidated (yeah naming is strange)\n  // https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control#Cacheability\n\n  const { headers = {} } = request\n  if (\n    headers[\"cache-control\"] === \"no-store\" ||\n    // let's disable it on no-cache too (https://github.com/jsenv/jsenv-server/issues/17)\n    headers[\"cache-control\"] === \"no-cache\"\n  ) {\n    return { status: 200 }\n  }\n\n  if (etagEnabled) {\n    return getEtagResponse(request, {\n      etagCacheDisabled,\n      sourceStat,\n      sourceUrl,\n    })\n  }\n\n  if (mtimeEnabled) {\n    return getMtimeResponse(request, {\n      sourceStat,\n    })\n  }\n\n  return { status: 200 }\n}\n\nconst getEtagResponse = async (request, { etagCacheDisabled, sourceUrl, sourceStat }) => {\n  const [computeEtagTiming, fileContentEtag] = await timeFunction(\n    \"file service>generate file etag\",\n    () => computeEtag(request, { etagCacheDisabled, sourceUrl, sourceStat }),\n  )\n\n  const { headers = {} } = request\n  const requestHasIfNoneMatchHeader = \"if-none-match\" in headers\n  if (requestHasIfNoneMatchHeader && headers[\"if-none-match\"] === fileContentEtag) {\n    return {\n      status: 304,\n      timing: computeEtagTiming,\n    }\n  }\n\n  return {\n    status: 200,\n    headers: {\n      etag: fileContentEtag,\n    },\n    timing: computeEtagTiming,\n  }\n}\n\nconst computeEtag = async (request, { etagCacheDisabled, sourceUrl, sourceStat }) => {\n  if (!etagCacheDisabled) {\n    const etagCacheEntry = ETAG_CACHE.get(sourceUrl)\n    if (etagCacheEntry && fileStatAreTheSame(etagCacheEntry.sourceStat, sourceStat)) {\n      return etagCacheEntry.eTag\n    }\n  }\n  const fileContentAsBuffer = await createOperation({\n    cancellationToken: request.cancellationToken,\n    start: () => readFile(urlToFileSystemPath(sourceUrl)),\n  })\n  const eTag = bufferToEtag(fileContentAsBuffer)\n  if (!etagCacheDisabled) {\n    if (ETAG_CACHE.size >= ETAG_CACHE_MAX_SIZE) {\n      const firstKey = Array.from(ETAG_CACHE.keys())[0]\n      ETAG_CACHE.delete(firstKey)\n    }\n    ETAG_CACHE.set(sourceUrl, { sourceStat, eTag })\n  }\n  return eTag\n}\n\n// https://nodejs.org/api/fs.html#fs_class_fs_stats\nconst fileStatAreTheSame = (leftFileStat, rightFileStat) => {\n  return fileStatKeysToCompare.every((keyToCompare) => {\n    const leftValue = leftFileStat[keyToCompare]\n    const rightValue = rightFileStat[keyToCompare]\n    return leftValue === rightValue\n  })\n}\nconst fileStatKeysToCompare = [\n  // mtime the the most likely to change, check it first\n  \"mtimeMs\",\n  \"size\",\n  \"ctimeMs\",\n  \"ino\",\n  \"mode\",\n  \"uid\",\n  \"gid\",\n  \"blksize\",\n]\n\nconst getMtimeResponse = async (request, { sourceStat }) => {\n  const { headers = {} } = request\n  if (\"if-modified-since\" in headers) {\n    let cachedModificationDate\n    try {\n      cachedModificationDate = new Date(headers[\"if-modified-since\"])\n    } catch (e) {\n      return {\n        status: 400,\n        statusText: \"if-modified-since header is not a valid date\",\n      }\n    }\n\n    const actualModificationDate = dateToSecondsPrecision(sourceStat.mtime)\n    if (Number(cachedModificationDate) >= Number(actualModificationDate)) {\n      return {\n        status: 304,\n      }\n    }\n  }\n\n  return {\n    status: 200,\n    headers: {\n      \"last-modified\": dateToUTCString(sourceStat.mtime),\n    },\n  }\n}\n\nconst getCompressedResponse = async (request, { sourceUrl, contentTypeMap }) => {\n  const acceptedCompressionFormat = negotiateContentEncoding(\n    request,\n    Object.keys(availableCompressionFormats),\n  )\n  if (!acceptedCompressionFormat) {\n    return null\n  }\n\n  const fileReadableStream = fileUrlToReadableStream(sourceUrl)\n  const body = await availableCompressionFormats[acceptedCompressionFormat](fileReadableStream)\n\n  return {\n    status: 200,\n    headers: {\n      \"content-type\": urlToContentType(sourceUrl, contentTypeMap),\n      \"content-encoding\": acceptedCompressionFormat,\n      \"vary\": \"accept-encoding\",\n    },\n    body,\n  }\n}\n\nconst fileUrlToReadableStream = (fileUrl) => {\n  return createReadStream(urlToFileSystemPath(fileUrl), { emitClose: true })\n}\n\nconst availableCompressionFormats = {\n  br: async (fileReadableStream) => {\n    const { createBrotliCompress } = await import(\"zlib\")\n    return fileReadableStream.pipe(createBrotliCompress())\n  },\n  deflate: async (fileReadableStream) => {\n    const { createDeflate } = await import(\"zlib\")\n    return fileReadableStream.pipe(createDeflate())\n  },\n  gzip: async (fileReadableStream) => {\n    const { createGzip } = await import(\"zlib\")\n    return fileReadableStream.pipe(createGzip())\n  },\n}\n\nconst getRawResponse = async (request, { sourceStat, sourceUrl, contentTypeMap }) => {\n  return {\n    status: 200,\n    headers: {\n      \"content-type\": urlToContentType(sourceUrl, contentTypeMap),\n      \"content-length\": sourceStat.size,\n    },\n    body: fileUrlToReadableStream(sourceUrl),\n  }\n}\n\nconst onceReadableStreamUsedOrClosed = (readableStream, callback) => {\n  const dataOrCloseCallback = () => {\n    readableStream.removeListener(\"data\", dataOrCloseCallback)\n    readableStream.removeListener(\"close\", dataOrCloseCallback)\n    callback()\n  }\n  readableStream.on(\"data\", dataOrCloseCallback)\n  readableStream.on(\"close\", dataOrCloseCallback)\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toUTCString\nconst dateToUTCString = (date) => date.toUTCString()\n\nconst dateToSecondsPrecision = (date) => {\n  const dateWithSecondsPrecision = new Date(date)\n  dateWithSecondsPrecision.setMilliseconds(0)\n  return dateWithSecondsPrecision\n}\n",
    "// https://github.com/node-fetch/node-fetch/blob/8c197f8982a238b3c345c64b17bfa92e16b4f7c4/src/response.js#L1\n\nimport { createRequire } from \"module\"\nimport { Agent } from \"https\"\nimport { createCancellationToken } from \"@jsenv/cancellation\"\nimport { urlToOrigin, urlToRessource } from \"@jsenv/util\"\nimport { serveFile } from \"./serveFile.js\"\n\nconst require = createRequire(import.meta.url)\nconst nodeFetch = require(\"node-fetch\")\nconst AbortController = require(\"abort-controller\")\n\nconst { Response } = nodeFetch\n\nexport const fetchUrl = async (\n  url,\n  {\n    cancellationToken = createCancellationToken(),\n    ignoreHttpsError = false,\n    canReadDirectory,\n    contentTypeMap,\n    cacheStrategy,\n    ...options\n  } = {},\n) => {\n  try {\n    url = String(new URL(url))\n  } catch (e) {\n    throw new Error(`fetchUrl first argument must be an absolute url, received ${url}`)\n  }\n\n  if (url.startsWith(\"file://\")) {\n    const origin = urlToOrigin(url)\n    let ressource = urlToRessource(url)\n    if (process.platform === \"win32\") {\n      ressource = `/${replaceBackSlashesWithSlashes(ressource)}`\n    }\n\n    const request = {\n      cancellationToken,\n      method: options.method || \"GET\",\n      headers: options.headers || {},\n      ressource,\n    }\n    const { status, statusText, headers, body } = await serveFile(request, {\n      rootDirectoryUrl: origin,\n      cacheStrategy,\n      canReadDirectory,\n      contentTypeMap,\n      ...options,\n    })\n    const response = new Response(typeof body === \"string\" ? Buffer.from(body) : body, {\n      url,\n      status,\n      statusText,\n      headers,\n    })\n    return response\n  }\n\n  if (url.startsWith(\"data:\")) {\n    const { mediaType, base64Flag, data } = parseDataUrl(url)\n    const body = base64Flag ? Buffer.from(data, \"base64\") : Buffer.from(data)\n    const response = new Response(body, {\n      url,\n      status: 200,\n      headers: {\n        \"content-type\": mediaType,\n      },\n    })\n    return response\n  }\n\n  // cancellation might be requested early, abortController does not support that\n  // so we have to throw if requested right away\n  cancellationToken.throwIfRequested()\n\n  // https://github.com/bitinn/node-fetch#request-cancellation-with-abortsignal\n  const abortController = new AbortController()\n\n  let cancelError\n  cancellationToken.register((reason) => {\n    cancelError = reason\n    abortController.abort(reason)\n  })\n\n  let response\n  try {\n    response = await nodeFetch(url, {\n      signal: abortController.signal,\n      ...(ignoreHttpsError && url.startsWith(\"https\")\n        ? {\n            agent: new Agent({\n              rejectUnauthorized: false,\n            }),\n          }\n        : {}),\n      ...options,\n    })\n  } catch (e) {\n    if (e.message.includes(\"reason: connect ECONNRESET\")) {\n      if (cancelError) {\n        throw cancelError\n      }\n      throw e\n    }\n    if (e.name === \"AbortError\") {\n      if (cancelError) {\n        throw cancelError\n      }\n      throw e\n    }\n    throw e\n  }\n\n  return response\n}\n\nconst replaceBackSlashesWithSlashes = (string) => string.replace(/\\\\/g, \"/\")\n\nconst parseDataUrl = (dataUrl) => {\n  const afterDataProtocol = dataUrl.slice(\"data:\".length)\n  const commaIndex = afterDataProtocol.indexOf(\",\")\n  const beforeComma = afterDataProtocol.slice(0, commaIndex)\n\n  let mediaType\n  let base64Flag\n  if (beforeComma.endsWith(`;base64`)) {\n    mediaType = beforeComma.slice(0, -`;base64`.length)\n    base64Flag = true\n  } else {\n    mediaType = beforeComma\n    base64Flag = false\n  }\n\n  const afterComma = afterDataProtocol.slice(commaIndex + 1)\n  return {\n    mediaType: mediaType === \"\" ? \"text/plain;charset=US-ASCII\" : mediaType,\n    base64Flag,\n    data: afterComma,\n  }\n}\n",
    "import { createStoppableOperation } from \"@jsenv/cancellation\"\n\nexport const listen = ({ cancellationToken, server, port, ip }) => {\n  return createStoppableOperation({\n    cancellationToken,\n    start: () => startListening(server, port, ip),\n    stop: () => stopListening(server),\n  })\n}\n\nexport const startListening = (server, port, ip) =>\n  new Promise((resolve, reject) => {\n    server.on(\"error\", reject)\n    server.on(\"listening\", () => {\n      // in case port is 0 (randomly assign an available port)\n      // https://nodejs.org/api/net.html#net_server_listen_port_host_backlog_callback\n      resolve(server.address().port)\n    })\n    server.listen(port, ip)\n  })\n\nexport const stopListening = (server) =>\n  new Promise((resolve, reject) => {\n    server.on(\"error\", reject)\n    server.on(\"close\", resolve)\n    server.close()\n  })\n",
    "import { createServer } from \"net\"\nimport { createCancellationToken } from \"@jsenv/cancellation\"\nimport { listen } from \"./internal/listen.js\"\n\nexport const findFreePort = async (\n  initialPort = 1,\n  {\n    cancellationToken = createCancellationToken(),\n    ip = \"127.0.0.1\",\n    min = 1,\n    max = 65534,\n    next = (port) => port + 1,\n  } = {},\n) => {\n  const testUntil = async (port, ip) => {\n    const free = await portIsFree({ cancellationToken, port, ip })\n    if (free) {\n      return port\n    }\n    const nextPort = next(port)\n\n    if (nextPort > max) {\n      throw new Error(`${ip} has no available port between ${min} and ${max}`)\n    }\n\n    return testUntil(nextPort, ip)\n  }\n\n  return testUntil(initialPort, ip)\n}\n\nconst portIsFree = async ({ cancellationToken, port, ip }) => {\n  const server = createServer()\n\n  const listenOperation = listen({\n    cancellationToken,\n    server,\n    port,\n    ip,\n  })\n\n  try {\n    await listenOperation\n  } catch (error) {\n    if (error && error.code === \"EADDRINUSE\") {\n      return false\n    }\n    if (error && error.code === \"EACCES\") {\n      return false\n    }\n    return Promise.reject(error)\n  }\n\n  const stopPromise = listenOperation.stop()\n  // cancellation must wait for server to be closed before considering\n  // cancellation as done\n  cancellationToken.register(() => stopPromise)\n  await stopPromise\n  return true\n}\n",
    "export const headersToObject = (headers) => {\n  const headersObject = {}\n  headers.forEach((value, name) => {\n    headersObject[name] = value\n  })\n  return headersObject\n}\n",
    "import { firstOperationMatching } from \"@jsenv/cancellation\"\nimport { timeFunction } from \"./serverTiming.js\"\nimport { composeResponse } from \"./composeResponse.js\"\n\nexport const firstService = (...callbacks) => {\n  return (request) => {\n    return firstOperationMatching({\n      array: callbacks,\n      start: (callback) => callback(request),\n      predicate: serviceGeneratedResponsePredicate,\n    })\n  }\n}\n\nexport const firstServiceWithTiming = (namedServices) => {\n  return async (request) => {\n    const servicesTiming = {}\n    const response = await firstOperationMatching({\n      array: Object.keys(namedServices).map((serviceName) => {\n        return { serviceName, serviceFn: namedServices[serviceName] }\n      }),\n      start: async ({ serviceName, serviceFn }) => {\n        const [serviceTiming, value] = await timeFunction(serviceName, () => serviceFn(request))\n        Object.assign(servicesTiming, serviceTiming)\n        return value\n      },\n      predicate: (value) => {\n        if (value === null) {\n          return false\n        }\n        return typeof value === \"object\"\n      },\n    })\n    if (response) {\n      return composeResponse({ timing: servicesTiming }, response)\n    }\n    return null\n  }\n}\n\nconst serviceGeneratedResponsePredicate = (value) => {\n  if (value === null) {\n    return false\n  }\n  return typeof value === \"object\"\n}\n",
    "export const jsenvAccessControlAllowedHeaders = [\"x-requested-with\"]\n",
    "export const jsenvAccessControlAllowedMethods = [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"]\n",
    "import { negotiateContentType } from \"./negotiateContentType.js\"\n\nexport const jsenvServerInternalErrorToResponse = (\n  serverInternalError,\n  { request, sendServerInternalErrorDetails = false },\n) => {\n  const serverInternalErrorIsAPrimitive =\n    serverInternalError === null ||\n    (typeof serverInternalError !== \"object\" && typeof serverInternalError !== \"function\")\n\n  const dataToSend = serverInternalErrorIsAPrimitive\n    ? {\n        code: \"VALUE_THROWED\",\n        value: serverInternalError,\n      }\n    : {\n        code: serverInternalError.code || \"UNKNOWN_ERROR\",\n        ...(sendServerInternalErrorDetails\n          ? {\n              stack: serverInternalError.stack,\n              ...serverInternalError,\n            }\n          : {}),\n      }\n\n  const availableContentTypes = {\n    \"text/html\": () => {\n      const renderHtmlForErrorWithoutDetails = () => {\n        return `<p>Details not available: to enable them server must be started with sendServerInternalErrorDetails: true.</p>`\n      }\n\n      const renderHtmlForErrorWithDetails = () => {\n        if (serverInternalErrorIsAPrimitive) {\n          return `<pre>${JSON.stringify(serverInternalError, null, \"  \")}</pre>`\n        }\n        return `<pre>${serverInternalError.stack}</pre>`\n      }\n\n      const body = `<!DOCTYPE html>\n<html>\n  <head>\n    <title>Internal server error</title>\n    <meta charset=\"utf-8\" />\n    <link rel=\"icon\" href=\"data:,\" />\n  </head>\n\n  <body>\n    <h1>Internal server error</h1>\n    <p>${\n      serverInternalErrorIsAPrimitive\n        ? `Code inside server has thrown a literal.`\n        : `Code inside server has thrown an error.`\n    }</p>\n    <details>\n      <summary>See internal error details</summary>\n      ${\n        sendServerInternalErrorDetails\n          ? renderHtmlForErrorWithDetails()\n          : renderHtmlForErrorWithoutDetails()\n      }\n    </details>\n  </body>\n</html>`\n\n      return {\n        headers: {\n          \"content-type\": \"text/html\",\n          \"content-length\": Buffer.byteLength(body),\n        },\n        body,\n      }\n    },\n    \"application/json\": () => {\n      const body = JSON.stringify(dataToSend)\n      return {\n        headers: {\n          \"content-type\": \"application/json\",\n          \"content-length\": Buffer.byteLength(body),\n        },\n        body,\n      }\n    },\n  }\n  const bestContentType = negotiateContentType(request, Object.keys(availableContentTypes))\n  return availableContentTypes[bestContentType || \"application/json\"]()\n}\n",
    "export const jsenvRootCertificate = `-----BEGIN CERTIFICATE-----\nMIIDrzCCApegAwIBAgIBAjANBgkqhkiG9w0BAQsFADCBkTEuMCwGA1UEAxMlaHR0\ncHM6Ly9naXRodWIuY29tL2pzZW52L2pzZW52LXNlcnZlcjELMAkGA1UEBhMCRlIx\nGDAWBgNVBAgTD0FscGVzIE1hcml0aW1lczERMA8GA1UEBxMIVmFsYm9ubmUxDjAM\nBgNVBAoTBWpzZW52MRUwEwYDVQQLEwxqc2VudiBzZXJ2ZXIwHhcNMjAwNTAzMTg0\nNzU0WhcNMjkwNTAzMTg0NzU1WjCBkTEuMCwGA1UEAxMlaHR0cHM6Ly9naXRodWIu\nY29tL2pzZW52L2pzZW52LXNlcnZlcjELMAkGA1UEBhMCRlIxGDAWBgNVBAgTD0Fs\ncGVzIE1hcml0aW1lczERMA8GA1UEBxMIVmFsYm9ubmUxDjAMBgNVBAoTBWpzZW52\nMRUwEwYDVQQLEwxqc2VudiBzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw\nggEKAoIBAQC4E/QxOsJZlbM+o7V0fRLvV1ZL7zKXMxFHd05V33Z9Lg3/thvbq5sv\nfHZ1kOCnhR9CI4tpypbGXcugP/KevBzsXzJkEdGofdtT9V9OcyeC28hcnh+kswI5\nWa8rJ6InEtJSlA2aduJkMaW3GK24w+9sypFazbXdurHShaJoi1FV6vePy+Ddc2MM\n0gqE0pxT1oh1gZwHs5MR5KABZrsZX+NQRk2ARl4DZFeAYOioSWE0/dNLQP38MCro\nz5CcZ5eRKOJ+W41oNxK4OMbk5tOYc+4La9qA8KKE7HCMWxXY2QRYlryNJVf134vk\n2Ow6ajiEZMClQk7Oh8H07tu0qwbXM/G1AgMBAAGjEDAOMAwGA1UdEwQFMAMBAf8w\nDQYJKoZIhvcNAQELBQADggEBABQaaP2GOzi/5dYeL33pIyomz9Z5ActCxjdkPsYo\nt5fg8qSsR1Yb3iabwah1vIXHxYWIQhVSaHD9y4qwad4Dni1Iq2YMNZ6i/JT/sxcu\nQEobVxIvuyZN2qSNteQNoNzdO7xDjAU6WTPG4w1DI71Wk1P9atduiJ83nh0A3YBq\nGNQkev5HhSvf52OKsOoL9wAN7iPEfB/487fD2pVKsLl5czEgYMTgNuo9fEgPtg+F\nWM9jzCbw1H31bETxLEXRlbT7nmLGp4zHAwdVp5TAuqjWzNCuu1vAG7AyPvJYoLrG\nfuXJx+wW/G0P0KSTuWNqG88dpBag7wQnvshoZ8MELcEvqxw=\n-----END CERTIFICATE-----`\n\nexport const jsenvPrivateKey = `-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEA7g8u1+cEfCDTX2aMPkCjehz29cJpSqL8DZD7SPvznmXMXY8U\n/TcIcqN3NtPlAyNIjE/5NiQkPJKtgx06E5J1eGFQn8yt54E+2eQNNjz0elxkHmmN\nHwqbD76r6JuIoh/vfNhyw+2jaOO8R+sAJGywu2jFaDtxhho+1xaK1m92zdhu5U3K\nQMg97xuYx+/ezb4JllFBtcs3/uE2Hg50pWO6eny1EtEDfnMhE5L42DyMtoHU+Exd\nF3bGo9FxCq04UFU+ZRCuLUIY/AI8PsMcgcwq7n+O0ijylFoatmyudx+VMoHENWAL\nlBdfjALE3K3XPX6s2IzAVAa4CDpmC2aQ3UCElQIDAQABAoIBAQDh4TYpVeJDhUIK\ne1sGln6HF4Scm+McFpnipXZJQgdefGj1PRZFTTqOy9wKAfSCjbAAssFcRd68OtC4\nX7sDZyxfFLdTaPp5d4ETbfe7RwsSLygwUya8FWwb/GdRRoLWkkbCxv3eOlWa6Lt1\n4d04sojeygLFa+HDxJNrss/5t7mahbX02xTxM5O6Ly+gQDheIepjDNFmXPCvoVHq\nDk3tNeEPsP6qECBWfbfz6eGGBvWsp/copc7ndL+svDmXyJsbZxaOJg0nJ6k4sMOW\nlTueGsr9t/H2wghhquNDK/Vy4e2YQhZ6VG6L0Yy2UtUfIO3JQbSYHIZpSMj1Mdkh\nt675JTfhAoGBAPjTzrkCkIj9g3GITNk556ZQ9W3O8NzbmBtyxdcAQTFhL69K81wy\nMrMvZ2YHPs+WwO6KrGLabDb2qf5xohp8Rgl09f3TjF+1L+ouVjYtKqIaiatA0q3R\n9jpSicyGPSmoo+i2VcHgar3IFcVxGdJoZR+LWR0o7Q1u/WN8HqkkWyp/AoGBAPTr\n6e61xIwlpt4adFFutfpjEaQRWGZ7PtJ+4xQpcztzAYseuBkofierDeCKzkPPsw1J\n1muLYJ9puJjRe/AykoqlF+iloxTM21wlEmtnvVOi+YvFBxj5YJiAiuEGB+42tVH5\n+QbPkcm/lI3reJBuzqrvZkv3fsQhk18Gb0JSWn7rAoGAMS3jyMtJ99lrVlAjKDf6\nofOUXoytLGm2iY5IrfLd772OqC2/JbTCMoom/JJoBq18GmmMIsma484i0Shyapuv\nWAUm7XEXaH8uJjHcVj7dE0b9eLyKJ1K9QM+5bpQFmKs9IiyPjI8nabUXIHv3J4/8\nlJx9E3dYSvRp3nTUtod6AU8CgYEAlz/5P0lRD5tQ6Wg83O0ZxH7ZrhBoHyGNMkDZ\nyuGuH9Bt65QU7LRs8+JWt4wAxS/GyzYGDHQOP2Pyc60qdLNGfAhoM2vWwkmgTc83\nCM0Pxk6m/QG32FxoosT+/ufSjfGLGAzfFK2qwoRlIR+BXPCRAE7HRbKZvlVdxRkc\nLEDfUfECgYANyg47HujS+lZb+3zm2/D/nP25BuGxADL07i4yHIxGSqEYS6MJAOq8\n0fJCOcOeK4XypFGvrVyZiVkWd3qTE1BuIFFRpqER7HYvThPBkJ/gOwjuqZQv5syL\n3+3M4qUvCSqYxAr3Bj2xpPO6ysXdPdJMqU/b/gWuS/VblvXHrMExdA==\n-----END RSA PRIVATE KEY-----`\n\nexport const jsenvPublicKey = `-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA7g8u1+cEfCDTX2aMPkCj\nehz29cJpSqL8DZD7SPvznmXMXY8U/TcIcqN3NtPlAyNIjE/5NiQkPJKtgx06E5J1\neGFQn8yt54E+2eQNNjz0elxkHmmNHwqbD76r6JuIoh/vfNhyw+2jaOO8R+sAJGyw\nu2jFaDtxhho+1xaK1m92zdhu5U3KQMg97xuYx+/ezb4JllFBtcs3/uE2Hg50pWO6\neny1EtEDfnMhE5L42DyMtoHU+ExdF3bGo9FxCq04UFU+ZRCuLUIY/AI8PsMcgcwq\n7n+O0ijylFoatmyudx+VMoHENWALlBdfjALE3K3XPX6s2IzAVAa4CDpmC2aQ3UCE\nlQIDAQAB\n-----END PUBLIC KEY-----`\n\nexport const jsenvCertificate = `-----BEGIN CERTIFICATE-----\nMIIECjCCAvKgAwIBAgIBATANBgkqhkiG9w0BAQsFADCBkTEuMCwGA1UEAxMlaHR0\ncHM6Ly9naXRodWIuY29tL2pzZW52L2pzZW52LXNlcnZlcjELMAkGA1UEBhMCRlIx\nGDAWBgNVBAgTD0FscGVzIE1hcml0aW1lczERMA8GA1UEBxMIVmFsYm9ubmUxDjAM\nBgNVBAoTBWpzZW52MRUwEwYDVQQLEwxqc2VudiBzZXJ2ZXIwHhcNMjAwNTAzMTg0\nNzU0WhcNMjkwNTAzMTg0NzU1WjCBkTEuMCwGA1UEAxMlaHR0cHM6Ly9naXRodWIu\nY29tL2pzZW52L2pzZW52LXNlcnZlcjELMAkGA1UEBhMCRlIxGDAWBgNVBAgTD0Fs\ncGVzIE1hcml0aW1lczERMA8GA1UEBxMIVmFsYm9ubmUxDjAMBgNVBAoTBWpzZW52\nMRUwEwYDVQQLEwxqc2VudiBzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw\nggEKAoIBAQDuDy7X5wR8INNfZow+QKN6HPb1wmlKovwNkPtI+/OeZcxdjxT9Nwhy\no3c20+UDI0iMT/k2JCQ8kq2DHToTknV4YVCfzK3ngT7Z5A02PPR6XGQeaY0fCpsP\nvqvom4iiH+982HLD7aNo47xH6wAkbLC7aMVoO3GGGj7XForWb3bN2G7lTcpAyD3v\nG5jH797NvgmWUUG1yzf+4TYeDnSlY7p6fLUS0QN+cyETkvjYPIy2gdT4TF0Xdsaj\n0XEKrThQVT5lEK4tQhj8Ajw+wxyBzCruf47SKPKUWhq2bK53H5UygcQ1YAuUF1+M\nAsTcrdc9fqzYjMBUBrgIOmYLZpDdQISVAgMBAAGjazBpMB8GA1UdIwQYMBaAFFJJ\nBlTW2Lp6maSe/c6HfH+zee1xMA4GA1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggr\nBgEFBQcDATAhBgNVHREEGjAYhwR/AAABgglsb2NhbGhvc3SCBWpzZW52MA0GCSqG\nSIb3DQEBCwUAA4IBAQCJdOdqU0XBoto/ddAbTRC+qzmIl43w6zsUBO/5zEGDIs6x\nMwOOqMzuKtZ4Qm2hYTFfITRrinU2L3XmGdRdGzHF8V6VpOR1D+BZy0IvJBBW7DTE\nzuaBqQ5qtY1x1qtZdWaWZwexQjGlBdXa+yCWCOHs8amlH8WS6jOfvrD/ECpVbvJQ\nXi+4yFFBeJ4P09Wx4YetDSJWFBL1Y5Q3TnqpyxNYZ3A3r/UolbG/HY0NnOGUA6wg\nMHOw0+Zg5Ls7pHo2bN7n1LseYeIt6M90q8/vRS6VjzWImJswxsdqSCP8TZxVb5S5\np2OCbNpxQVtgLpUgLd9ePT2eX2kRTI8knM+C+e7L\n-----END CERTIFICATE-----`\n",
    "import { applyContentNegotiation } from \"./internal/applyContentNegotiation.js\"\nimport { parseMultipleHeader } from \"./internal/multiple-header.js\"\n\nexport const negotiateContentLanguage = (request, availableLanguages) => {\n  const { headers = {} } = request\n  const requestAcceptLanguageHeader = headers[\"accept-language\"]\n  if (!requestAcceptLanguageHeader) {\n    return null\n  }\n\n  const languagesAccepted = parseAcceptLanguageHeader(requestAcceptLanguageHeader)\n  return applyContentNegotiation({\n    accepteds: languagesAccepted,\n    availables: availableLanguages,\n    getAcceptanceScore: getLanguageAcceptanceScore,\n  })\n}\n\nconst parseAcceptLanguageHeader = (acceptLanguageHeaderString) => {\n  const acceptLanguageHeader = parseMultipleHeader(acceptLanguageHeaderString, {\n    validateProperty: ({ name }) => {\n      // read only q, anything else is ignored\n      return name === \"q\"\n    },\n  })\n\n  const languagesAccepted = []\n  Object.keys(acceptLanguageHeader).forEach((key) => {\n    const { q = 1 } = acceptLanguageHeader[key]\n    const value = key\n    languagesAccepted.push({\n      value,\n      quality: q,\n    })\n  })\n  languagesAccepted.sort((a, b) => {\n    return b.quality - a.quality\n  })\n  return languagesAccepted\n}\n\nconst getLanguageAcceptanceScore = ({ value, quality }, availableLanguage) => {\n  const [acceptedPrimary, acceptedVariant] = decomposeLanguage(value)\n  const [availablePrimary, availableVariant] = decomposeLanguage(availableLanguage)\n\n  const primaryAccepted =\n    acceptedPrimary === \"*\" || acceptedPrimary.toLowerCase() === availablePrimary.toLowerCase()\n  const variantAccepted =\n    acceptedVariant === \"*\" || compareVariant(acceptedVariant, availableVariant)\n\n  if (primaryAccepted && variantAccepted) {\n    return quality + 1\n  }\n  if (primaryAccepted) {\n    return quality\n  }\n  return -1\n}\n\nconst decomposeLanguage = (fullType) => {\n  const [primary, variant] = fullType.split(\"-\")\n  return [primary, variant]\n}\n\nconst compareVariant = (left, right) => {\n  if (left === right) {\n    return true\n  }\n  if (left && right && left.toLowerCase() === right.toLowerCase()) {\n    return true\n  }\n  return false\n}\n",
    "export const urlToSearchParamValue = (url, searchParamName) => {\n  return new URL(url).searchParams.get(searchParamName)\n}\n",
    "export const readRequestBody = (request, { as = \"string\" } = {}) => {\n  return new Promise((resolve, reject) => {\n    const bufferArray = []\n    request.body.subscribe({\n      error: reject,\n      next: (buffer) => {\n        bufferArray.push(buffer)\n      },\n      complete: () => {\n        const bodyAsBuffer = Buffer.concat(bufferArray)\n\n        if (as === \"buffer\") {\n          resolve(bodyAsBuffer)\n          return\n        }\n\n        if (as === \"string\") {\n          const bodyAsString = bodyAsBuffer.toString()\n          resolve(bodyAsString)\n          return\n        }\n\n        if (as === \"json\") {\n          const bodyAsString = bodyAsBuffer.toString()\n          const bodyAsJSON = JSON.parse(bodyAsString)\n          resolve(bodyAsJSON)\n          return\n        }\n      },\n    })\n  })\n}\n",
    "export const createTracker = () => {\n  const callbackArray = []\n\n  const registerCleanupCallback = (callback) => {\n    if (typeof callback !== \"function\")\n      throw new TypeError(`callback must be a function\ncallback: ${callback}`)\n    callbackArray.push(callback)\n  }\n\n  const cleanup = async (reason) => {\n    const localCallbackArray = callbackArray.slice()\n    await Promise.all(localCallbackArray.map((callback) => callback(reason)))\n  }\n\n  return { registerCleanupCallback, cleanup }\n}\n",
    "export const createServer = async ({ http2, http1Allowed, protocol, privateKey, certificate }) => {\n  if (protocol === \"http\") {\n    if (http2) {\n      const { createServer } = await import(\"http2\")\n      return createServer()\n    }\n\n    const { createServer } = await import(\"http\")\n    return createServer()\n  }\n\n  if (protocol === \"https\") {\n    if (http2) {\n      const { createSecureServer } = await import(\"http2\")\n      return createSecureServer({\n        key: privateKey,\n        cert: certificate,\n        allowHTTP1: http1Allowed,\n      })\n    }\n\n    const { createServer } = await import(\"https\")\n    return createServer({\n      key: privateKey,\n      cert: certificate,\n    })\n  }\n\n  throw new Error(`unsupported protocol ${protocol}`)\n}\n",
    "export const trackServerPendingConnections = (nodeServer, { http2, onConnectionError }) => {\n  if (http2) {\n    // see http2.js: we rely on https://nodejs.org/api/http2.html#http2_compatibility_api\n    return trackHttp1ServerPendingConnections(nodeServer, { onConnectionError })\n  }\n  return trackHttp1ServerPendingConnections(nodeServer, { onConnectionError })\n}\n\n// const trackHttp2ServerPendingSessions = () => {}\n\nconst trackHttp1ServerPendingConnections = (nodeServer, { onConnectionError }) => {\n  const pendingConnections = new Set()\n\n  const connectionListener = (connection) => {\n    connection.on(\"close\", () => {\n      pendingConnections.delete(connection)\n    })\n    if (onConnectionError) {\n      connection.on(\"error\", (error) => {\n        onConnectionError(error, connection)\n      })\n    }\n    pendingConnections.add(connection)\n  }\n\n  nodeServer.on(\"connection\", connectionListener)\n\n  const stop = async (reason) => {\n    nodeServer.removeListener(\"connection\", connectionListener)\n\n    await Promise.all(\n      Array.from(pendingConnections).map((pendingConnection) => {\n        return new Promise((resolve, reject) => {\n          pendingConnection.destroy(reason, (error) => {\n            if (error) {\n              if (error === reason || error.code === \"ENOTCONN\") {\n                resolve()\n              } else {\n                reject(error)\n              }\n            } else {\n              resolve()\n            }\n          })\n        })\n      }),\n    )\n  }\n\n  return { stop }\n}\n",
    "export const trackServerPendingRequests = (nodeServer, { http2 }) => {\n  if (http2) {\n    // see http2.js: we rely on https://nodejs.org/api/http2.html#http2_compatibility_api\n    return trackHttp1ServerPendingRequests(nodeServer)\n  }\n  return trackHttp1ServerPendingRequests(nodeServer)\n}\n\n// const trackHttp2ServerPendingStreams = () => {}\n\nconst trackHttp1ServerPendingRequests = (nodeServer) => {\n  const pendingClients = new Set()\n\n  const requestListener = (nodeRequest, nodeResponse) => {\n    const client = { nodeRequest, nodeResponse }\n\n    pendingClients.add(client)\n    nodeResponse.once(\"close\", () => {\n      pendingClients.delete(client)\n    })\n  }\n\n  nodeServer.on(\"request\", requestListener)\n\n  const stop = ({ status, reason }) => {\n    nodeServer.removeListener(\"request\", requestListener)\n\n    return Promise.all(\n      Array.from(pendingClients).map(({ nodeResponse }) => {\n        if (nodeResponse.headersSent === false) {\n          nodeResponse.writeHead(status, String(reason))\n        }\n\n        // http2\n        if (nodeResponse.close) {\n          return new Promise((resolve, reject) => {\n            if (nodeResponse.closed) {\n              resolve()\n            } else {\n              nodeResponse.close((error) => {\n                if (error) {\n                  reject(error)\n                } else {\n                  resolve()\n                }\n              })\n            }\n          })\n        }\n\n        // http\n        return new Promise((resolve) => {\n          if (nodeResponse.destroyed) {\n            resolve()\n          } else {\n            nodeResponse.once(\"close\", () => {\n              resolve()\n            })\n            nodeResponse.destroy()\n          }\n        })\n      }),\n    )\n  }\n\n  return { stop }\n}\n",
    "// https://github.com/jamestalmage/stream-to-observable/blob/master/index.js\n\nimport { createObservable } from \"./observable.js\"\n\nexport const nodeStreamToObservable = (nodeStream) => {\n  return createObservable({\n    subscribe: ({ next, error, complete }) => {\n      // should we do nodeStream.resume() in case the stream was paused ?\n      nodeStream.on(\"data\", next)\n      nodeStream.once(\"error\", error)\n      nodeStream.once(\"end\", complete)\n\n      const unsubscribe = () => {\n        nodeStream.removeListener(\"data\", next)\n        nodeStream.removeListener(\"error\", error)\n        nodeStream.removeListener(\"end\", complete)\n\n        if (typeof nodeStream.abort === \"function\") {\n          nodeStream.abort()\n        } else {\n          nodeStream.destroy()\n        }\n      }\n\n      if (typeof nodeStream.once === \"function\") {\n        nodeStream.once(\"abort\", unsubscribe)\n      }\n\n      return {\n        unsubscribe,\n      }\n    },\n  })\n}\n",
    "export const normalizeHeaderName = (headerName) => {\n  headerName = String(headerName)\n  if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(headerName)) {\n    throw new TypeError(\"Invalid character in header field name\")\n  }\n\n  return headerName.toLowerCase()\n}\n",
    "export const normalizeHeaderValue = (headerValue) => {\n  return String(headerValue)\n}\n",
    "/*\nhttps://developer.mozilla.org/en-US/docs/Web/API/Headers\nhttps://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\n*/\n\nimport { normalizeHeaderName } from \"./normalizeHeaderName.js\"\nimport { normalizeHeaderValue } from \"./normalizeHeaderValue.js\"\n\nexport const headersFromObject = (headersObject) => {\n  const headers = {}\n\n  Object.keys(headersObject).forEach((headerName) => {\n    if (headerName[0] === \":\") {\n      // exclude http2 headers\n      return\n    }\n    headers[normalizeHeaderName(headerName)] = normalizeHeaderValue(headersObject[headerName])\n  })\n\n  return headers\n}\n",
    "import { composeCancellationToken, createCancellationSource } from \"@jsenv/cancellation\"\nimport { nodeStreamToObservable } from \"./nodeStreamToObservable.js\"\nimport { headersFromObject } from \"./headersFromObject.js\"\n\nexport const nodeRequestToRequest = (nodeRequest, { serverCancellationToken, serverOrigin }) => {\n  const { method } = nodeRequest\n  const { url: ressource } = nodeRequest\n  const headers = headersFromObject(nodeRequest.headers)\n  const body =\n    method === \"POST\" || method === \"PUT\" || method === \"PATCH\"\n      ? nodeStreamToObservable(nodeRequest)\n      : undefined\n\n  let requestOrigin\n  if (nodeRequest.authority) {\n    requestOrigin = nodeRequest.connection.encrypted\n      ? `https://${nodeRequest.authority}`\n      : `http://${nodeRequest.authority}`\n  } else if (nodeRequest.headers.host) {\n    requestOrigin = nodeRequest.connection.encrypted\n      ? `https://${nodeRequest.headers.host}`\n      : `http://${nodeRequest.headers.host}`\n  } else {\n    requestOrigin = serverOrigin\n  }\n\n  return Object.freeze({\n    // the node request is considered as cancelled if client cancels or server cancels.\n    // in case of server cancellation from a client perspective request is not cancelled\n    // because client still wants a response. But from a server perspective the production\n    // of a response for this request is cancelled\n    cancellationToken: composeCancellationToken(\n      serverCancellationToken,\n      nodeRequestToCancellationToken(nodeRequest),\n    ),\n    origin: requestOrigin,\n    ressource,\n    method,\n    headers,\n    body,\n  })\n}\n\nconst nodeRequestToCancellationToken = (nodeRequest) => {\n  const { cancel, token } = createCancellationSource()\n  nodeRequest.on(\"abort\", () => {\n    cancel(\"request aborted\")\n  })\n  nodeRequest.on(\"close\", () => {\n    cancel(\"request closed\")\n  })\n  return token\n}\n",
    "import { createObservable } from \"./observable.js\"\n\nexport const valueToObservable = (value) => {\n  return createObservable({\n    subscribe: ({ next, complete }) => {\n      next(value)\n      const timer = setTimeout(() => {\n        complete()\n      })\n      return {\n        unsubscribe: () => {\n          clearTimeout(timer)\n        },\n      }\n    },\n  })\n}\n",
    "import { Stream, Writable, Readable } from \"stream\"\nimport { isObservable, subscribe } from \"./observable.js\"\nimport { nodeStreamToObservable } from \"./nodeStreamToObservable.js\"\nimport { valueToObservable } from \"./valueToObservable.js\"\n\nexport const populateNodeResponse = (\n  nodeResponse,\n  { status, statusText, headers, body, bodyEncoding },\n  { cancellationToken, ignoreBody, ignoreStatusText, ignoreConnectionHeader } = {},\n) => {\n  const nodeHeaders = headersToNodeHeaders(headers, { ignoreConnectionHeader })\n  // nodejs strange signature for writeHead force this\n  // https://nodejs.org/api/http.html#http_response_writehead_statuscode_statusmessage_headers\n  if (statusText === undefined || ignoreStatusText) {\n    nodeResponse.writeHead(status, nodeHeaders)\n  } else {\n    nodeResponse.writeHead(status, statusText, nodeHeaders)\n  }\n  if (ignoreBody) {\n    nodeResponse.end()\n    return\n  }\n\n  if (bodyEncoding) {\n    nodeResponse.setEncoding(bodyEncoding)\n  }\n\n  const observable = bodyToObservable(body)\n  const subscription = subscribe(observable, {\n    next: (data) => {\n      try {\n        nodeResponse.write(data)\n      } catch (e) {\n        // Something inside Node.js sometimes puts stream\n        // in a state where .write() throw despites nodeResponse.destroyed\n        // being undefined and \"close\" event not being emitted.\n        // I have tested if we are the one calling destroy\n        // (I have commented every .destroy() call)\n        // but issue still occurs\n        // For the record it's \"hard\" to reproduce but can be by running\n        // a lot of tests against a browser in the context of @jsenv/core testing\n        if (e.code === \"ERR_HTTP2_INVALID_STREAM\") {\n          return\n        }\n        throw e\n      }\n    },\n    error: (value) => {\n      nodeResponse.emit(\"error\", value)\n    },\n    complete: () => {\n      nodeResponse.end()\n    },\n  })\n  const cancellation = cancellationToken.register(() => {\n    cancellation.unregister()\n    subscription.unsubscribe()\n    nodeResponse.destroy()\n  })\n  nodeResponse.once(\"close\", () => {\n    cancellation.unregister()\n    // close body in case nodeResponse is prematurely closed\n    // while body is writing\n    // it may happen in case of server sent event\n    // where body is kept open to write to client\n    // and the browser is reloaded or closed for instance\n    subscription.unsubscribe()\n  })\n}\n\nconst mapping = {\n  // \"content-type\": \"Content-Type\",\n  // \"last-modified\": \"Last-Modified\",\n}\n\nconst headersToNodeHeaders = (headers, { ignoreConnectionHeader }) => {\n  const nodeHeaders = {}\n\n  Object.keys(headers).forEach((name) => {\n    if (name === \"connection\" && ignoreConnectionHeader) return\n    const nodeHeaderName = name in mapping ? mapping[name] : name\n    nodeHeaders[nodeHeaderName] = headers[name]\n  })\n\n  return nodeHeaders\n}\n\nconst bodyToObservable = (body) => {\n  if (isObservable(body)) return body\n  if (isNodeStream(body)) return nodeStreamToObservable(body)\n  return valueToObservable(body)\n}\n\nconst isNodeStream = (value) => {\n  if (value === undefined) return false\n  if (value instanceof Stream) return true\n  if (value instanceof Writable) return true\n  if (value instanceof Readable) return true\n  return false\n}\n",
    "// https://github.com/Marak/colors.js/blob/b63ef88e521b42920a9e908848de340b31e68c9d/lib/styles.js#L29\n\nconst close = \"\\x1b[0m\"\nconst red = \"\\x1b[31m\"\nconst green = \"\\x1b[32m\"\nconst yellow = \"\\x1b[33m\"\n// const blue = \"\\x1b[34m\"\nconst magenta = \"\\x1b[35m\"\nconst cyan = \"\\x1b[36m\"\n// const white = \"\\x1b[37m\"\n\nexport const colorizeResponseStatus = (status) => {\n  const statusType = statusToType(status)\n\n  if (statusType === \"information\") return `${cyan}${status}${close}`\n  if (statusType === \"success\") return `${green}${status}${close}`\n  if (statusType === \"redirection\") return `${magenta}${status}${close}`\n  if (statusType === \"client-error\") return `${yellow}${status}${close}`\n  if (statusType === \"server-error\") return `${red}${status}${close}`\n  return status\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status\nconst statusToType = (status) => {\n  if (statusIsInformation(status)) return \"information\"\n  if (statusIsSuccess(status)) return \"success\"\n  if (statusIsRedirection(status)) return \"redirection\"\n  if (statusIsClientError(status)) return \"client-error\"\n  if (statusIsServerError(status)) return \"server-error\"\n  return \"unknown\"\n}\n\nconst statusIsInformation = (status) => status >= 100 && status < 200\n\nconst statusIsSuccess = (status) => status >= 200 && status < 300\n\nconst statusIsRedirection = (status) => status >= 300 && status < 400\n\nconst statusIsClientError = (status) => status >= 400 && status < 500\n\nconst statusIsServerError = (status) => status >= 500 && status < 600\n",
    "import { networkInterfaces } from \"os\"\nimport { URL } from \"url\"\n\nexport const getServerOrigins = ({ protocol, ip, port }) => {\n  return {\n    main: createServerOrigin({ protocol, ip, port }),\n    external: createServerOrigin({ protocol, ip: getExternalIp(ip), port }),\n  }\n}\n\nconst createServerOrigin = ({ protocol, ip, port }) => {\n  const url = new URL(\"https://127.0.0.1:80\")\n\n  url.protocol = protocol\n  url.hostname = ipToHostname(ip)\n  url.port = port\n\n  return url.origin\n}\n\nconst ipToHostname = (\n  ip,\n  { preferLocalhost = true, preferLocalIp = false, preferExternalIp = false } = {},\n) => {\n  if (ip === \"0.0.0.0\" || !ip) {\n    if (preferLocalhost) return \"localhost\"\n    if (preferLocalIp) return \"127.0.0.1\"\n    if (preferExternalIp) return getExternalIp(ip) || \"0.0.0.0\"\n    return \"0.0.0.0\"\n  }\n  return ip\n}\n\nconst getExternalIp = () => {\n  const networkInterfaceMap = networkInterfaces()\n  let internalIPV4NetworkAddress\n\n  Object.keys(networkInterfaceMap).find((key) => {\n    const networkAddressArray = networkInterfaceMap[key]\n    return networkAddressArray.find((networkAddress) => {\n      if (networkAddress.internal) return false\n      if (networkAddress.family !== \"IPv4\") return false\n      internalIPV4NetworkAddress = networkAddress\n      return true\n    })\n  })\n\n  return internalIPV4NetworkAddress ? internalIPV4NetworkAddress.address : null\n}\n",
    "const createReason = (reasonString) => {\n  return {\n    toString: () => reasonString,\n  }\n}\n\nexport const STOP_REASON_INTERNAL_ERROR = createReason(\"Internal error\")\nexport const STOP_REASON_PROCESS_SIGHUP = createReason(\"process SIGHUP\")\nexport const STOP_REASON_PROCESS_SIGTERM = createReason(\"process SIGTERM\")\nexport const STOP_REASON_PROCESS_SIGINT = createReason(\"process SIGINT\")\nexport const STOP_REASON_PROCESS_BEFORE_EXIT = createReason(\"process before exit\")\nexport const STOP_REASON_PROCESS_EXIT = createReason(\"process exit\")\nexport const STOP_REASON_NOT_SPECIFIED = createReason(\"not specified\")\n",
    "export const trackServerRequest = (nodeServer, fn, { http2 }) => {\n  if (http2) {\n    // see http2.js: we rely on https://nodejs.org/api/http2.html#http2_compatibility_api\n    return trackHttp1ServerRequest(nodeServer, fn)\n  }\n  return trackHttp1ServerRequest(nodeServer, fn)\n}\n\n// const trackHttp2ServerRequest = (nodeServer, fn) => {\n//   nodeServer.on(\"stream\", fn)\n//   return () => {\n//     nodeServer.removeListener(\"stream\", fn)\n//   }\n// }\n\nconst trackHttp1ServerRequest = (nodeServer, fn) => {\n  nodeServer.on(\"request\", fn)\n  return () => {\n    nodeServer.removeListener(\"request\", fn)\n  }\n}\n",
    "import { negotiateContentType } from \"../negotiateContentType.js\"\nimport { negotiateContentLanguage } from \"../negotiateContentLanguage.js\"\nimport { negotiateContentEncoding } from \"../negotiateContentEncoding.js\"\n\nexport const checkContentNegotiation = (request, response, { warn }) => {\n  const requestAcceptHeader = request.headers.accept\n  const responseContentTypeHeader = response.headers[\"content-type\"]\n  if (\n    requestAcceptHeader &&\n    responseContentTypeHeader &&\n    !negotiateContentType(request, [responseContentTypeHeader])\n  ) {\n    warn(`response content type is not in the request accepted content types.\n--- response content-type header ---\n${responseContentTypeHeader}\n--- request accept header ---\n${requestAcceptHeader}`)\n  }\n\n  const requestAcceptLanguageHeader = request.headers[\"accept-language\"]\n  const responseContentLanguageHeader = response.headers[\"content-language\"]\n  if (\n    requestAcceptLanguageHeader &&\n    responseContentLanguageHeader &&\n    !negotiateContentLanguage(request, [responseContentLanguageHeader])\n  ) {\n    warn(`response language is not in the request accepted language.\n--- response content-language header ---\n${responseContentLanguageHeader}\n--- request accept-language header ---\n${requestAcceptLanguageHeader}`)\n  }\n\n  const requestAcceptEncodingHeader = request.headers[\"accept-encoding\"]\n  const responseContentEncodingHeader = response.headers[\"content-encoding\"]\n  if (\n    requestAcceptLanguageHeader &&\n    responseContentLanguageHeader &&\n    !negotiateContentEncoding(request, [responseContentLanguageHeader])\n  ) {\n    warn(`response encoding is not in the request accepted encoding.\n--- response content-encoding header ---\n${responseContentEncodingHeader}\n--- request accept-encoding header ---\n${requestAcceptEncodingHeader}`)\n  }\n}\n",
    "/* eslint-disable import/max-dependencies */\n\nimport { createRequire } from \"module\"\nimport { STATUS_CODES } from \"http\"\nimport {\n  createCancellationToken,\n  createOperation,\n  createStoppableOperation,\n  composeCancellationToken,\n  createCancellationSource,\n  isCancelError,\n  executeAsyncFunction,\n} from \"@jsenv/cancellation\"\nimport { SIGINTSignal, unadvisedCrashSignal, teardownSignal } from \"@jsenv/node-signals\"\nimport { memoize, urlToOrigin } from \"@jsenv/util\"\nimport { createLogger } from \"@jsenv/logger\"\nimport { createTracker } from \"./internal/createTracker.js\"\nimport { createServer } from \"./internal/createServer.js\"\nimport { trackServerPendingConnections } from \"./internal/trackServerPendingConnections.js\"\nimport { trackServerPendingRequests } from \"./internal/trackServerPendingRequests.js\"\nimport { nodeRequestToRequest } from \"./internal/nodeRequestToRequest.js\"\nimport { composeResponseHeaders } from \"./internal/composeResponseHeaders.js\"\nimport { populateNodeResponse } from \"./internal/populateNodeResponse.js\"\nimport { colorizeResponseStatus } from \"./internal/colorizeResponseStatus.js\"\nimport { getServerOrigins } from \"./internal/getServerOrigins.js\"\nimport { listen, stopListening } from \"./internal/listen.js\"\nimport { composeResponse } from \"./composeResponse.js\"\nimport {\n  STOP_REASON_INTERNAL_ERROR,\n  STOP_REASON_PROCESS_SIGHUP,\n  STOP_REASON_PROCESS_SIGTERM,\n  STOP_REASON_PROCESS_SIGINT,\n  STOP_REASON_PROCESS_BEFORE_EXIT,\n  STOP_REASON_PROCESS_EXIT,\n  STOP_REASON_NOT_SPECIFIED,\n} from \"./stopReasons.js\"\nimport { jsenvAccessControlAllowedHeaders } from \"./jsenvAccessControlAllowedHeaders.js\"\nimport { jsenvAccessControlAllowedMethods } from \"./jsenvAccessControlAllowedMethods.js\"\nimport { jsenvPrivateKey, jsenvCertificate } from \"./jsenvSignature.js\"\nimport { findFreePort } from \"./findFreePort.js\"\nimport { trackServerRequest } from \"./internal/trackServerRequest.js\"\nimport { timeFunction, timingToServerTimingResponseHeaders } from \"./serverTiming.js\"\nimport { jsenvServerInternalErrorToResponse } from \"./jsenvServerInternalErrorToResponse.js\"\nimport { checkContentNegotiation } from \"./internal/checkContentNegotiation.js\"\n\nconst require = createRequire(import.meta.url)\nconst killPort = require(\"kill-port\")\n\nexport const startServer = async ({\n  cancellationToken = createCancellationToken(),\n  logLevel,\n  serverName = \"server\",\n\n  protocol = \"http\",\n  http2 = false,\n  http1Allowed = true,\n  redirectHttpToHttps,\n  ip = \"0.0.0.0\", // will it work on windows ? https://github.com/nodejs/node/issues/14900\n  port = 0, // assign a random available port\n  portHint,\n  forcePort = false,\n  privateKey = jsenvPrivateKey,\n  certificate = jsenvCertificate,\n\n  stopOnSIGINT = true,\n  // auto close the server when the process exits\n  stopOnExit = true,\n  // auto close when requestToResponse throw an error\n  stopOnInternalError = false,\n  // auto close the server when an uncaughtException happens\n  stopOnCrash = false,\n  keepProcessAlive = true,\n  requestToResponse = () => null,\n\n  accessControlAllowedOrigins = [],\n  accessControlAllowedMethods = jsenvAccessControlAllowedMethods,\n  accessControlAllowedHeaders = jsenvAccessControlAllowedHeaders,\n  accessControlAllowRequestOrigin = false,\n  accessControlAllowRequestMethod = false,\n  accessControlAllowRequestHeaders = false,\n  accessControlAllowCredentials = false,\n  // by default OPTIONS request can be cache for a long time, it's not going to change soon ?\n  // we could put a lot here, see https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Max-Age\n  accessControlMaxAge = 600,\n\n  // https://www.w3.org/TR/server-timing/\n  sendServerTiming = false,\n  sendServerInternalErrorDetails = false,\n  serverInternalErrorToResponse = jsenvServerInternalErrorToResponse,\n\n  requestWaitingMs = 20000,\n  requestWaitingCallback = (request, { logger }) => {\n    logger.warn(\n      `still no response found for request after ${requestWaitingMs} ms\n--- request url ---\n${request.origin}${request.ressource}\n--- request headers ---\n${JSON.stringify(request.headers, null, \"  \")}\n`,\n    )\n  },\n  contentNegotiationWarnings = true,\n\n  startedCallback = () => {},\n  stoppedCallback = () => {},\n  errorIsCancellation = () => false,\n  nagle = true,\n} = {}) => {\n  return executeAsyncFunction(async () => {\n    if (port === 0 && forcePort) {\n      throw new Error(`no need to pass forcePort when port is 0`)\n    }\n    if (protocol !== \"http\" && protocol !== \"https\") {\n      throw new Error(`protocol must be http or https, got ${protocol}`)\n    }\n    if (protocol === \"https\") {\n      if (!privateKey) {\n        throw new Error(`missing privateKey for https server`)\n      }\n      if (!certificate) {\n        throw new Error(`missing certificate for https server`)\n      }\n      if (privateKey !== jsenvPrivateKey && certificate === jsenvCertificate) {\n        throw new Error(`you passed a privateKey without certificate`)\n      }\n      if (certificate !== jsenvCertificate && privateKey === jsenvPrivateKey) {\n        throw new Error(`you passed a certificate without privateKey`)\n      }\n    }\n    if (http2 && protocol !== \"https\") {\n      throw new Error(`http2 needs \"https\" but protocol is \"${protocol}\"`)\n    }\n\n    const logger = createLogger({ logLevel })\n    if (redirectHttpToHttps === undefined && protocol === \"https\" && !http2) {\n      redirectHttpToHttps = true\n    }\n    if (redirectHttpToHttps && protocol === \"http\") {\n      logger.warn(`redirectHttpToHttps ignored because protocol is http`)\n      redirectHttpToHttps = false\n    }\n    if (redirectHttpToHttps && http2) {\n      logger.warn(\n        `redirectHttpToHttps ignored because it does not work with http2. see https://github.com/nodejs/node/issues/23331`,\n      )\n      redirectHttpToHttps = false\n    }\n\n    const internalCancellationSource = createCancellationSource()\n    const externalCancellationToken = cancellationToken\n    const internalCancellationToken = internalCancellationSource.token\n    const serverCancellationToken = composeCancellationToken(\n      externalCancellationToken,\n      internalCancellationToken,\n    )\n\n    const onError = (error) => {\n      if (errorIsCancellation(error)) {\n        return\n      }\n      throw error\n    }\n    errorIsCancellation = composePredicate(errorIsCancellation, isCancelError)\n\n    const { registerCleanupCallback, cleanup } = createTracker()\n\n    if (stopOnCrash) {\n      const unregister = unadvisedCrashSignal.addCallback((reason) => {\n        internalCancellationSource.cancel(reason.value)\n      })\n      registerCleanupCallback(unregister)\n    }\n\n    if (stopOnExit) {\n      const unregister = teardownSignal.addCallback((tearDownReason) => {\n        if (!stopOnSIGINT && tearDownReason === \"SIGINT\") {\n          return\n        }\n\n        internalCancellationSource.cancel(\n          {\n            SIGHUP: STOP_REASON_PROCESS_SIGHUP,\n            SIGTERM: STOP_REASON_PROCESS_SIGTERM,\n            SIGINT: STOP_REASON_PROCESS_SIGINT,\n            beforeExit: STOP_REASON_PROCESS_BEFORE_EXIT,\n            exit: STOP_REASON_PROCESS_EXIT,\n          }[tearDownReason],\n        )\n      })\n      registerCleanupCallback(unregister)\n    } else if (stopOnSIGINT) {\n      const unregister = SIGINTSignal.addCallback(() => {\n        internalCancellationSource.cancel(STOP_REASON_PROCESS_SIGINT)\n      })\n      registerCleanupCallback(unregister)\n    }\n\n    if (forcePort) {\n      await createOperation({\n        cancellationToken: serverCancellationToken,\n        start: () => killPort(port),\n      })\n    }\n\n    const nodeServer = await createServer({\n      http2,\n      http1Allowed,\n      protocol,\n      privateKey,\n      certificate,\n    })\n\n    // https://nodejs.org/api/net.html#net_server_unref\n    if (!keepProcessAlive) {\n      nodeServer.unref()\n    }\n\n    let status = \"starting\"\n\n    let stoppedResolve\n    const stoppedPromise = new Promise((resolve) => {\n      stoppedResolve = resolve\n    })\n    const stop = memoize(async (reason = STOP_REASON_NOT_SPECIFIED) => {\n      status = \"stopping\"\n\n      errorIsCancellation = composePredicate(errorIsCancellation, (error) => error === reason)\n      errorIsCancellation = composePredicate(\n        errorIsCancellation,\n        (error) => error && error.code === \"ECONNRESET\",\n      )\n      logger.info(`${serverName} stopped because ${reason}`)\n\n      await cleanup(reason)\n      await stopListening(nodeServer)\n      status = \"stopped\"\n      stoppedCallback({ reason })\n      stoppedResolve(reason)\n    })\n    serverCancellationToken.register(stop)\n    const startOperation = createStoppableOperation({\n      cancellationToken: serverCancellationToken,\n      start: async () => {\n        if (portHint) {\n          port = await findFreePort(portHint, { cancellationToken: serverCancellationToken, ip })\n        }\n        return listen({\n          cancellationToken: serverCancellationToken,\n          server: nodeServer,\n          port,\n          ip,\n        })\n      },\n      stop: (_, reason) => stop(reason),\n    })\n\n    port = await startOperation\n    status = \"opened\"\n    const serverOrigins = getServerOrigins({ protocol, ip, port })\n    const serverOrigin = serverOrigins.main\n\n    const connectionsTracker = trackServerPendingConnections(nodeServer, {\n      http2,\n      onConnectionError: (error, connection) => {\n        if (!connection.destroyed) {\n          onError(error)\n        }\n      },\n    })\n    // opened connection must be shutdown before the close event is emitted\n    registerCleanupCallback(connectionsTracker.stop)\n\n    const pendingRequestsTracker = trackServerPendingRequests(nodeServer, { http2 })\n    // ensure pending requests got a response from the server\n    registerCleanupCallback((reason) => {\n      pendingRequestsTracker.stop({\n        status: reason === STOP_REASON_INTERNAL_ERROR ? 500 : 503,\n        reason,\n      })\n    })\n\n    const requestCallback = async (nodeRequest, nodeResponse) => {\n      if (!nagle) {\n        nodeRequest.connection.setNoDelay(true)\n      }\n      if (redirectHttpToHttps && !nodeRequest.connection.encrypted) {\n        nodeResponse.writeHead(301, {\n          location: `${serverOrigin}${nodeRequest.ressource}`,\n        })\n        return\n      }\n\n      const request = nodeRequestToRequest(nodeRequest, { serverCancellationToken, serverOrigin })\n      nodeRequest.on(\"error\", (error) => {\n        logger.error(`error on request.\n--- request ressource ---\n${request.ressource}\n--- error stack ---\n${error.stack}`)\n      })\n\n      const [\n        startRespondingTiming,\n        { response, error },\n      ] = await timeFunction(\"time to start responding\", () => generateResponseDescription(request))\n      if (sendServerTiming) {\n        const serverTiming = {\n          ...response.timing,\n          ...startRespondingTiming,\n        }\n        response.headers = composeResponseHeaders(\n          timingToServerTimingResponseHeaders(serverTiming),\n          response.headers,\n        )\n\n        if (contentNegotiationWarnings) {\n          checkContentNegotiation(request, response, { warn: logger.warn })\n        }\n      }\n\n      logger.info(`${request.method} ${request.origin}${request.ressource}`)\n\n      if (error && isCancelError(error) && internalCancellationToken.cancellationRequested) {\n        logger.info(\"ignored because server closing\")\n        nodeResponse.destroy()\n        return\n      }\n\n      if (error && isCancelError(error) && request.cancellationToken.cancellationRequested) {\n        logger.info(\"ignored because request canceled\")\n        nodeResponse.destroy()\n        return\n      }\n\n      if (request.aborted) {\n        logger.info(`request aborted by client`)\n        nodeResponse.destroy()\n        return\n      }\n\n      if (\n        request.method !== \"HEAD\" &&\n        response.headers[\"content-length\"] > 0 &&\n        response.body === \"\"\n      ) {\n        logger.warn(\n          `content-length header is ${response.headers[\"content-length\"]} but body is empty`,\n        )\n      }\n\n      if (error) {\n        logger.error(`internal error while handling request.\n--- error stack ---\n${error.stack}\n--- request ---\n${request.method} ${request.origin}${request.ressource}`)\n      }\n      logger.info(`${colorizeResponseStatus(response.status)} ${response.statusText}`)\n\n      populateNodeResponse(nodeResponse, response, {\n        cancellationToken: request.cancellationToken,\n        ignoreBody: request.method === \"HEAD\",\n        // https://github.com/nodejs/node/blob/79296dc2d02c0b9872bbfcbb89148ea036a546d0/lib/internal/http2/compat.js#L97\n        ignoreStatusText: Boolean(nodeRequest.stream),\n        // https://github.com/nodejs/node/blob/79296dc2d02c0b9872bbfcbb89148ea036a546d0/lib/internal/http2/compat.js#L112\n        ignoreConnectionHeader: Boolean(nodeRequest.stream),\n      })\n\n      if (\n        stopOnInternalError &&\n        // stopOnInternalError stops server only if requestToResponse generated\n        // a non controlled error (internal error).\n        // if requestToResponse gracefully produced a 500 response (it did not throw)\n        // then we can assume we are still in control of what we are doing\n        error\n      ) {\n        // il faudrais pouvoir stop que les autres response ?\n        stop(STOP_REASON_INTERNAL_ERROR)\n      }\n    }\n\n    const removeRequestListener = trackServerRequest(nodeServer, requestCallback, { http2 })\n    // ensure we don't try to handle new requests while server is stopping\n    registerCleanupCallback(removeRequestListener)\n\n    logger.info(`${serverName} started at ${serverOrigin} (${serverOrigins.external})`)\n    startedCallback({ origin: serverOrigin })\n\n    const corsEnabled = accessControlAllowRequestOrigin || accessControlAllowedOrigins.length\n    // here we check access control options to throw or warn if we find strange values\n\n    const generateResponseDescription = async (request) => {\n      const responsePropertiesToResponse = ({\n        status = 501,\n        statusText = statusToStatusText(status),\n        headers = {},\n        body = \"\",\n        bodyEncoding,\n        timing,\n      }) => {\n        if (corsEnabled) {\n          const accessControlHeaders = generateAccessControlHeaders({\n            request,\n            accessControlAllowedOrigins,\n            accessControlAllowRequestOrigin,\n            accessControlAllowedMethods,\n            accessControlAllowRequestMethod,\n            accessControlAllowedHeaders,\n            accessControlAllowRequestHeaders,\n            accessControlAllowCredentials,\n            accessControlMaxAge,\n            sendServerTiming,\n          })\n\n          return {\n            status,\n            statusText,\n            headers: composeResponseHeaders(headers, accessControlHeaders),\n            body,\n            bodyEncoding,\n            timing,\n          }\n        }\n\n        return {\n          status,\n          statusText,\n          headers,\n          body,\n          bodyEncoding,\n          timing,\n        }\n      }\n\n      let timeout\n      try {\n        if (corsEnabled && request.method === \"OPTIONS\") {\n          return {\n            response: responsePropertiesToResponse({\n              status: 200,\n              headers: {\n                \"content-length\": 0,\n              },\n            }),\n          }\n        }\n\n        timeout = setTimeout(\n          () => requestWaitingCallback(request, { logger, requestWaitingMs }),\n          requestWaitingMs,\n        )\n\n        const responseProperties = await requestToResponse(request)\n        clearTimeout(timeout)\n        return {\n          response: responsePropertiesToResponse(responseProperties || {}),\n        }\n      } catch (error) {\n        clearTimeout(timeout)\n        return {\n          response: composeResponse(\n            responsePropertiesToResponse({\n              status: 500,\n              headers: {\n                // ensure error are not cached\n                \"cache-control\": \"no-store\",\n                \"content-type\": \"text/plain\",\n              },\n            }),\n            await serverInternalErrorToResponse(error, {\n              request,\n              sendServerInternalErrorDetails,\n            }),\n          ),\n          error,\n        }\n      }\n    }\n\n    return {\n      getStatus: () => status,\n      origin: serverOrigin,\n      nodeServer,\n      stop,\n      stoppedPromise,\n    }\n  })\n}\n\nconst statusToStatusText = (status) => STATUS_CODES[status] || \"not specified\"\n\n// https://www.w3.org/TR/cors/\n// https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\nconst generateAccessControlHeaders = ({\n  request: { headers },\n  accessControlAllowedOrigins,\n  accessControlAllowRequestOrigin,\n  accessControlAllowedMethods,\n  accessControlAllowRequestMethod,\n  accessControlAllowedHeaders,\n  accessControlAllowRequestHeaders,\n  accessControlAllowCredentials,\n  // by default OPTIONS request can be cache for a long time, it's not going to change soon ?\n  // we could put a lot here, see https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Max-Age\n  accessControlMaxAge = 600,\n  sendServerTiming,\n} = {}) => {\n  const vary = []\n\n  const allowedOriginArray = [...accessControlAllowedOrigins]\n  if (accessControlAllowRequestOrigin) {\n    if (\"origin\" in headers && headers.origin !== \"null\") {\n      allowedOriginArray.push(headers.origin)\n      vary.push(\"origin\")\n    } else if (\"referer\" in headers) {\n      allowedOriginArray.push(urlToOrigin(headers.referer))\n      vary.push(\"referer\")\n    } else {\n      allowedOriginArray.push(\"*\")\n    }\n  }\n\n  const allowedMethodArray = [...accessControlAllowedMethods]\n  if (accessControlAllowRequestMethod && \"access-control-request-method\" in headers) {\n    const requestMethodName = headers[\"access-control-request-method\"]\n    if (!allowedMethodArray.includes(requestMethodName)) {\n      allowedMethodArray.push(requestMethodName)\n      vary.push(\"access-control-request-method\")\n    }\n  }\n\n  const allowedHeaderArray = [...accessControlAllowedHeaders]\n  if (accessControlAllowRequestHeaders && \"access-control-request-headers\" in headers) {\n    const requestHeaderNameArray = headers[\"access-control-request-headers\"].split(\", \")\n    requestHeaderNameArray.forEach((headerName) => {\n      const headerNameLowerCase = headerName.toLowerCase()\n      if (!allowedHeaderArray.includes(headerNameLowerCase)) {\n        allowedHeaderArray.push(headerNameLowerCase)\n        if (!vary.includes(\"access-control-request-headers\")) {\n          vary.push(\"access-control-request-headers\")\n        }\n      }\n    })\n  }\n\n  return {\n    \"access-control-allow-origin\": allowedOriginArray.join(\", \"),\n    \"access-control-allow-methods\": allowedMethodArray.join(\", \"),\n    \"access-control-allow-headers\": allowedHeaderArray.join(\", \"),\n    ...(accessControlAllowCredentials ? { \"access-control-allow-credentials\": true } : {}),\n    \"access-control-max-age\": accessControlMaxAge,\n    ...(sendServerTiming ? { \"timing-allow-origin\": allowedOriginArray.join(\", \") } : {}),\n    ...(vary.length ? { vary: vary.join(\", \") } : {}),\n  }\n}\n\nconst composePredicate = (previousPredicate, predicate) => {\n  return (value) => {\n    return previousPredicate(value) || predicate(value)\n  }\n}\n"
  ],
  "names": [
    "compositionMappingToComposeStrict",
    "compositionMapping",
    "createInitial",
    "reducer",
    "compositionMappingToStrictReducer",
    "objects",
    "reduce",
    "propertyComposeStrict",
    "key",
    "previous",
    "current",
    "propertyExistInCurrent",
    "propertyExistInPrevious",
    "composeProperty",
    "composed",
    "Object",
    "keys",
    "forEach",
    "compositionMappingToCompose",
    "lowercase",
    "compositionMappingToReducer",
    "propertyHasComposer",
    "composerForProperty",
    "toLowerCase",
    "composeHeaderValues",
    "value",
    "nextValue",
    "headerValues",
    "split",
    "includes",
    "push",
    "join",
    "headerCompositionMapping",
    "composeResponseHeaders",
    "responseCompositionMapping",
    "status",
    "prevStatus",
    "statusText",
    "prevStatusText",
    "headers",
    "body",
    "prevBody",
    "bodyEncoding",
    "prevEncoding",
    "encoding",
    "timing",
    "prevTiming",
    "composeResponse",
    "convertFileSystemErrorToResponseProperties",
    "error",
    "isErrorWithCode",
    "path",
    "Promise",
    "reject",
    "code",
    "Symbol",
    "observable",
    "for",
    "createObservable",
    "subscribe",
    "next",
    "complete",
    "subscription",
    "unsubscribe",
    "isObservable",
    "undefined",
    "createSSERoom",
    "logLevel",
    "keepProcessAlive",
    "keepaliveDuration",
    "retryDuration",
    "historyLength",
    "maxConnectionAllowed",
    "computeEventId",
    "event",
    "lastEventId",
    "welcomeEvent",
    "welcomeEventPublic",
    "logger",
    "createLogger",
    "connections",
    "Set",
    "eventHistory",
    "createEventHistory",
    "previousEventId",
    "state",
    "interval",
    "eventsSince",
    "id",
    "events",
    "since",
    "filter",
    "type",
    "connect",
    "lastKnownId",
    "size",
    "firstEvent",
    "retry",
    "data",
    "Date",
    "toLocaleTimeString",
    "add",
    "debug",
    "stringifySourceEvent",
    "connection",
    "write",
    "has",
    "delete",
    "sendEvent",
    "keepAlive",
    "start",
    "setInterval",
    "unref",
    "stop",
    "clearInterval",
    "reset",
    "clientCountGetter",
    "string",
    "limit",
    "length",
    "shift",
    "index",
    "findIndex",
    "String",
    "slice",
    "filenameContainsBackSlashes",
    "__filename",
    "indexOf",
    "url",
    "replace",
    "applyContentNegotiation",
    "availables",
    "accepteds",
    "getAcceptanceScore",
    "highestScore",
    "availableWithHighestScore",
    "availableIndex",
    "available",
    "acceptedIndex",
    "accepted",
    "score",
    "parseMultipleHeader",
    "multipleHeaderString",
    "validateName",
    "validateProperty",
    "values",
    "multipleHeader",
    "valueTrimmed",
    "trim",
    "valueParts",
    "name",
    "nameValidation",
    "properties",
    "parseHeaderProperties",
    "headerProperties",
    "valuePart",
    "propertyName",
    "propertyValueString",
    "propertyValue",
    "parseHeaderPropertyValue",
    "property",
    "propertyValidation",
    "headerPropertyValueString",
    "firstChar",
    "lastChar",
    "isNaN",
    "parseFloat",
    "stringifyMultipleHeader",
    "map",
    "headerPropertiesString",
    "stringifyHeaderProperties",
    "stringifyHeaderProperty",
    "negotiateContentType",
    "request",
    "availableContentTypes",
    "requestAcceptHeader",
    "accept",
    "contentTypesAccepted",
    "parseAcceptHeader",
    "getContentTypeAcceptanceScore",
    "acceptHeader",
    "acceptHeaderObject",
    "accepts",
    "q",
    "quality",
    "sort",
    "a",
    "b",
    "availableContentType",
    "acceptedType",
    "acceptedSubtype",
    "decomposeContentType",
    "availableType",
    "availableSubtype",
    "typeAccepted",
    "subtypeAccepted",
    "fullType",
    "subtype",
    "timeStart",
    "startTimestamp",
    "performance",
    "now",
    "timeEnd",
    "endTimestamp",
    "timeFunction",
    "fn",
    "returnValue",
    "then",
    "timingToServerTimingResponseHeaders",
    "serverTimingHeader",
    "letters",
    "desc",
    "dur",
    "serverTimingHeaderString",
    "stringifyServerTimingHeader",
    "validateServerTimingName",
    "valid",
    "test",
    "console",
    "warn",
    "jsenvContentTypeMap",
    "extensions",
    "urlToContentType",
    "contentTypeMap",
    "contentTypeDefault",
    "TypeError",
    "pathname",
    "URL",
    "extensionWithDot",
    "extname",
    "extension",
    "contentTypeForExtension",
    "find",
    "contentTypeName",
    "contentType",
    "negotiateContentEncoding",
    "availableEncodings",
    "requestAcceptEncodingHeader",
    "encodingsAccepted",
    "parseAcceptEncodingHeader",
    "getEncodingAcceptanceScore",
    "acceptEncodingHeaderString",
    "acceptEncodingHeader",
    "availableEncoding",
    "readFile",
    "promises",
    "ETAG_CACHE",
    "Map",
    "ETAG_CACHE_MAX_SIZE",
    "serveFile",
    "rootDirectoryUrl",
    "etagEnabled",
    "etagCacheDisabled",
    "mtimeEnabled",
    "compressionEnabled",
    "compressionSizeThreshold",
    "cacheControl",
    "canReadDirectory",
    "readableStreamLifetimeInSeconds",
    "assertAndNormalizeDirectoryUrl",
    "e",
    "Buffer",
    "byteLength",
    "method",
    "ressource",
    "sourceUrl",
    "resolveUrl",
    "sourceFileSystemPath",
    "urlToFileSystemPath",
    "readStatTiming",
    "sourceStat",
    "statSync",
    "isDirectory",
    "resolveDirectoryUrl",
    "readDirectoryTiming",
    "directoryContentArray",
    "createOperation",
    "cancellationToken",
    "readDirectory",
    "responseProducers",
    "directoryContentJson",
    "JSON",
    "stringify",
    "directoryAsHtml",
    "filename",
    "fileUrl",
    "fileUrlRelativeToServer",
    "urlToRelativeUrl",
    "bestContentType",
    "isFile",
    "clientCacheResponse",
    "getClientCacheResponse",
    "response",
    "compressedResponse",
    "getCompressedResponse",
    "getRawResponse",
    "destroy",
    "Infinity",
    "timeout",
    "setTimeout",
    "onceReadableStreamUsedOrClosed",
    "clearTimeout",
    "getEtagResponse",
    "getMtimeResponse",
    "computeEtagTiming",
    "fileContentEtag",
    "computeEtag",
    "requestHasIfNoneMatchHeader",
    "etag",
    "etagCacheEntry",
    "get",
    "fileStatAreTheSame",
    "eTag",
    "fileContentAsBuffer",
    "bufferToEtag",
    "firstKey",
    "Array",
    "from",
    "set",
    "leftFileStat",
    "rightFileStat",
    "fileStatKeysToCompare",
    "every",
    "keyToCompare",
    "leftValue",
    "rightValue",
    "cachedModificationDate",
    "actualModificationDate",
    "dateToSecondsPrecision",
    "mtime",
    "Number",
    "dateToUTCString",
    "acceptedCompressionFormat",
    "availableCompressionFormats",
    "fileReadableStream",
    "fileUrlToReadableStream",
    "createReadStream",
    "emitClose",
    "br",
    "createBrotliCompress",
    "pipe",
    "deflate",
    "createDeflate",
    "gzip",
    "createGzip",
    "readableStream",
    "callback",
    "dataOrCloseCallback",
    "removeListener",
    "on",
    "date",
    "toUTCString",
    "dateWithSecondsPrecision",
    "setMilliseconds",
    "require",
    "createRequire",
    "nodeFetch",
    "AbortController",
    "Response",
    "fetchUrl",
    "createCancellationToken",
    "ignoreHttpsError",
    "cacheStrategy",
    "options",
    "Error",
    "startsWith",
    "origin",
    "urlToOrigin",
    "urlToRessource",
    "process",
    "platform",
    "replaceBackSlashesWithSlashes",
    "mediaType",
    "base64Flag",
    "parseDataUrl",
    "throwIfRequested",
    "abortController",
    "cancelError",
    "register",
    "reason",
    "abort",
    "signal",
    "agent",
    "Agent",
    "rejectUnauthorized",
    "message",
    "dataUrl",
    "afterDataProtocol",
    "commaIndex",
    "beforeComma",
    "endsWith",
    "afterComma",
    "listen",
    "server",
    "port",
    "ip",
    "createStoppableOperation",
    "startListening",
    "stopListening",
    "resolve",
    "address",
    "close",
    "findFreePort",
    "initialPort",
    "min",
    "max",
    "testUntil",
    "free",
    "portIsFree",
    "nextPort",
    "createServer",
    "listenOperation",
    "stopPromise",
    "headersToObject",
    "headersObject",
    "firstService",
    "callbacks",
    "firstOperationMatching",
    "array",
    "predicate",
    "serviceGeneratedResponsePredicate",
    "firstServiceWithTiming",
    "namedServices",
    "servicesTiming",
    "serviceName",
    "serviceFn",
    "serviceTiming",
    "assign",
    "jsenvAccessControlAllowedHeaders",
    "jsenvAccessControlAllowedMethods",
    "jsenvServerInternalErrorToResponse",
    "serverInternalError",
    "sendServerInternalErrorDetails",
    "serverInternalErrorIsAPrimitive",
    "dataToSend",
    "stack",
    "renderHtmlForErrorWithoutDetails",
    "renderHtmlForErrorWithDetails",
    "jsenvPrivateKey",
    "jsenvPublicKey",
    "jsenvCertificate",
    "negotiateContentLanguage",
    "availableLanguages",
    "requestAcceptLanguageHeader",
    "languagesAccepted",
    "parseAcceptLanguageHeader",
    "getLanguageAcceptanceScore",
    "acceptLanguageHeaderString",
    "acceptLanguageHeader",
    "availableLanguage",
    "acceptedPrimary",
    "acceptedVariant",
    "decomposeLanguage",
    "availablePrimary",
    "availableVariant",
    "primaryAccepted",
    "variantAccepted",
    "compareVariant",
    "primary",
    "variant",
    "left",
    "right",
    "urlToSearchParamValue",
    "searchParamName",
    "searchParams",
    "readRequestBody",
    "as",
    "bufferArray",
    "buffer",
    "bodyAsBuffer",
    "concat",
    "bodyAsString",
    "toString",
    "bodyAsJSON",
    "parse",
    "createTracker",
    "callbackArray",
    "registerCleanupCallback",
    "cleanup",
    "localCallbackArray",
    "all",
    "http2",
    "http1Allowed",
    "protocol",
    "privateKey",
    "certificate",
    "createSecureServer",
    "cert",
    "allowHTTP1",
    "trackServerPendingConnections",
    "nodeServer",
    "onConnectionError",
    "trackHttp1ServerPendingConnections",
    "pendingConnections",
    "connectionListener",
    "pendingConnection",
    "trackServerPendingRequests",
    "trackHttp1ServerPendingRequests",
    "pendingClients",
    "requestListener",
    "nodeRequest",
    "nodeResponse",
    "client",
    "once",
    "headersSent",
    "writeHead",
    "closed",
    "destroyed",
    "nodeStreamToObservable",
    "nodeStream",
    "normalizeHeaderName",
    "headerName",
    "normalizeHeaderValue",
    "headerValue",
    "headersFromObject",
    "nodeRequestToRequest",
    "serverCancellationToken",
    "serverOrigin",
    "requestOrigin",
    "authority",
    "encrypted",
    "host",
    "freeze",
    "composeCancellationToken",
    "nodeRequestToCancellationToken",
    "cancel",
    "token",
    "createCancellationSource",
    "valueToObservable",
    "timer",
    "populateNodeResponse",
    "ignoreBody",
    "ignoreStatusText",
    "ignoreConnectionHeader",
    "nodeHeaders",
    "headersToNodeHeaders",
    "end",
    "setEncoding",
    "bodyToObservable",
    "emit",
    "cancellation",
    "unregister",
    "mapping",
    "nodeHeaderName",
    "isNodeStream",
    "Stream",
    "Writable",
    "Readable",
    "red",
    "green",
    "yellow",
    "magenta",
    "cyan",
    "colorizeResponseStatus",
    "statusType",
    "statusToType",
    "statusIsInformation",
    "statusIsSuccess",
    "statusIsRedirection",
    "statusIsClientError",
    "statusIsServerError",
    "getServerOrigins",
    "main",
    "createServerOrigin",
    "external",
    "getExternalIp",
    "hostname",
    "ipToHostname",
    "preferLocalhost",
    "preferLocalIp",
    "preferExternalIp",
    "networkInterfaceMap",
    "networkInterfaces",
    "internalIPV4NetworkAddress",
    "networkAddressArray",
    "networkAddress",
    "internal",
    "family",
    "createReason",
    "reasonString",
    "STOP_REASON_INTERNAL_ERROR",
    "STOP_REASON_PROCESS_SIGHUP",
    "STOP_REASON_PROCESS_SIGTERM",
    "STOP_REASON_PROCESS_SIGINT",
    "STOP_REASON_PROCESS_BEFORE_EXIT",
    "STOP_REASON_PROCESS_EXIT",
    "STOP_REASON_NOT_SPECIFIED",
    "trackServerRequest",
    "trackHttp1ServerRequest",
    "checkContentNegotiation",
    "responseContentTypeHeader",
    "responseContentLanguageHeader",
    "responseContentEncodingHeader",
    "killPort",
    "startServer",
    "serverName",
    "redirectHttpToHttps",
    "portHint",
    "forcePort",
    "stopOnSIGINT",
    "stopOnExit",
    "stopOnInternalError",
    "stopOnCrash",
    "requestToResponse",
    "accessControlAllowedOrigins",
    "accessControlAllowedMethods",
    "accessControlAllowedHeaders",
    "accessControlAllowRequestOrigin",
    "accessControlAllowRequestMethod",
    "accessControlAllowRequestHeaders",
    "accessControlAllowCredentials",
    "accessControlMaxAge",
    "sendServerTiming",
    "serverInternalErrorToResponse",
    "requestWaitingMs",
    "requestWaitingCallback",
    "contentNegotiationWarnings",
    "startedCallback",
    "stoppedCallback",
    "errorIsCancellation",
    "nagle",
    "executeAsyncFunction",
    "internalCancellationSource",
    "externalCancellationToken",
    "internalCancellationToken",
    "onError",
    "composePredicate",
    "isCancelError",
    "unadvisedCrashSignal",
    "addCallback",
    "teardownSignal",
    "tearDownReason",
    "SIGHUP",
    "SIGTERM",
    "SIGINT",
    "beforeExit",
    "exit",
    "SIGINTSignal",
    "stoppedResolve",
    "stoppedPromise",
    "memoize",
    "info",
    "startOperation",
    "_",
    "serverOrigins",
    "connectionsTracker",
    "pendingRequestsTracker",
    "requestCallback",
    "setNoDelay",
    "location",
    "startRespondingTiming",
    "generateResponseDescription",
    "serverTiming",
    "cancellationRequested",
    "aborted",
    "Boolean",
    "stream",
    "removeRequestListener",
    "corsEnabled",
    "responsePropertiesToResponse",
    "statusToStatusText",
    "accessControlHeaders",
    "generateAccessControlHeaders",
    "responseProperties",
    "getStatus",
    "STATUS_CODES",
    "vary",
    "allowedOriginArray",
    "referer",
    "allowedMethodArray",
    "requestMethodName",
    "allowedHeaderArray",
    "requestHeaderNameArray",
    "headerNameLowerCase",
    "previousPredicate"
  ],
  "mappings": "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"
}