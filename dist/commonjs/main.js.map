{"version":3,"file":"main.js","sources":["/src/acceptsContentType.js","/src/internal/compositionMappingToComposeStrict.js","/src/internal/compositionMappingToCompose.js","/src/internal/composeResponseHeaders.js","/src/composeResponse.js","/node_modules/@jsenv/logger/src/createLogger/LOG_LEVELS.js","/node_modules/@jsenv/logger/src/createLogger/createLogger.js","/src/internal/observable.js","/src/createSSERoom.js","/node_modules/@jsenv/cancellation/src/createCancellationToken.js","/node_modules/@jsenv/cancellation/src/internal/memoizeOnce.js","/node_modules/@jsenv/cancellation/src/operation/createOperation.js","/node_modules/@jsenv/cancellation/src/operation/createStoppableOperation.js","/node_modules/@jsenv/cancellation/src/operation/firstOperationMatching.js","/src/internal/listen.js","/src/findFreePort.js","/src/firstService.js","/src/jsenvAccessControlAllowedHeaders.js","/src/jsenvAccessControlAllowedMethods.js","/src/jsenvSignature.js","/src/ressourceToSearchParamValue.js","/src/internal/bufferToEtag.js","/src/internal/convertFileSystemErrorToResponseProperties.js","/src/jsenvContentTypeMap.js","/src/filenameToContentType.js","/src/serveFile.js","/node_modules/@jsenv/bundling/src/generateBabelPluginMapOption/import-meta-commonjs.js","/node_modules/@jsenv/node-signals/src/beforeExitSignal.js","/node_modules/@jsenv/node-signals/src/deathSignal.js","/node_modules/@jsenv/node-signals/src/exitSignal.js","/node_modules/@jsenv/node-signals/src/hangupOrDeathSignal.js","/node_modules/@jsenv/node-signals/src/interruptSignal.js","/node_modules/@jsenv/node-signals/src/teardownSignal.js","/node_modules/@jsenv/node-signals/src/internal/firstOperationMatching.js","/node_modules/@jsenv/node-signals/src/unadvisedCrashSignal.js","/src/internal/memoizeOnce.js","/src/internal/urlToOrigin.js","/src/internal/trackConnections.js","/src/internal/trackClients.js","/src/internal/trackRequestHandlers.js","/src/internal/nodeStreamToObservable.js","/src/internal/normalizeHeaderName.js","/src/internal/normalizeHeaderValue.js","/src/internal/headersFromObject.js","/src/internal/nodeRequestToRequest.js","/src/internal/valueToObservable.js","/src/internal/populateNodeResponse.js","/src/internal/colorizeResponseStatus.js","/src/internal/originAsString.js","/src/stopReasons.js","/src/startServer.js"],"sourcesContent":["export const acceptsContentType = (acceptHeader, contentType) => {\n  if (typeof acceptHeader !== \"string\") {\n    return false\n  }\n\n  return acceptHeader.split(\",\").some((acceptRaw) => {\n    const accept = parseAccept(acceptRaw)\n    return typeMatches(contentType, accept.type)\n  })\n}\n\nconst parseAccept = (accept) => {\n  const acceptTrimmed = accept.trim()\n  const scoreIndex = acceptTrimmed.indexOf(\";q=\")\n\n  let type\n  let score\n  if (scoreIndex > -1) {\n    const beforeScore = acceptTrimmed.slice(0, scoreIndex)\n    const afterScore = acceptTrimmed.slice(scoreIndex + \";q=\".length)\n    type = beforeScore\n    score = parseFloat(afterScore)\n  } else {\n    type = acceptTrimmed\n    score = 1\n  }\n\n  return {\n    type,\n    score,\n  }\n}\n\nconst typeMatches = (type, pattern) => {\n  const typeComposition = decomposeType(type)\n  const patternComposition = decomposeType(pattern)\n\n  if (patternComposition.type === \"*\") {\n    if (patternComposition.subtype === \"*\") return true\n    return patternComposition.subtype === typeComposition.subtype\n  }\n  if (patternComposition.type === typeComposition.type) {\n    if (patternComposition.subtype === \"*\") return true\n    return patternComposition.subtype === typeComposition.subtype\n  }\n  return false\n}\n\nconst decomposeType = (fullType) => {\n  const parts = fullType.split(\"/\")\n  const type = parts[0]\n  const subtype = parts[1]\n  return { type, subtype }\n}\n","export const compositionMappingToComposeStrict = (\n  compositionMapping,\n  createInitial = () => ({}),\n) => {\n  const reducer = compositionMappingToStrictReducer(compositionMapping)\n  return (...objects) => objects.reduce(reducer, createInitial())\n}\n\nconst compositionMappingToStrictReducer = (compositionMapping) => {\n  const propertyComposeStrict = (key, previous, current) => {\n    const propertyExistInCurrent = key in current\n    if (!propertyExistInCurrent) return previous[key]\n\n    const propertyExistInPrevious = key in previous\n    if (!propertyExistInPrevious) return current[key]\n\n    const composeProperty = compositionMapping[key]\n    return composeProperty(previous[key], current[key])\n  }\n\n  return (previous, current) => {\n    if (typeof current !== \"object\" || current === null) return previous\n\n    const composed = {}\n    Object.keys(compositionMapping).forEach((key) => {\n      composed[key] = propertyComposeStrict(key, previous, current)\n    })\n    return composed\n  }\n}\n","export const compositionMappingToCompose = (compositionMapping, createInitial = () => ({})) => {\n  const reducer = compositionMappingToReducer(compositionMapping)\n  return (...objects) => objects.reduce(reducer, createInitial())\n}\n\nconst compositionMappingToReducer = (compositionMapping) => {\n  const composeProperty = (key, previous, current) => {\n    const propertyExistInCurrent = key in current\n    if (!propertyExistInCurrent) return previous[key]\n\n    const propertyExistInPrevious = key in previous\n    if (!propertyExistInPrevious) return current[key]\n\n    const propertyHasComposer = key in compositionMapping\n    if (!propertyHasComposer) return current[key]\n\n    const composerForProperty = compositionMapping[key]\n    return composerForProperty(previous[key], current[key])\n  }\n\n  return (previous, current) => {\n    if (typeof current !== \"object\" || current === null) return previous\n\n    const composed = { ...previous }\n    Object.keys(current).forEach((key) => {\n      composed[key] = composeProperty(key, previous, current)\n    })\n    return composed\n  }\n}\n","import { compositionMappingToCompose } from \"./compositionMappingToCompose.js\"\n\nconst composeHeaderValues = (value, nextValue) => {\n  const headerValues = value.split(\", \")\n  nextValue.split(\", \").forEach((value) => {\n    if (!headerValues.includes(value)) {\n      headerValues.push(value)\n    }\n  })\n  return headerValues.join(\", \")\n}\n\nconst headerCompositionMapping = {\n  accept: composeHeaderValues,\n  \"accept-charset\": composeHeaderValues,\n  \"accept-language\": composeHeaderValues,\n  \"access-control-allow-headers\": composeHeaderValues,\n  \"access-control-allow-methods\": composeHeaderValues,\n  \"access-control-allow-origin\": composeHeaderValues,\n  // 'content-type', // https://github.com/ninenines/cowboy/issues/1230\n  vary: composeHeaderValues,\n}\n\nexport const composeResponseHeaders = compositionMappingToCompose(headerCompositionMapping)\n","import { compositionMappingToComposeStrict } from \"./internal/compositionMappingToComposeStrict.js\"\nimport { composeResponseHeaders } from \"./internal/composeResponseHeaders.js\"\n\nconst responseCompositionMapping = {\n  status: (prevStatus, status) => status,\n  statusText: (prevStatusText, statusText) => statusText,\n  headers: composeResponseHeaders,\n  body: (prevBody, body) => body,\n  bodyEncoding: (prevEncoding, encoding) => encoding,\n}\n\nexport const composeResponse = compositionMappingToComposeStrict(responseCompositionMapping)\n","export const LOG_LEVEL_OFF = \"off\"\n\nexport const LOG_LEVEL_DEBUG = \"debug\"\n\nexport const LOG_LEVEL_INFO = \"info\"\n\nexport const LOG_LEVEL_WARN = \"warn\"\n\nexport const LOG_LEVEL_ERROR = \"error\"\n","import {\n  LOG_LEVEL_DEBUG,\n  LOG_LEVEL_INFO,\n  LOG_LEVEL_WARN,\n  LOG_LEVEL_ERROR,\n  LOG_LEVEL_OFF,\n} from \"./LOG_LEVELS.js\"\n\nexport const createLogger = ({ logLevel = LOG_LEVEL_INFO } = {}) => {\n  if (logLevel === LOG_LEVEL_DEBUG) {\n    return {\n      debug,\n      info,\n      warn,\n      error,\n    }\n  }\n\n  if (logLevel === LOG_LEVEL_INFO) {\n    return {\n      debug: debugDisabled,\n      info,\n      warn,\n      error,\n    }\n  }\n\n  if (logLevel === LOG_LEVEL_WARN) {\n    return {\n      debug: debugDisabled,\n      info: infoDisabled,\n      warn,\n      error,\n    }\n  }\n\n  if (logLevel === LOG_LEVEL_ERROR) {\n    return {\n      debug: debugDisabled,\n      info: infoDisabled,\n      warn: warnDisabled,\n      error,\n    }\n  }\n\n  if (logLevel === LOG_LEVEL_OFF) {\n    return {\n      debug: debugDisabled,\n      info: infoDisabled,\n      warn: warnDisabled,\n      error: errorDisabled,\n    }\n  }\n\n  throw new Error(createUnexpectedLogLevelMessage({ logLevel }))\n}\n\nconst createUnexpectedLogLevelMessage = ({ logLevel }) => `unexpected logLevel.\n--- logLevel ---\n${logLevel}\n--- allowed log levels ---\n${LOG_LEVEL_OFF}\n${LOG_LEVEL_ERROR}\n${LOG_LEVEL_WARN}\n${LOG_LEVEL_INFO}\n${LOG_LEVEL_DEBUG}\n`\n\nconst debug = console.debug\n\nconst debugDisabled = () => {}\n\nconst info = console.info\n\nconst infoDisabled = () => {}\n\nconst warn = console.warn\n\nconst warnDisabled = () => {}\n\nconst error = console.error\n\nconst errorDisabled = () => {}\n","if (\"observable\" in Symbol === false) {\n  Symbol.observable = Symbol.for(\"observable\")\n}\n\nexport const createObservable = ({ subscribe }) => {\n  const observable = {\n    [Symbol.observable]: () => observable,\n    subscribe,\n  }\n  return observable\n}\n\nexport const subscribe = (\n  observable,\n  {\n    next = () => {},\n    error = (value) => {\n      throw value\n    },\n    complete = () => {},\n  },\n) => {\n  const { subscribe } = observable[Symbol.observable]()\n  const subscription = subscribe({\n    next,\n    error,\n    complete,\n  })\n  return subscription\n}\n\nexport const isObservable = (value) => {\n  if (value === null) return false\n  if (value === undefined) return false\n  if (typeof value === \"object\") return Symbol.observable in value\n  if (typeof value === \"function\") return Symbol.observable in value\n  return false\n}\n","import { createLogger } from \"@jsenv/logger\"\nimport { createObservable } from \"./internal/observable.js\"\n\n// https://www.html5rocks.com/en/tutorials/eventsource/basics/\nexport const createSSERoom = ({\n  logLevel,\n  keepaliveDuration = 30 * 1000,\n  retryDuration = 1 * 1000,\n  historyLength = 1 * 1000,\n  maxConnectionAllowed = 100, // max 100 users accepted\n} = {}) => {\n  const logger = createLogger({ logLevel })\n\n  const connections = new Set()\n  // what about history that keeps growing ?\n  // we should add some limit\n  // one limit could be that an event older than 24h is be deleted\n  const history = createEventHistory(historyLength)\n  let previousEventId\n  let state = \"closed\"\n  let interval\n\n  const connect = (lastKnownId) => {\n    if (connections.size > maxConnectionAllowed) {\n      return {\n        status: 503,\n      }\n    }\n    if (state === \"closed\") {\n      return {\n        status: 204,\n      }\n    }\n\n    const joinEvent = {\n      id: previousEventId === undefined ? 0 : previousEventId + 1,\n      retry: retryDuration,\n      type: \"join\",\n      data: new Date().toLocaleTimeString(),\n    }\n    previousEventId = joinEvent.id\n    history.add(joinEvent)\n\n    const events = [\n      joinEvent,\n      // send events which occured between lastKnownId & now\n      ...(lastKnownId === undefined ? [] : history.since(lastKnownId)),\n    ]\n\n    const body = createObservable({\n      subscribe: ({ next }) => {\n        events.forEach((event) => {\n          logger.debug(`send ${event.type} event to this new client`)\n          next(stringifySourceEvent(event))\n        })\n\n        const connection = {\n          write: next,\n        }\n\n        const unsubscribe = () => {\n          connections.delete(connection)\n          logger.debug(\n            `connection closed by us, number of client connected to event source: ${connections.size}`,\n          )\n        }\n\n        connection.unsubscribe = unsubscribe\n        connections.add(connection)\n\n        return {\n          unsubscribe,\n        }\n      },\n    })\n\n    logger.debug(\n      `client joined, number of client connected to event source: ${connections.size}, max allowed: ${maxConnectionAllowed}`,\n    )\n\n    return {\n      status: 200,\n      headers: {\n        \"content-type\": \"text/event-stream\",\n        \"cache-control\": \"no-cache\",\n        connection: \"keep-alive\",\n      },\n      body,\n    }\n  }\n\n  const write = (data) => {\n    connections.forEach((connection) => {\n      connection.write(data)\n    })\n  }\n\n  const sendEvent = (event) => {\n    if (event.type !== \"comment\") {\n      logger.debug(\n        `send ${event.type} event, number of client listening event source: ${connections.size}`,\n      )\n      event.id = previousEventId === undefined ? 0 : previousEventId + 1\n      previousEventId = event.id\n      history.add(event)\n    }\n\n    write(stringifySourceEvent(event))\n  }\n\n  const keepAlive = () => {\n    // maybe that, when an event occurs, we can delay the keep alive event\n    logger.debug(\n      `send keep alive event, number of client listening event source: ${connections.size}`,\n    )\n    sendEvent({\n      type: \"comment\",\n      data: new Date().toLocaleTimeString(),\n    })\n  }\n\n  const start = () => {\n    state = \"started\"\n    interval = setInterval(keepAlive, keepaliveDuration)\n  }\n\n  const stop = () => {\n    logger.debug(`stopping, number of client to close: ${connections.size}`)\n    connections.forEach((connection) => connection.unsubscribe())\n    clearInterval(interval)\n    history.reset()\n    state = \"stopped\"\n  }\n\n  return { start, stop, connect, sendEvent }\n}\n\n// https://github.com/dmail-old/project/commit/da7d2c88fc8273850812972885d030a22f9d7448\n// https://github.com/dmail-old/project/commit/98b3ae6748d461ac4bd9c48944a551b1128f4459\n\n// https://github.com/dmail-old/http-eventsource/blob/master/lib/event-source.js\n\n// http://html5doctor.com/server-sent-events/\nconst stringifySourceEvent = ({ data, type = \"message\", id, retry }) => {\n  let string = \"\"\n\n  if (id !== undefined) {\n    string += `id:${id}\\n`\n  }\n\n  if (retry) {\n    string += `retry:${retry}\\n`\n  }\n\n  if (type !== \"message\") {\n    string += `event:${type}\\n`\n  }\n\n  string += `data:${data}\\n\\n`\n\n  return string\n}\n\nconst createEventHistory = ({ limit } = {}) => {\n  const events = []\n  let removedCount = 0\n\n  const add = (data) => {\n    events.push(data)\n\n    if (events.length >= limit) {\n      events.shift()\n      removedCount++\n    }\n  }\n\n  const since = (index) => {\n    index = parseInt(index)\n    if (isNaN(index)) {\n      throw new TypeError(\"history.since() expect a number\")\n    }\n    index -= removedCount\n    return index < 0 ? [] : events.slice(index)\n  }\n\n  const reset = () => {\n    events.length = 0\n    removedCount = 0\n  }\n\n  return { add, since, reset }\n}\n","export const createCancellationToken = () => {\n  const register = (callback) => {\n    if (typeof callback !== \"function\") {\n      throw new Error(`callback must be a function, got ${callback}`)\n    }\n\n    return {\n      callback,\n      unregister: () => {},\n    }\n  }\n\n  const throwIfRequested = () => undefined\n\n  return {\n    register,\n    cancellationRequested: false,\n    throwIfRequested,\n  }\n}\n","export const memoizeOnce = (compute) => {\n  let locked = false\n  let lockValue\n\n  const memoized = (...args) => {\n    if (locked) return lockValue\n    // if compute is recursive wait for it to be fully done before storing the lockValue\n    // so set locked later\n    lockValue = compute(...args)\n    locked = true\n    return lockValue\n  }\n\n  memoized.deleteCache = () => {\n    const value = lockValue\n    locked = false\n    lockValue = undefined\n    return value\n  }\n\n  return memoized\n}\n","import { createCancellationToken } from \"../createCancellationToken.js\"\n\nexport const createOperation = ({\n  cancellationToken = createCancellationToken(),\n  start,\n  ...rest\n}) => {\n  const unknownArgumentNames = Object.keys(rest)\n  if (unknownArgumentNames.length) {\n    throw new Error(`createOperation called with unknown argument names.\n--- unknown argument names ---\n${unknownArgumentNames}\n--- possible argument names ---\ncancellationToken\nstart`)\n  }\n\n  cancellationToken.throwIfRequested()\n  const promise = new Promise((resolve) => {\n    resolve(start())\n  })\n  const cancelPromise = new Promise((resolve, reject) => {\n    const cancelRegistration = cancellationToken.register((cancelError) => {\n      cancelRegistration.unregister()\n      reject(cancelError)\n    })\n    promise.then(cancelRegistration.unregister, () => {})\n  })\n  const operationPromise = Promise.race([promise, cancelPromise])\n\n  return operationPromise\n}\n","import { createCancellationToken } from \"../createCancellationToken.js\"\nimport { memoizeOnce } from \"../internal/memoizeOnce.js\"\n\nexport const createStoppableOperation = ({\n  cancellationToken = createCancellationToken(),\n  start,\n  stop,\n  ...rest\n}) => {\n  if (typeof stop !== \"function\") {\n    throw new TypeError(`stop must be a function. got ${stop}`)\n  }\n  const unknownArgumentNames = Object.keys(rest)\n  if (unknownArgumentNames.length) {\n    throw new Error(`createStoppableOperation called with unknown argument names.\n--- unknown argument names ---\n${unknownArgumentNames}\n--- possible argument names ---\ncancellationToken\nstart\nstop`)\n  }\n  cancellationToken.throwIfRequested()\n\n  const promise = new Promise((resolve) => {\n    resolve(start())\n  })\n  const cancelPromise = new Promise((resolve, reject) => {\n    const cancelRegistration = cancellationToken.register((cancelError) => {\n      cancelRegistration.unregister()\n      reject(cancelError)\n    })\n    promise.then(cancelRegistration.unregister, () => {})\n  })\n  const operationPromise = Promise.race([promise, cancelPromise])\n\n  const stopInternal = memoizeOnce(async (reason) => {\n    const value = await promise\n    return stop(value, reason)\n  })\n  cancellationToken.register(stopInternal)\n  operationPromise.stop = stopInternal\n\n  return operationPromise\n}\n","export const firstOperationMatching = ({ array, start, predicate }) => {\n  if (typeof array !== \"object\") {\n    throw new TypeError(`array must be an object, got ${array}`)\n  }\n  if (typeof start !== \"function\") {\n    throw new TypeError(`start must be a function, got ${start}`)\n  }\n  if (typeof predicate !== \"function\") {\n    throw new TypeError(`predicate must be a function, got ${predicate}`)\n  }\n\n  return new Promise((resolve, reject) => {\n    const visit = (index) => {\n      if (index >= array.length) {\n        return resolve()\n      }\n      const input = array[index]\n      const returnValue = start(input)\n      return Promise.resolve(returnValue).then((output) => {\n        if (predicate(output)) {\n          return resolve(output)\n        }\n        return visit(index + 1)\n      }, reject)\n    }\n\n    visit(0)\n  })\n}\n","import { createStoppableOperation } from \"@jsenv/cancellation\"\n\nexport const listen = ({ cancellationToken, server, port, ip }) => {\n  return createStoppableOperation({\n    cancellationToken,\n    start: () => startListening(server, port, ip),\n    stop: () => stopListening(server),\n  })\n}\n\nexport const startListening = (server, port, ip) =>\n  new Promise((resolve, reject) => {\n    server.on(\"error\", reject)\n    server.on(\"listening\", () => {\n      // in case port is 0 (randomly assign an available port)\n      // https://nodejs.org/api/net.html#net_server_listen_port_host_backlog_callback\n      resolve(server.address().port)\n    })\n    server.listen(port, ip)\n  })\n\nexport const stopListening = (server) =>\n  new Promise((resolve, reject) => {\n    server.on(\"error\", reject)\n    server.on(\"close\", resolve)\n    server.close()\n  })\n","import { createServer } from \"net\"\nimport { createCancellationToken } from \"@jsenv/cancellation\"\nimport { listen } from \"./internal/listen.js\"\n\nexport const findFreePort = async (\n  initialPort = 1,\n  {\n    cancellationToken = createCancellationToken(),\n    ip = \"127.0.0.1\",\n    min = 1,\n    max = 65534,\n    next = (port) => port + 1,\n  } = {},\n) => {\n  const testUntil = async (port, ip) => {\n    const free = await portIsFree({ cancellationToken, port, ip })\n    if (free) {\n      return port\n    }\n    const nextPort = next(port)\n\n    if (nextPort > max) {\n      throw new Error(`${ip} has no available port between ${min} and ${max}`)\n    }\n\n    return testUntil(nextPort, ip)\n  }\n\n  return testUntil(initialPort, ip)\n}\n\nconst portIsFree = async ({ cancellationToken, port, ip }) => {\n  const server = createServer()\n\n  const listenOperation = listen({\n    cancellationToken,\n    server,\n    port,\n    ip,\n  })\n\n  return listenOperation.then(\n    () => {\n      const stopPromise = listenOperation.stop()\n      // cancellation must wait for server to be closed before considering\n      // cancellation as done\n      cancellationToken.register(() => stopPromise)\n      return stopPromise.then(() => true)\n    },\n    (error) => {\n      if (error && error.code === \"EADDRINUSE\") {\n        return false\n      }\n      if (error && error.code === \"EACCES\") {\n        return false\n      }\n      return Promise.reject(error)\n    },\n  )\n}\n","import { firstOperationMatching } from \"@jsenv/cancellation\"\n\nexport const firstService = (...callbacks) => {\n  return firstOperationMatching({\n    array: callbacks,\n    start: (callback) => callback(),\n    predicate: serviceGeneratedResponsePredicate,\n  })\n}\n\nconst serviceGeneratedResponsePredicate = (value) => {\n  if (value === null) {\n    return false\n  }\n  return typeof value === \"object\"\n}\n","export const jsenvAccessControlAllowedHeaders = [\"x-requested-with\"]\n","export const jsenvAccessControlAllowedMethods = [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"]\n","export const jsenvPrivateKey = `-----BEGIN RSA PRIVATE KEY-----\nMIICXAIBAAKBgQCll1gJkJqB+KRZsyepQ7gs81UO+73aKPaNbjp/dwo9XfqvNdDp\nKi4zfTwzzJyFXkoN+NGihfQHI+VqRGITc+XzmBPcGu9XIvYy52lV3zjG4sldz+r8\niNBzFwFSdUGmaHfkcm0YhvcjdRhyKalDaLMc3pVX4dq9rRzqm+pkbzVfVQIDAQAB\nAoGAImSo2HO8Y7ptCGR5nGKAYnW3+QC4khNoAkAezlK/Qbe/VZzr40Hrjq44Ttn0\nuI64+uXvRL5lzQXbpJLHfBraa8J6Vstf2Kwadmg+FyrqBcet6gidqZ6S1LBTfXII\neSUcMIqkourv7LWOs8BfWQQiCf0Em0shGK1qf1lgiOQxoJECQQD+dSJOPqKbdZfJ\n/JcsInf5dPkfTNZMhBxpxqiYOvU3684W3LHB1g6BXjHmIF/CIrxcAHsxxXwTGWu9\n23Ffu+xPAkEApphOt+CzGdYq+Ygjj6Hq+hx3hkUwKUHSEOcNXG0Eb90m2sCEkXgz\nxH7fKYXaohFtis7IFJR4UfYD8pkGYVmdGwJAJf/iFqM9709ZUp25CatAFW3Fgkoc\nOqMEBzvWk51CX46EYV+l4BeSZPlnJEGzay96x5Z+z0j5pXSHZXvu62gJ+wJACci+\nLsxymFzcr0UQmZnv2/qaBne/yVyFQtrfDQOWFB/P7V8LKiP+Hlc5Mg4bdhNB9LoK\nRDMoEeA6ASB9oHAL6wJBAJcYLOICBVQrTil6DroEkrIxQY/S+arKc42uFpj98S+w\nk3doJf8KKDrclaRnKfMXxGYhXPUWFpa5fFr1hvcprEo=\n-----END RSA PRIVATE KEY-----`\n\nexport const jsenvPublicKey = `-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCll1gJkJqB+KRZsyepQ7gs81UO\n+73aKPaNbjp/dwo9XfqvNdDpKi4zfTwzzJyFXkoN+NGihfQHI+VqRGITc+XzmBPc\nGu9XIvYy52lV3zjG4sldz+r8iNBzFwFSdUGmaHfkcm0YhvcjdRhyKalDaLMc3pVX\n4dq9rRzqm+pkbzVfVQIDAQAB\n-----END PUBLIC KEY-----`\n\nexport const jsenvCertificate = `-----BEGIN CERTIFICATE-----\nMIIDEDCCAnmgAwIBAgIQd9Gto4GPGwXcLk0flq7bsjANBgkqhkiG9w0BAQsFADCB\nkTEuMCwGA1UEAxMlaHR0cHM6Ly9naXRodWIuY29tL2pzZW52L2pzZW52LXNlcnZl\ncjELMAkGA1UEBhMCRlIxGDAWBgNVBAgTD0FscGVzIE1hcml0aW1lczERMA8GA1UE\nBxMIVmFsYm9ubmUxDjAMBgNVBAoTBWpzZW52MRUwEwYDVQQLEwxqc2VudiBzZXJ2\nZXIwHhcNMTkwNzA5MTQ1MzU4WhcNMjgwNzA5MTQ1MzU5WjCBkTEuMCwGA1UEAxMl\naHR0cHM6Ly9naXRodWIuY29tL2pzZW52L2pzZW52LXNlcnZlcjELMAkGA1UEBhMC\nRlIxGDAWBgNVBAgTD0FscGVzIE1hcml0aW1lczERMA8GA1UEBxMIVmFsYm9ubmUx\nDjAMBgNVBAoTBWpzZW52MRUwEwYDVQQLEwxqc2VudiBzZXJ2ZXIwgZ8wDQYJKoZI\nhvcNAQEBBQADgY0AMIGJAoGBAKWXWAmQmoH4pFmzJ6lDuCzzVQ77vdoo9o1uOn93\nCj1d+q810OkqLjN9PDPMnIVeSg340aKF9Acj5WpEYhNz5fOYE9wa71ci9jLnaVXf\nOMbiyV3P6vyI0HMXAVJ1QaZod+RybRiG9yN1GHIpqUNosxzelVfh2r2tHOqb6mRv\nNV9VAgMBAAGjZzBlMAwGA1UdEwEB/wQCMAAwDgYDVR0PAQH/BAQDAgWgMBMGA1Ud\nJQQMMAoGCCsGAQUFBwMBMB8GA1UdIwQYMBaAFOQhJA9S7idbpNIbvKMyeRWbwyad\nMA8GA1UdEQQIMAaHBH8AAAEwDQYJKoZIhvcNAQELBQADgYEAUKPupneUl1bdjbbf\nQvUqAExIK0Nv2u54X8l0EJvkdPMNQEer7Npzg5RQWExtvamfEZI1EPOeVfPVu5sz\nq4DB6OgAEzkytbKtcgPlhY0GDbim8ELCpO1JNDn/jUXH74VJElwXMZqan5VaQ5c+\nqsCeVUdw8QsfIZH6XbkvhCswh4k=\n-----END CERTIFICATE-----`\n","import { URLSearchParams } from \"url\"\n\nexport const ressourceToSearchParamValue = (ressource, searchParamName) => {\n  const search = ressourceToSearch(ressource)\n  return new URLSearchParams(search).get(searchParamName)\n}\n\nconst ressourceToSearch = (ressource) => {\n  const searchSeparatorIndex = ressource.indexOf(\"?\")\n  return searchSeparatorIndex === -1 ? \"?\" : ressource.slice(searchSeparatorIndex)\n}\n","import { createHash } from \"crypto\"\n\nconst EMPTY_ID = '\"0-2jmj7l5rSw0yVb/vlWAYkK/YBwk\"'\n\nexport const bufferToEtag = (buffer) => {\n  if (!Buffer.isBuffer(buffer)) {\n    throw new TypeError(`buffer expected, got ${buffer}`)\n  }\n\n  if (buffer.length === 0) {\n    return EMPTY_ID\n  }\n\n  const hash = createHash(\"sha1\")\n  hash.update(buffer, \"utf8\")\n\n  const hashBase64String = hash.digest(\"base64\")\n  const hashBase64StringSubset = hashBase64String.slice(0, 27)\n  const length = buffer.length\n\n  return `\"${length.toString(16)}-${hashBase64StringSubset}\"`\n}\n","export const convertFileSystemErrorToResponseProperties = (error) => {\n  // https://iojs.org/api/errors.html#errors_eacces_permission_denied\n  if (isErrorWithCode(error, \"EACCES\")) {\n    return {\n      status: 403,\n      statusText: \"no permission to read file\",\n    }\n  }\n\n  if (isErrorWithCode(error, \"EPERM\")) {\n    return {\n      status: 403,\n      statusText: \"no permission to read file\",\n    }\n  }\n\n  if (isErrorWithCode(error, \"ENOENT\")) {\n    return {\n      status: 404,\n      statusText: \"file not found\",\n    }\n  }\n\n  // file access may be temporarily blocked\n  // (by an antivirus scanning it because recently modified for instance)\n  if (isErrorWithCode(error, \"EBUSY\")) {\n    return {\n      status: 503,\n      statusText: \"file is busy\",\n      headers: {\n        \"retry-after\": 0.01, // retry in 10ms\n      },\n    }\n  }\n\n  // emfile means there is too many files currently opened\n  if (isErrorWithCode(error, \"EMFILE\")) {\n    return {\n      status: 503,\n      statusText: \"too many file opened\",\n      headers: {\n        \"retry-after\": 0.1, // retry in 100ms\n      },\n    }\n  }\n\n  if (isErrorWithCode(error, \"EISDIR\")) {\n    return {\n      status: 500,\n      statusText: \"Unexpected directory operation\",\n    }\n  }\n\n  return Promise.reject(error)\n}\n\nconst isErrorWithCode = (error, code) => {\n  return typeof error === \"object\" && error.code === code\n}\n","export const jsenvContentTypeMap = {\n  \"application/javascript\": {\n    extensions: [\"js\", \"mjs\", \"ts\", \"jsx\"],\n  },\n  \"application/json\": {\n    extensions: [\"json\"],\n  },\n  \"application/octet-stream\": {},\n  \"application/pdf\": {\n    extensions: [\"pdf\"],\n  },\n  \"application/xml\": {\n    extensions: [\"xml\"],\n  },\n  \"application/x-gzip\": {\n    extensions: [\"gz\"],\n  },\n  \"application/wasm\": {\n    extensions: [\"wasm\"],\n  },\n  \"application/zip\": {\n    extensions: [\"zip\"],\n  },\n  \"audio/basic\": {\n    extensions: [\"au\", \"snd\"],\n  },\n  \"audio/mpeg\": {\n    extensions: [\"mpga\", \"mp2\", \"mp2a\", \"mp3\", \"m2a\", \"m3a\"],\n  },\n  \"audio/midi\": {\n    extensions: [\"midi\", \"mid\", \"kar\", \"rmi\"],\n  },\n  \"audio/mp4\": {\n    extensions: [\"m4a\", \"mp4a\"],\n  },\n  \"audio/ogg\": {\n    extensions: [\"oga\", \"ogg\", \"spx\"],\n  },\n  \"audio/webm\": {\n    extensions: [\"weba\"],\n  },\n  \"audio/x-wav\": {\n    extensions: [\"wav\"],\n  },\n  \"font/ttf\": {\n    extensions: [\"ttf\"],\n  },\n  \"font/woff\": {\n    extensions: [\"woff\"],\n  },\n  \"font/woff2\": {\n    extensions: [\"woff2\"],\n  },\n  \"image/png\": {\n    extensions: [\"png\"],\n  },\n  \"image/gif\": {\n    extensions: [\"gif\"],\n  },\n  \"image/jpeg\": {\n    extensions: [\"jpg\"],\n  },\n  \"image/svg+xml\": {\n    extensions: [\"svg\", \"svgz\"],\n  },\n  \"text/plain\": {\n    extensions: [\"txt\"],\n  },\n  \"text/html\": {\n    extensions: [\"html\"],\n  },\n  \"text/css\": {\n    extensions: [\"css\"],\n  },\n  \"text/cache-manifest\": {\n    extensions: [\"appcache\"],\n  },\n  \"video/mp4\": {\n    extensions: [\"mp4\", \"mp4v\", \"mpg4\"],\n  },\n  \"video/mpeg\": {\n    extensions: [\"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\"],\n  },\n  \"video/ogg\": {\n    extensions: [\"ogv\"],\n  },\n  \"video/webm\": {\n    extensions: [\"webm\"],\n  },\n}\n","// https://github.com/jshttp/mime-db/blob/master/src/apache-types.json\n\nimport { extname } from \"path\"\nimport { jsenvContentTypeMap } from \"./jsenvContentTypeMap.js\"\n\nexport const filenameToContentType = (\n  filename,\n  contentTypeMap = jsenvContentTypeMap,\n  contentTypeDefault = \"application/octet-stream\",\n) => {\n  if (typeof contentTypeMap !== \"object\") {\n    throw new TypeError(`contentTypeMap must be an object, got ${contentTypeMap}`)\n  }\n\n  const extensionWithDot = extname(filename)\n\n  if (!extensionWithDot || extensionWithDot === \".\") {\n    return contentTypeDefault\n  }\n\n  const extension = extensionWithDot.slice(1)\n  const availableContentTypes = Object.keys(contentTypeMap)\n  const contentTypeForExtension = availableContentTypes.find((contentTypeName) => {\n    const contentType = contentTypeMap[contentTypeName]\n    return contentType.extensions && contentType.extensions.indexOf(extension) > -1\n  })\n  return contentTypeForExtension || contentTypeDefault\n}\n","import { fileURLToPath } from \"url\"\nimport { createReadStream, readFile, readdir, stat } from \"fs\"\nimport { bufferToEtag } from \"./internal/bufferToEtag.js\"\nimport { convertFileSystemErrorToResponseProperties } from \"./internal/convertFileSystemErrorToResponseProperties.js\"\nimport { filenameToContentType } from \"./filenameToContentType.js\"\nimport { jsenvContentTypeMap } from \"./jsenvContentTypeMap.js\"\n\nexport const serveFile = async (\n  path,\n  {\n    method = \"GET\",\n    headers = {},\n    canReadDirectory = false,\n    cacheStrategy = \"etag\",\n    contentTypeMap = jsenvContentTypeMap,\n  } = {},\n) => {\n  if (method !== \"GET\" && method !== \"HEAD\") {\n    return {\n      status: 501,\n    }\n  }\n\n  if (path.startsWith(\"file:///\")) {\n    path = fileURLToPath(path)\n  }\n\n  try {\n    const cacheWithMtime = cacheStrategy === \"mtime\"\n    const cacheWithETag = cacheStrategy === \"etag\"\n    const cachedDisabled = cacheStrategy === \"none\"\n\n    const stat = await readFileStat(path)\n\n    if (stat.isDirectory()) {\n      if (canReadDirectory === false) {\n        return {\n          status: 403,\n          statusText: \"not allowed to read directory\",\n          headers: {\n            ...(cachedDisabled ? { \"cache-control\": \"no-store\" } : {}),\n          },\n        }\n      }\n\n      const files = await readDirectory(path)\n      const filesAsJSON = JSON.stringify(files)\n\n      return {\n        status: 200,\n        headers: {\n          ...(cachedDisabled ? { \"cache-control\": \"no-store\" } : {}),\n          \"content-type\": \"application/json\",\n          \"content-length\": filesAsJSON.length,\n        },\n        body: filesAsJSON,\n      }\n    }\n\n    if (cacheWithMtime) {\n      if (\"if-modified-since\" in headers) {\n        let cachedModificationDate\n        try {\n          cachedModificationDate = new Date(headers[\"if-modified-since\"])\n        } catch (e) {\n          return {\n            status: 400,\n            statusText: \"if-modified-since header is not a valid date\",\n          }\n        }\n\n        const actualModificationDate = dateToSecondsPrecision(stat.mtime)\n        if (Number(cachedModificationDate) >= Number(actualModificationDate)) {\n          return {\n            status: 304,\n          }\n        }\n      }\n\n      return {\n        status: 200,\n        headers: {\n          ...(cachedDisabled ? { \"cache-control\": \"no-store\" } : {}),\n          \"last-modified\": dateToUTCString(stat.mtime),\n          \"content-length\": stat.size,\n          \"content-type\": filenameToContentType(path, contentTypeMap),\n        },\n        body: createReadStream(path),\n      }\n    }\n\n    if (cacheWithETag) {\n      const buffer = await readFileAsBuffer(path)\n      const eTag = bufferToEtag(buffer)\n\n      if (\"if-none-match\" in headers && headers[\"if-none-match\"] === eTag) {\n        return {\n          status: 304,\n          headers: {\n            ...(cachedDisabled ? { \"cache-control\": \"no-store\" } : {}),\n          },\n        }\n      }\n\n      return {\n        status: 200,\n        headers: {\n          ...(cachedDisabled ? { \"cache-control\": \"no-store\" } : {}),\n          \"content-length\": stat.size,\n          \"content-type\": filenameToContentType(path, contentTypeMap),\n          etag: eTag,\n        },\n        body: buffer,\n      }\n    }\n\n    return {\n      status: 200,\n      headers: {\n        \"cache-control\": \"no-store\",\n        \"content-length\": stat.size,\n        \"content-type\": filenameToContentType(path, contentTypeMap),\n      },\n      body: createReadStream(path),\n    }\n  } catch (e) {\n    return convertFileSystemErrorToResponseProperties(e)\n  }\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toUTCString\nconst dateToUTCString = (date) => date.toUTCString()\n\nconst dateToSecondsPrecision = (date) => {\n  const dateWithSecondsPrecision = new Date(date)\n  dateWithSecondsPrecision.setMilliseconds(0)\n  return dateWithSecondsPrecision\n}\n\nconst readFileAsBuffer = (path) =>\n  new Promise((resolve, reject) => {\n    readFile(path, (error, buffer) => {\n      if (error) reject(error)\n      else resolve(buffer)\n    })\n  })\n\nconst readFileStat = (path) =>\n  new Promise((resolve, reject) => {\n    stat(path, (error, stats) => {\n      if (error) reject(error)\n      else resolve(stats)\n    })\n  })\n\nconst readDirectory = (path) =>\n  new Promise((resolve, reject) => {\n    readdir(path, (error, value) => {\n      if (error) reject(error)\n      else resolve(value)\n    })\n  })\n","// eslint-disable-next-line import/no-unresolved\nimport importMap from \"/importMap.json\"\nimport { normalizeImportMap } from \"@jsenv/import-map/src/normalizeImportMap/normalizeImportMap.js\"\nimport { resolveImport } from \"@jsenv/import-map/src/resolveImport/resolveImport.js\"\n\nconst nodeRequire = require\nexport { nodeRequire as require }\n\nconst filenameContainsBackSlashes = __filename.indexOf(\"\\\\\") > -1\n\nexport const url = filenameContainsBackSlashes\n  ? `file://${__filename.replace(/\\\\/g, \"/\")}`\n  : `file://${__filename}`\n\nexport const resolve = (specifier) => {\n  return resolveImport({\n    specifier,\n    importer: url,\n    importMap: memoizedGetImportMap(),\n    defaultExtension: false,\n  })\n}\n\n// better for perf and helps rollup to tree shake this out\n// when import.meta.resolve is not used\nlet memoizedImportMap\nconst memoizedGetImportMap = () => {\n  if (memoizedImportMap) return memoizedImportMap\n  memoizedImportMap = normalizeImportMap(importMap, url)\n  return memoizedImportMap\n}\n","let beforeExitCallbackArray = []\nlet uninstall\nconst addCallback = (callback) => {\n  if (beforeExitCallbackArray.length === 0) uninstall = install()\n  beforeExitCallbackArray = [...beforeExitCallbackArray, callback]\n\n  return () => {\n    if (beforeExitCallbackArray.length === 0) return\n    beforeExitCallbackArray = beforeExitCallbackArray.filter(\n      (beforeExitCallback) => beforeExitCallback !== callback,\n    )\n    if (beforeExitCallbackArray.length === 0) uninstall()\n  }\n}\n\nconst install = () => {\n  const onBeforeExit = () => {\n    return beforeExitCallbackArray.reduce(async (previous, callback) => {\n      await previous\n      return callback()\n    }, Promise.resolve())\n  }\n  process.once(\"beforeExit\", onBeforeExit)\n  return () => {\n    process.removeListener(\"beforeExit\", onBeforeExit)\n  }\n}\n\nexport const beforeExitSignal = {\n  addCallback,\n}\n","const addCallback = (callback) => {\n  const triggerDeath = () => callback()\n  // SIGTERM http://man7.org/linux/man-pages/man7/signal.7.html\n  process.once(\"SIGTERM\", triggerDeath)\n  return () => {\n    process.removeListener(\"SIGTERM\", triggerDeath)\n  }\n}\n\nexport const deathSignal = {\n  addCallback,\n}\n","const addCallback = (callback, { collectExceptions = false } = {}) => {\n  if (!collectExceptions) {\n    const exitCallback = () => {\n      callback()\n    }\n    process.on(\"exit\", exitCallback)\n    return () => {\n      process.removeListener(\"exit\", exitCallback)\n    }\n  }\n\n  const { getExceptions, stop } = trackExceptions()\n  const exitCallback = () => {\n    process.removeListener(\"exit\", exitCallback)\n    stop()\n    callback({\n      exceptionArray: getExceptions().map(({ exception, origin }) => {\n        return { exception, origin }\n      }),\n    })\n  }\n  process.on(\"exit\", exitCallback)\n  return () => {\n    process.removeListener(\"exit\", exitCallback)\n  }\n}\n\nconst trackExceptions = () => {\n  let exceptionArray = []\n\n  const unhandledRejectionCallback = (unhandledRejection, promise) => {\n    exceptionArray = [\n      ...exceptionArray,\n      { origin: \"unhandledRejection\", exception: unhandledRejection, promise },\n    ]\n  }\n\n  const rejectionHandledCallback = (promise) => {\n    exceptionArray = exceptionArray.filter((exceptionArray) => exceptionArray.promise !== promise)\n  }\n\n  const uncaughtExceptionCallback = (uncaughtException, origin) => {\n    // since node 12.4 https://nodejs.org/docs/latest-v12.x/api/process.html#process_event_uncaughtexception\n    if (origin === \"unhandledRejection\") return\n\n    exceptionArray = [\n      ...exceptionArray,\n      { origin: \"uncaughtException\", exception: uncaughtException },\n    ]\n  }\n\n  process.on(\"unhandledRejection\", unhandledRejectionCallback)\n  process.on(\"rejectionHandled\", rejectionHandledCallback)\n  process.on(\"uncaughtException\", uncaughtExceptionCallback)\n\n  return {\n    getExceptions: () => exceptionArray,\n    stop: () => {\n      process.removeListener(\"unhandledRejection\", unhandledRejectionCallback)\n      process.removeListener(\"rejectionHandled\", rejectionHandledCallback)\n      process.removeListener(\"uncaughtException\", uncaughtExceptionCallback)\n    },\n  }\n}\n\nexport const exitSignal = {\n  addCallback,\n}\n","const addCallback = (callback) => {\n  const triggerHangUpOrDeath = () => callback()\n  // SIGHUP http://man7.org/linux/man-pages/man7/signal.7.html\n  process.once(\"SIGUP\", triggerHangUpOrDeath)\n  return () => {\n    process.removeListener(\"SIGUP\", triggerHangUpOrDeath)\n  }\n}\n\nexport const hangupOrDeathSignal = {\n  addCallback,\n}\n","const addCallback = (callback) => {\n  // SIGINT is CTRL+C from keyboard\n  // http://man7.org/linux/man-pages/man7/signal.7.html\n  // may also be sent by vscode https://github.com/Microsoft/vscode-node-debug/issues/1#issuecomment-405185642\n  process.once(\"SIGINT\", callback)\n  return () => {\n    process.removeListener(\"SIGINT\", callback)\n  }\n}\n\nexport const interruptSignal = {\n  addCallback,\n}\n","import { beforeExitSignal } from \"./beforeExitSignal.js\"\nimport { exitSignal } from \"./exitSignal.js\"\nimport { deathSignal } from \"./deathSignal.js\"\nimport { hangupOrDeathSignal } from \"./hangupOrDeathSignal.js\"\n\n// when any of SIGUP, SIGINT, SIGTERM, beforeExit, exit is emitted callback is called\n// usefull to ensure a given server is closed when process stops for instance\nconst addCallback = (callback) => {\n  return eventRace({\n    beforeExit: {\n      register: beforeExitSignal.addCallback,\n      callback: () => callback(\"beforeExit\"),\n    },\n    hangupOrDeath: {\n      register: hangupOrDeathSignal.addCallback,\n      callback: () => callback(\"hangupOrDeath\"),\n    },\n    death: {\n      register: deathSignal.addCallback,\n      callback: () => callback(\"death\"),\n    },\n    exit: {\n      register: exitSignal.addCallback,\n      callback: () => callback(\"exit\"),\n    },\n  })\n}\n\nconst eventRace = (eventMap) => {\n  const unregisterMap = {}\n\n  const unregisterAll = (reason) => {\n    return Object.keys(unregisterMap).map((name) => unregisterMap[name](reason))\n  }\n\n  Object.keys(eventMap).forEach((name) => {\n    const { register, callback } = eventMap[name]\n\n    unregisterMap[name] = register((...args) => {\n      unregisterAll()\n      callback(...args)\n    })\n  })\n\n  return unregisterAll\n}\n\nexport const teardownSignal = {\n  addCallback,\n}\n","export const firstOperationMatching = ({ array, start, predicate }) => {\n  if (typeof array !== \"object\") throw new TypeError(createArrayErrorMessage({ array }))\n  if (typeof start !== \"function\") throw new TypeError(createStartErrorMessage({ start }))\n  if (typeof predicate !== \"function\")\n    throw new TypeError(createPredicateErrorMessage({ predicate }))\n\n  return new Promise((resolve, reject) => {\n    const visit = (index) => {\n      if (index >= array.length) {\n        return resolve()\n      }\n      const input = array[index]\n      const returnValue = start(input)\n      return Promise.resolve(returnValue).then((output) => {\n        if (predicate(output)) {\n          return resolve(output)\n        }\n        return visit(index + 1)\n      }, reject)\n    }\n\n    visit(0)\n  })\n}\n\nconst createArrayErrorMessage = ({ array }) => `array must be an object.\narray: ${array}`\n\nconst createStartErrorMessage = ({ start }) => `start must be a function.\nstart: ${start}`\n\nconst createPredicateErrorMessage = ({ predicate }) => `predicate must be a function.\npredicate: ${predicate}`\n","/*\nwhy unadvised ?\n- First because you should not do anything when a process uncaughtException\nor unhandled rejection happens.\nYou cannot assume assume or trust the state of your process so you're\nlikely going to throw an other error trying to handle the first one.\n- Second because the error stack trace will be modified making it harder\nto reach back what cause the error\n\nInstead you should monitor your process with an other one\nand when the monitored process die, here you can do what you want\nlike analysing logs to find what cause process to die, ping a log server, ...\n*/\n\nimport { firstOperationMatching } from \"./internal/firstOperationMatching.js\"\n\nlet recoverCallbackArray = []\nlet uninstall\nconst addCallback = (callback) => {\n  if (recoverCallbackArray.length === 0) uninstall = install()\n  recoverCallbackArray = [...recoverCallbackArray, callback]\n  return () => {\n    if (recoverCallbackArray.length === 0) return\n    recoverCallbackArray = recoverCallbackArray.filter(\n      (recoverCallback) => recoverCallback !== callback,\n    )\n    if (recoverCallbackArray.length === 0) uninstall()\n  }\n}\n\nconst install = () => {\n  const onUncaughtException = (error) => triggerUncaughtException(error)\n\n  const onUnhandledRejection = (value, promise) => triggerUnhandledRejection(value, promise)\n\n  const onRejectionHandled = (promise) =>\n    recoverExceptionMatching((exception) => exception.promise === promise)\n\n  process.on(\"unhandledRejection\", onUnhandledRejection)\n  process.on(\"rejectionHandled\", onRejectionHandled)\n  process.on(\"uncaughtException\", onUncaughtException)\n\n  return () => {\n    process.removeListener(\"unhandledRejection\", onUnhandledRejection)\n    process.removeListener(\"rejectionHandled\", onRejectionHandled)\n    process.removeListener(\"uncaughtException\", onRejectionHandled)\n  }\n}\n\nconst triggerUncaughtException = (error) => crash({ type: \"uncaughtException\", value: error })\n\nconst triggerUnhandledRejection = (value, promise) =>\n  crash({ type: \"unhandledRejection\", value, promise })\n\nlet isCrashing = false\nlet crashReason\nlet resolveRecovering\n\nconst crash = async (reason) => {\n  if (isCrashing) {\n    console.log(`cannot recover due to ${crashReason.type} during recover`)\n    console.error(crashReason.value)\n    resolveRecovering(false)\n    return\n  }\n\n  console.log(`process starts crashing due to ${crashReason.type}`)\n  console.log(`trying to recover`)\n\n  isCrashing = true\n  crashReason = reason\n\n  const externalRecoverPromise = new Promise((resolve) => {\n    resolveRecovering = resolve\n  })\n  const callbackRecoverPromise = firstOperationMatching({\n    array: recoverCallbackArray,\n    start: (recoverCallback) => recoverCallback(reason),\n    predicate: (recovered) => typeof recovered === \"boolean\",\n  })\n  const recoverPromise = Promise.race([externalRecoverPromise, callbackRecoverPromise])\n\n  try {\n    const recovered = await recoverPromise\n    if (recovered) return\n  } catch (error) {\n    console.error(`cannot recover due to internal recover error`)\n    console.error(error)\n  }\n\n  crashReason = undefined\n  // uninstall() prevent catching of the next throw\n  // else the following would create an infinite loop\n  // process.on('uncaughtException', function() {\n  //     setTimeout(function() {\n  //         throw 'yo';\n  //     });\n  // });\n  uninstall()\n  throw reason.value // this mess up the stack trace :'(\n  /* eslint-disable no-unreachable */\n  // the throw above may be catched by other mecanics\n  // so we may arrive there\n  uninstall = install()\n}\n\nconst recoverExceptionMatching = (predicate) => {\n  if (isCrashing && predicate(crashReason)) {\n    resolveRecovering(true)\n  }\n}\n\nexport const unadvisedCrashSignal = {\n  addCallback,\n}\n","export const memoizeOnce = (compute) => {\n  let locked = false\n  let lockValue\n\n  const memoized = (...args) => {\n    if (locked) return lockValue\n    // if compute is recursive wait for it to be fully done before storing the lockValue\n    // so set locked later\n    lockValue = compute(...args)\n    locked = true\n    return lockValue\n  }\n\n  memoized.deleteCache = () => {\n    const value = lockValue\n    locked = false\n    lockValue = undefined\n    return value\n  }\n\n  return memoized\n}\n","export const urlToOrigin = (url) => {\n  return new URL(url).origin\n}\n","export const trackConnections = (nodeServer) => {\n  const connections = new Set()\n\n  const connectionListener = (connection) => {\n    connection.on(\"close\", () => {\n      connections.delete(connection)\n    })\n    connections.add(connection)\n  }\n\n  nodeServer.on(\"connection\", connectionListener)\n\n  const stop = (reason) => {\n    nodeServer.removeListener(\"connection\", connectionListener)\n\n    // should we do this async ?\n    connections.forEach((connection) => {\n      connection.destroy(reason)\n    })\n  }\n\n  return { stop }\n}\n","export const trackClients = (nodeServer) => {\n  const clients = new Set()\n\n  const clientListener = (nodeRequest, nodeResponse) => {\n    const client = { nodeRequest, nodeResponse }\n\n    clients.add(client)\n    nodeResponse.on(\"finish\", () => {\n      clients.delete(client)\n    })\n  }\n\n  nodeServer.on(\"request\", clientListener)\n\n  const stop = ({ status, reason }) => {\n    nodeServer.removeListener(\"request\", clientListener)\n\n    return Promise.all(\n      Array.from(clients).map(({ nodeResponse }) => {\n        if (nodeResponse.headersSent === false) {\n          nodeResponse.writeHead(status, reason)\n        }\n\n        return new Promise((resolve) => {\n          if (nodeResponse.finished === false) {\n            nodeResponse.on(\"finish\", resolve)\n            nodeResponse.on(\"error\", resolve)\n            nodeResponse.destroy(reason)\n          } else {\n            resolve()\n          }\n        })\n      }),\n    )\n  }\n\n  return { stop }\n}\n","export const trackRequestHandlers = (nodeServer) => {\n  const requestHandlers = []\n  const add = (handler) => {\n    requestHandlers.push(handler)\n    nodeServer.on(\"request\", handler)\n    return () => {\n      nodeServer.removeListener(\"request\", handler)\n    }\n  }\n\n  const stop = () => {\n    requestHandlers.forEach((requestHandler) => {\n      nodeServer.removeListener(\"request\", requestHandler)\n    })\n    requestHandlers.length = 0\n  }\n\n  return { add, stop }\n}\n","import { createObservable } from \"./observable.js\"\n\nexport const nodeStreamToObservable = (nodeStream) => {\n  return createObservable({\n    subscribe: ({ next, error, complete }) => {\n      // should we do nodeStream.resume() in case the stream was paused\n      nodeStream.on(\"data\", next)\n      nodeStream.once(\"error\", error)\n      nodeStream.once(\"end\", complete)\n\n      const unsubscribe = () => {\n        nodeStream.removeListener(\"data\", next)\n        nodeStream.removeListener(\"error\", error)\n        nodeStream.removeListener(\"end\", complete)\n\n        if (nodeStreamIsNodeRequest(nodeStream)) {\n          nodeStream.abort()\n        } else {\n          nodeStream.destroy()\n        }\n      }\n\n      if (nodeStreamIsNodeRequest(nodeStream)) {\n        nodeStream.once(\"abort\", unsubscribe)\n      }\n\n      return {\n        unsubscribe,\n      }\n    },\n  })\n}\n\nconst nodeStreamIsNodeRequest = (nodeStream) =>\n  \"abort\" in nodeStream && \"flushHeaders\" in nodeStream\n","export const normalizeHeaderName = (headerName) => {\n  headerName = String(headerName)\n  if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(headerName)) {\n    throw new TypeError(\"Invalid character in header field name\")\n  }\n\n  return headerName.toLowerCase()\n}\n","export const normalizeHeaderValue = (headerValue) => {\n  return String(headerValue)\n}\n","/*\nhttps://developer.mozilla.org/en-US/docs/Web/API/Headers\nhttps://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\n*/\n\nimport { normalizeHeaderName } from \"./normalizeHeaderName.js\"\nimport { normalizeHeaderValue } from \"./normalizeHeaderValue.js\"\n\nexport const headersFromObject = (headersObject) => {\n  const headers = {}\n\n  Object.keys(headersObject).forEach((headerName) => {\n    headers[normalizeHeaderName(headerName)] = normalizeHeaderValue(headersObject[headerName])\n  })\n\n  return headers\n}\n","import { nodeStreamToObservable } from \"./nodeStreamToObservable.js\"\nimport { headersFromObject } from \"./headersFromObject.js\"\n\nexport const nodeRequestToRequest = (nodeRequest, origin) => {\n  const ressource = nodeRequest.url\n  const { method } = nodeRequest\n  const headers = headersFromObject(nodeRequest.headers)\n  const body =\n    method === \"POST\" || method === \"PUT\" || method === \"PATCH\"\n      ? nodeStreamToObservable(nodeRequest)\n      : undefined\n\n  return Object.freeze({\n    origin,\n    ressource,\n    method,\n    headers,\n    body,\n  })\n}\n","import { createObservable } from \"./observable.js\"\n\nexport const valueToObservable = (value) => {\n  return createObservable({\n    subscribe: ({ next, complete }) => {\n      next(value)\n      complete()\n      return {\n        unsubscribe: () => {},\n      }\n    },\n  })\n}\n","import { Stream, Writable, Readable } from \"stream\"\nimport { isObservable, subscribe } from \"./observable.js\"\nimport { nodeStreamToObservable } from \"./nodeStreamToObservable.js\"\nimport { valueToObservable } from \"./valueToObservable.js\"\n\nexport const populateNodeResponse = (\n  nodeResponse,\n  { status, statusText, headers, body, bodyEncoding },\n  { ignoreBody },\n) => {\n  const nodeHeaders = headersToNodeHeaders(headers)\n  // nodejs strange signature for writeHead force this\n  // https://nodejs.org/api/http.html#http_response_writehead_statuscode_statusmessage_headers\n  if (statusText === undefined) {\n    nodeResponse.writeHead(status, nodeHeaders)\n  } else {\n    nodeResponse.writeHead(status, statusText, nodeHeaders)\n  }\n  if (ignoreBody) {\n    nodeResponse.end()\n    return\n  }\n\n  if (bodyEncoding) {\n    nodeResponse.setEncoding(bodyEncoding)\n  }\n\n  const observable = bodyToObservable(body)\n  const subscription = subscribe(observable, {\n    next: (data) => {\n      nodeResponse.write(data)\n    },\n    error: (value) => {\n      nodeResponse.emit(\"error\", value)\n    },\n    complete: () => {\n      nodeResponse.end()\n    },\n  })\n  nodeResponse.once(\"close\", () => {\n    // close body in case nodeResponse is prematurely closed\n    // while body is writing\n    // it may happen in case of server sent event\n    // where body is kept open to write to client\n    // and the browser is reloaded or closed for instance\n    subscription.unsubscribe()\n  })\n}\n\nconst mapping = {\n  // \"content-type\": \"Content-Type\",\n  // \"last-modified\": \"Last-Modified\",\n}\n\nconst headersToNodeHeaders = (headers) => {\n  const nodeHeaders = {}\n\n  Object.keys(headers).forEach((name) => {\n    const nodeHeaderName = name in mapping ? mapping[name] : name\n    nodeHeaders[nodeHeaderName] = headers[name]\n  })\n\n  return nodeHeaders\n}\n\nconst bodyToObservable = (body) => {\n  if (isObservable(body)) return body\n  if (isNodeStream(body)) return nodeStreamToObservable(body)\n  return valueToObservable(body)\n}\n\nconst isNodeStream = (value) => {\n  if (value === undefined) return false\n  if (value instanceof Stream) return true\n  if (value instanceof Writable) return true\n  if (value instanceof Readable) return true\n  return false\n}\n","// https://github.com/Marak/colors.js/blob/b63ef88e521b42920a9e908848de340b31e68c9d/lib/styles.js#L29\n\nconst close = \"\\x1b[0m\"\nconst red = \"\\x1b[31m\"\nconst green = \"\\x1b[32m\"\nconst yellow = \"\\x1b[33m\"\n// const blue = \"\\x1b[34m\"\nconst magenta = \"\\x1b[35m\"\nconst cyan = \"\\x1b[36m\"\n// const white = \"\\x1b[37m\"\n\nexport const colorizeResponseStatus = (status) => {\n  const statusType = statusToType(status)\n\n  if (statusType === \"information\") return `${cyan}${status}${close}`\n  if (statusType === \"success\") return `${green}${status}${close}`\n  if (statusType === \"redirection\") return `${magenta}${status}${close}`\n  if (statusType === \"client-error\") return `${yellow}${status}${close}`\n  if (statusType === \"server-error\") return `${red}${status}${close}`\n  return status\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status\nconst statusToType = (status) => {\n  if (statusIsInformation(status)) return \"information\"\n  if (statusIsSuccess(status)) return \"success\"\n  if (statusIsRedirection(status)) return \"redirection\"\n  if (statusIsClientError(status)) return \"client-error\"\n  if (statusIsServerError(status)) return \"server-error\"\n  return \"unknown\"\n}\n\nconst statusIsInformation = (status) => status >= 100 && status < 200\n\nconst statusIsSuccess = (status) => status >= 200 && status < 300\n\nconst statusIsRedirection = (status) => status >= 300 && status < 400\n\nconst statusIsClientError = (status) => status >= 400 && status < 500\n\nconst statusIsServerError = (status) => status >= 500 && status < 600\n","import { URL } from \"url\"\n\nexport const originAsString = ({ protocol, ip, port }) => {\n  const url = new URL(\"https://127.0.0.1:80\")\n  url.protocol = protocol\n  url.hostname = ip\n  url.port = port\n  return url.origin\n}\n","const createReason = (reasonString) => {\n  return {\n    toString: () => reasonString,\n  }\n}\n\nexport const STOP_REASON_INTERNAL_ERROR = createReason(\"internal error\")\nexport const STOP_REASON_PROCESS_SIGINT = createReason(\"process sigint\")\nexport const STOP_REASON_PROCESS_BEFORE_EXIT = createReason(\"process before exit\")\nexport const STOP_REASON_PROCESS_HANGUP_OR_DEATH = createReason(\"process hangup or death\")\nexport const STOP_REASON_PROCESS_DEATH = createReason(\"process death\")\nexport const STOP_REASON_PROCESS_EXIT = createReason(\"process exit\")\nexport const STOP_REASON_NOT_SPECIFIED = createReason(\"not specified\")\n","/* eslint-disable import/max-dependencies */\nimport { createServer as createNodeServer, STATUS_CODES } from \"http\"\nimport { createServer as createNodeSecureServer, Agent as SecureAgent } from \"https\"\nimport {\n  createCancellationToken,\n  createOperation,\n  createStoppableOperation,\n} from \"@jsenv/cancellation\"\nimport { interruptSignal, unadvisedCrashSignal, teardownSignal } from \"@jsenv/node-signals\"\nimport { createLogger } from \"@jsenv/logger\"\nimport { memoizeOnce } from \"./internal/memoizeOnce.js\"\nimport { urlToOrigin } from \"./internal/urlToOrigin.js\"\nimport { trackConnections } from \"./internal/trackConnections.js\"\nimport { trackClients } from \"./internal/trackClients.js\"\nimport { trackRequestHandlers } from \"./internal/trackRequestHandlers.js\"\nimport { nodeRequestToRequest } from \"./internal/nodeRequestToRequest.js\"\nimport { composeResponseHeaders } from \"./internal/composeResponseHeaders.js\"\nimport { populateNodeResponse } from \"./internal/populateNodeResponse.js\"\nimport { colorizeResponseStatus } from \"./internal/colorizeResponseStatus.js\"\nimport { originAsString } from \"./internal/originAsString.js\"\nimport { listen, stopListening } from \"./internal/listen.js\"\nimport { composeResponse } from \"./composeResponse.js\"\nimport {\n  STOP_REASON_INTERNAL_ERROR,\n  STOP_REASON_PROCESS_SIGINT,\n  STOP_REASON_PROCESS_BEFORE_EXIT,\n  STOP_REASON_PROCESS_HANGUP_OR_DEATH,\n  STOP_REASON_PROCESS_DEATH,\n  STOP_REASON_PROCESS_EXIT,\n  STOP_REASON_NOT_SPECIFIED,\n} from \"./stopReasons.js\"\nimport { jsenvAccessControlAllowedHeaders } from \"./jsenvAccessControlAllowedHeaders.js\"\nimport { jsenvAccessControlAllowedMethods } from \"./jsenvAccessControlAllowedMethods.js\"\nimport { jsenvPrivateKey, jsenvCertificate } from \"./jsenvSignature.js\"\n\nconst killPort = import.meta.require(\"kill-port\")\n\nconst STATUS_TEXT_INTERNAL_ERROR = \"internal error\"\n\nexport const startServer = async ({\n  cancellationToken = createCancellationToken(),\n  logLevel,\n\n  protocol = \"http\",\n  ip = \"127.0.0.1\",\n  port = 0, // assign a random available port\n  forcePort = false,\n  privateKey = jsenvPrivateKey,\n  certificate = jsenvCertificate,\n\n  stopOnSIGINT = true,\n  // auto close the server when the process exits\n  stopOnExit = true,\n  // auto close when server respond with a 500\n  stopOnInternalError = false,\n  // auto close the server when an uncaughtException happens\n  stopOnCrash = false,\n  keepProcessAlive = true,\n  requestToResponse = () => null,\n\n  accessControlAllowedOrigins = [],\n  accessControlAllowedMethods = jsenvAccessControlAllowedMethods,\n  accessControlAllowedHeaders = jsenvAccessControlAllowedHeaders,\n  accessControlAllowRequestOrigin = false,\n  accessControlAllowRequestMethod = false,\n  accessControlAllowRequestHeaders = false,\n  accessControlAllowCredentials = false,\n  // by default OPTIONS request can be cache for a long time, it's not going to change soon ?\n  // we could put a lot here, see https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Max-Age\n  accessControlMaxAge = 600,\n\n  sendInternalErrorStack = false,\n  internalErrorToResponseProperties = (error) => {\n    const body = error\n      ? JSON.stringify({\n          code: error.code || \"UNKNOWN_ERROR\",\n          ...(sendInternalErrorStack ? { stack: error.stack } : {}),\n        })\n      : JSON.stringify({ code: \"VALUE_THROWED\", value: error })\n\n    return {\n      headers: {\n        \"content-type\": \"application/json\",\n        \"content-length\": Buffer.byteLength(body),\n      },\n      body,\n    }\n  },\n  startedCallback = () => {},\n  stoppedCallback = () => {},\n} = {}) => {\n  if (port === 0 && forcePort) throw new Error(`no need to pass forcePort when port is 0`)\n  if (protocol !== \"http\" && protocol !== \"https\")\n    throw new Error(`protocol must be http or https, got ${protocol}`)\n  // https://github.com/nodejs/node/issues/14900\n  if (ip === \"0.0.0.0\" && process.platform === \"win32\")\n    throw new Error(`listening ${ip} not available on window`)\n\n  const logger = createLogger({ logLevel })\n\n  if (forcePort) {\n    await createOperation({\n      cancellationToken,\n      start: () => killPort(port),\n    })\n  }\n\n  const { nodeServer, agent } = getNodeServerAndAgent({ protocol, privateKey, certificate })\n\n  // https://nodejs.org/api/net.html#net_server_unref\n  if (!keepProcessAlive) {\n    nodeServer.unref()\n  }\n\n  let status = \"starting\"\n\n  const { registerCleanupCallback, cleanup } = createTracker()\n\n  const connectionTracker = trackConnections(nodeServer)\n  // opened connection must be shutdown before the close event is emitted\n  registerCleanupCallback(connectionTracker.stop)\n\n  const clientTracker = trackClients(nodeServer)\n  registerCleanupCallback((reason) => {\n    let responseStatus\n    if (reason === STOP_REASON_INTERNAL_ERROR) {\n      responseStatus = 500\n      // reason = 'shutdown because error'\n    } else {\n      responseStatus = 503\n      // reason = 'unavailable because closing'\n    }\n    clientTracker.stop({ status: responseStatus, reason })\n  })\n\n  const requestHandlerTracker = trackRequestHandlers(nodeServer)\n  // ensure we don't try to handle request while server is closing\n  registerCleanupCallback(requestHandlerTracker.stop)\n\n  let stoppedResolve\n  const stoppedPromise = new Promise((resolve) => {\n    stoppedResolve = resolve\n  })\n  const stop = memoizeOnce(async (reason = STOP_REASON_NOT_SPECIFIED) => {\n    status = \"closing\"\n    logger.info(`server stopped because ${reason}`)\n\n    await cleanup(reason)\n    await stopListening(nodeServer)\n    status = \"stopped\"\n    stoppedCallback({ reason })\n    stoppedResolve(reason)\n  })\n  const startOperation = createStoppableOperation({\n    cancellationToken,\n    start: () => listen({ cancellationToken, server: nodeServer, port, ip }),\n    stop: (_, reason) => stop(reason),\n  })\n\n  if (stopOnCrash) {\n    const unregister = unadvisedCrashSignal.addCallback((reason) => {\n      stop(reason.value)\n    })\n    registerCleanupCallback(unregister)\n  }\n\n  if (stopOnInternalError) {\n    const unregister = requestHandlerTracker.add((nodeRequest, nodeResponse) => {\n      if (\n        nodeResponse.statusCode === 500 &&\n        nodeResponse.statusMessage === STATUS_TEXT_INTERNAL_ERROR\n      ) {\n        stop(STOP_REASON_INTERNAL_ERROR)\n      }\n    })\n    registerCleanupCallback(unregister)\n  }\n\n  if (stopOnExit) {\n    const unregister = teardownSignal.addCallback((tearDownReason) => {\n      stop(\n        {\n          beforeExit: STOP_REASON_PROCESS_BEFORE_EXIT,\n          hangupOrDeath: STOP_REASON_PROCESS_HANGUP_OR_DEATH,\n          death: STOP_REASON_PROCESS_DEATH,\n          exit: STOP_REASON_PROCESS_EXIT,\n        }[tearDownReason],\n      )\n    })\n    registerCleanupCallback(unregister)\n  }\n\n  if (stopOnSIGINT) {\n    const unregister = interruptSignal.addCallback(() => {\n      stop(STOP_REASON_PROCESS_SIGINT)\n    })\n    registerCleanupCallback(unregister)\n  }\n\n  port = await startOperation\n  status = \"opened\"\n  const origin = originAsString({ protocol, ip, port })\n  logger.info(`server started at ${origin}`)\n  startedCallback({ origin })\n\n  // nodeServer.on(\"upgrade\", (request, socket, head) => {\n  //   // when being requested using a websocket\n  //   // we could also answr to the request ?\n  //   // socket.end([data][, encoding])\n\n  //   console.log(\"upgrade\", { head, request })\n  //   console.log(\"socket\", { connecting: socket.connecting, destroyed: socket.destroyed })\n  // })\n\n  requestHandlerTracker.add(async (nodeRequest, nodeResponse) => {\n    const { request, response, error } = await generateResponseDescription({\n      nodeRequest,\n      origin,\n    })\n\n    if (\n      request.method !== \"HEAD\" &&\n      response.headers[\"content-length\"] > 0 &&\n      response.body === \"\"\n    ) {\n      logger.error(\n        createContentLengthMismatchError(\n          `content-length header is ${response.headers[\"content-length\"]} but body is empty`,\n        ),\n      )\n    }\n\n    logger.info(`${request.method} ${request.origin}${request.ressource}`)\n    if (error) {\n      logger.error(error)\n    }\n    logger.info(`${colorizeResponseStatus(response.status)} ${response.statusText}`)\n    populateNodeResponse(nodeResponse, response, {\n      ignoreBody: request.method === \"HEAD\",\n    })\n  })\n\n  const corsEnabled = accessControlAllowRequestOrigin || accessControlAllowedOrigins.length\n  // here we check access control options to throw or warn if we find strange values\n\n  const generateResponseDescription = async ({ nodeRequest, origin }) => {\n    const request = nodeRequestToRequest(nodeRequest, origin)\n\n    nodeRequest.on(\"error\", (error) => {\n      logger.error(\"error on\", request.ressource, error)\n    })\n\n    const responsePropertiesToResponse = ({\n      status = 501,\n      statusText = statusToStatusText(status),\n      headers = {},\n      body = \"\",\n      bodyEncoding,\n    }) => {\n      if (corsEnabled) {\n        const accessControlHeaders = generateAccessControlHeaders({\n          request,\n          accessControlAllowedOrigins,\n          accessControlAllowRequestOrigin,\n          accessControlAllowedMethods,\n          accessControlAllowRequestMethod,\n          accessControlAllowedHeaders,\n          accessControlAllowRequestHeaders,\n          accessControlAllowCredentials,\n          accessControlMaxAge,\n        })\n\n        return {\n          status,\n          statusText,\n          headers: composeResponseHeaders(headers, accessControlHeaders),\n          body,\n          bodyEncoding,\n        }\n      }\n\n      return {\n        status,\n        statusText,\n        headers,\n        body,\n        bodyEncoding,\n      }\n    }\n\n    try {\n      if (corsEnabled && request.method === \"OPTIONS\") {\n        return {\n          request,\n          response: responsePropertiesToResponse({\n            status: 200,\n            headers: {\n              \"content-length\": 0,\n            },\n          }),\n        }\n      }\n\n      const responseProperties = await requestToResponse(request)\n      return {\n        request,\n        response: responsePropertiesToResponse(responseProperties),\n      }\n    } catch (error) {\n      return {\n        request,\n        response: composeResponse(\n          responsePropertiesToResponse({\n            status: 500,\n            statusText: STATUS_TEXT_INTERNAL_ERROR,\n            headers: {\n              // ensure error are not cached\n              \"cache-control\": \"no-store\",\n              \"content-type\": \"text/plain\",\n            },\n          }),\n          internalErrorToResponseProperties(error),\n        ),\n        error,\n      }\n    }\n  }\n\n  return {\n    getStatus: () => status,\n    origin,\n    nodeServer,\n    // TODO: remove agent\n    agent,\n    stop,\n    stoppedPromise,\n  }\n}\n\nconst createTracker = () => {\n  const callbackArray = []\n\n  const registerCleanupCallback = (callback) => {\n    if (typeof callback !== \"function\")\n      throw new TypeError(`callback must be a function\ncallback: ${callback}`)\n    callbackArray.push(callback)\n  }\n\n  const cleanup = async (reason) => {\n    const localCallbackArray = callbackArray.slice()\n    await Promise.all(localCallbackArray.map((callback) => callback(reason)))\n  }\n\n  return { registerCleanupCallback, cleanup }\n}\n\nconst statusToStatusText = (status) => STATUS_CODES[status] || \"not specified\"\n\nconst getNodeServerAndAgent = ({ protocol, privateKey, certificate }) => {\n  if (protocol === \"http\") {\n    return {\n      nodeServer: createNodeServer(),\n      agent: global.Agent,\n    }\n  }\n\n  if (protocol === \"https\") {\n    if (!privateKey) {\n      throw new Error(`missing privateKey for https server`)\n    }\n    if (!certificate) {\n      throw new Error(`missing certificate for https server`)\n    }\n    if (privateKey !== jsenvPrivateKey && certificate === jsenvCertificate) {\n      throw new Error(`you passed a privateKey without certificate`)\n    }\n    if (certificate !== jsenvCertificate && privateKey === jsenvPrivateKey) {\n      throw new Error(`you passed a certificate without privateKey`)\n    }\n\n    return {\n      nodeServer: createNodeSecureServer({\n        key: privateKey,\n        cert: certificate,\n      }),\n      agent: new SecureAgent({\n        rejectUnauthorized: false, // allow self signed certificate\n      }),\n    }\n  }\n\n  throw new Error(`unsupported protocol ${protocol}`)\n}\n\nconst createContentLengthMismatchError = (message) => {\n  const error = new Error(message)\n  error.code = \"CONTENT_LENGTH_MISMATCH\"\n  error.name = error.code\n  return error\n}\n\n// https://www.w3.org/TR/cors/\n// https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\nconst generateAccessControlHeaders = ({\n  request: { headers },\n  accessControlAllowedOrigins,\n  accessControlAllowRequestOrigin,\n  accessControlAllowedMethods,\n  accessControlAllowRequestMethod,\n  accessControlAllowedHeaders,\n  accessControlAllowRequestHeaders,\n  accessControlAllowCredentials,\n  // by default OPTIONS request can be cache for a long time, it's not going to change soon ?\n  // we could put a lot here, see https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Max-Age\n  accessControlMaxAge = 600,\n} = {}) => {\n  const vary = []\n\n  const allowedOriginArray = [...accessControlAllowedOrigins]\n  if (accessControlAllowRequestOrigin) {\n    if (\"origin\" in headers && headers.origin !== \"null\") {\n      allowedOriginArray.push(headers.origin)\n      vary.push(\"origin\")\n    } else if (\"referer\" in headers) {\n      allowedOriginArray.push(urlToOrigin(headers.referer))\n      vary.push(\"referer\")\n    } else {\n      allowedOriginArray.push(\"*\")\n    }\n  }\n\n  const allowedMethodArray = [...accessControlAllowedMethods]\n  if (accessControlAllowRequestMethod && \"access-control-request-method\" in headers) {\n    const requestMethodName = headers[\"access-control-request-method\"]\n    if (!allowedMethodArray.includes(requestMethodName)) {\n      allowedMethodArray.push(requestMethodName)\n      vary.push(\"access-control-request-method\")\n    }\n  }\n\n  const allowedHeaderArray = [...accessControlAllowedHeaders]\n  if (accessControlAllowRequestHeaders && \"access-control-request-headers\" in headers) {\n    const requestHeaderNameArray = headers[\"access-control-request-headers\"].split(\", \")\n    requestHeaderNameArray.forEach((headerName) => {\n      const headerNameLowerCase = headerName.toLowerCase()\n      if (!allowedHeaderArray.includes(headerNameLowerCase)) {\n        allowedHeaderArray.push(headerNameLowerCase)\n        if (!vary.includes(\"access-control-request-headers\")) {\n          vary.push(\"access-control-request-headers\")\n        }\n      }\n    })\n  }\n\n  return {\n    \"access-control-allow-origin\": allowedOriginArray.join(\", \"),\n    \"access-control-allow-methods\": allowedMethodArray.join(\", \"),\n    \"access-control-allow-headers\": allowedHeaderArray.join(\", \"),\n    ...(accessControlAllowCredentials ? { \"access-control-allow-credentials\": true } : {}),\n    \"access-control-max-age\": accessControlMaxAge,\n    ...(vary.length ? { vary: vary.join(\", \") } : {}),\n  }\n}\n"],"names":["acceptsContentType","acceptHeader","contentType","split","some","acceptRaw","accept","parseAccept","typeMatches","type","acceptTrimmed","trim","scoreIndex","indexOf","score","beforeScore","slice","afterScore","length","parseFloat","pattern","typeComposition","decomposeType","patternComposition","subtype","fullType","parts","compositionMappingToComposeStrict","compositionMapping","createInitial","reducer","compositionMappingToStrictReducer","objects","reduce","propertyComposeStrict","key","previous","current","propertyExistInCurrent","propertyExistInPrevious","composeProperty","composed","Object","keys","forEach","compositionMappingToCompose","compositionMappingToReducer","propertyHasComposer","composerForProperty","composeHeaderValues","value","nextValue","headerValues","includes","push","join","headerCompositionMapping","vary","composeResponseHeaders","responseCompositionMapping","status","prevStatus","statusText","prevStatusText","headers","body","prevBody","bodyEncoding","prevEncoding","encoding","composeResponse","LOG_LEVEL_OFF","LOG_LEVEL_DEBUG","LOG_LEVEL_INFO","LOG_LEVEL_WARN","LOG_LEVEL_ERROR","createLogger","logLevel","debug","info","warn","error","debugDisabled","infoDisabled","warnDisabled","errorDisabled","Error","createUnexpectedLogLevelMessage","console","Symbol","observable","for","createObservable","subscribe","next","complete","subscription","isObservable","undefined","createSSERoom","keepaliveDuration","retryDuration","historyLength","maxConnectionAllowed","logger","connections","Set","history","createEventHistory","previousEventId","state","interval","connect","lastKnownId","size","joinEvent","id","retry","data","Date","toLocaleTimeString","add","events","since","event","stringifySourceEvent","connection","write","unsubscribe","delete","sendEvent","keepAlive","start","setInterval","stop","clearInterval","reset","string","limit","removedCount","shift","index","parseInt","isNaN","TypeError","createCancellationToken","register","callback","unregister","throwIfRequested","cancellationRequested","memoizeOnce","compute","locked","lockValue","memoized","args","deleteCache","createOperation","cancellationToken","rest","unknownArgumentNames","promise","Promise","resolve","cancelPromise","reject","cancelRegistration","cancelError","then","operationPromise","race","createStoppableOperation","stopInternal","reason","firstOperationMatching","array","predicate","visit","input","returnValue","output","listen","server","port","ip","startListening","stopListening","on","address","close","findFreePort","initialPort","min","max","testUntil","free","portIsFree","nextPort","createServer","listenOperation","stopPromise","code","firstService","callbacks","serviceGeneratedResponsePredicate","jsenvAccessControlAllowedHeaders","jsenvAccessControlAllowedMethods","jsenvPrivateKey","jsenvPublicKey","jsenvCertificate","ressourceToSearchParamValue","ressource","searchParamName","search","ressourceToSearch","URLSearchParams","get","searchSeparatorIndex","EMPTY_ID","bufferToEtag","buffer","Buffer","isBuffer","hash","createHash","update","hashBase64String","digest","hashBase64StringSubset","toString","convertFileSystemErrorToResponseProperties","isErrorWithCode","jsenvContentTypeMap","extensions","filenameToContentType","filename","contentTypeMap","contentTypeDefault","extensionWithDot","extname","extension","availableContentTypes","contentTypeForExtension","find","contentTypeName","serveFile","path","method","canReadDirectory","cacheStrategy","startsWith","fileURLToPath","cacheWithMtime","cacheWithETag","cachedDisabled","stat","readFileStat","isDirectory","files","readDirectory","filesAsJSON","JSON","stringify","cachedModificationDate","e","actualModificationDate","dateToSecondsPrecision","mtime","Number","dateToUTCString","createReadStream","readFileAsBuffer","eTag","etag","date","toUTCString","dateWithSecondsPrecision","setMilliseconds","readFile","stats","readdir","nodeRequire","require","filenameContainsBackSlashes","__filename","url","replace","beforeExitCallbackArray","uninstall","addCallback","install","filter","beforeExitCallback","onBeforeExit","process","once","removeListener","beforeExitSignal","triggerDeath","deathSignal","collectExceptions","exitCallback","getExceptions","trackExceptions","exceptionArray","map","exception","origin","unhandledRejectionCallback","unhandledRejection","rejectionHandledCallback","uncaughtExceptionCallback","uncaughtException","exitSignal","triggerHangUpOrDeath","hangupOrDeathSignal","interruptSignal","eventRace","beforeExit","hangupOrDeath","death","exit","eventMap","unregisterMap","unregisterAll","name","teardownSignal","createArrayErrorMessage","createStartErrorMessage","createPredicateErrorMessage","recoverCallbackArray","recoverCallback","onUncaughtException","triggerUncaughtException","onUnhandledRejection","triggerUnhandledRejection","onRejectionHandled","recoverExceptionMatching","crash","isCrashing","crashReason","resolveRecovering","log","externalRecoverPromise","callbackRecoverPromise","recovered","recoverPromise","unadvisedCrashSignal","urlToOrigin","URL","trackConnections","nodeServer","connectionListener","destroy","trackClients","clients","clientListener","nodeRequest","nodeResponse","client","all","Array","from","headersSent","writeHead","finished","trackRequestHandlers","requestHandlers","handler","requestHandler","nodeStreamToObservable","nodeStream","nodeStreamIsNodeRequest","abort","normalizeHeaderName","headerName","String","test","toLowerCase","normalizeHeaderValue","headerValue","headersFromObject","headersObject","nodeRequestToRequest","freeze","valueToObservable","populateNodeResponse","ignoreBody","nodeHeaders","headersToNodeHeaders","end","setEncoding","bodyToObservable","emit","mapping","nodeHeaderName","isNodeStream","Stream","Writable","Readable","red","green","yellow","magenta","cyan","colorizeResponseStatus","statusType","statusToType","statusIsInformation","statusIsSuccess","statusIsRedirection","statusIsClientError","statusIsServerError","originAsString","protocol","hostname","createReason","reasonString","STOP_REASON_INTERNAL_ERROR","STOP_REASON_PROCESS_SIGINT","STOP_REASON_PROCESS_BEFORE_EXIT","STOP_REASON_PROCESS_HANGUP_OR_DEATH","STOP_REASON_PROCESS_DEATH","STOP_REASON_PROCESS_EXIT","STOP_REASON_NOT_SPECIFIED","killPort","_require","STATUS_TEXT_INTERNAL_ERROR","startServer","forcePort","privateKey","certificate","stopOnSIGINT","stopOnExit","stopOnInternalError","stopOnCrash","keepProcessAlive","requestToResponse","accessControlAllowedOrigins","accessControlAllowedMethods","accessControlAllowedHeaders","accessControlAllowRequestOrigin","accessControlAllowRequestMethod","accessControlAllowRequestHeaders","accessControlAllowCredentials","accessControlMaxAge","sendInternalErrorStack","internalErrorToResponseProperties","stack","byteLength","startedCallback","stoppedCallback","platform","agent","getNodeServerAndAgent","unref","registerCleanupCallback","cleanup","createTracker","connectionTracker","clientTracker","responseStatus","requestHandlerTracker","stoppedResolve","stoppedPromise","startOperation","_","statusCode","statusMessage","tearDownReason","request","response","generateResponseDescription","createContentLengthMismatchError","corsEnabled","responsePropertiesToResponse","statusToStatusText","accessControlHeaders","generateAccessControlHeaders","responseProperties","getStatus","callbackArray","localCallbackArray","STATUS_CODES","createNodeServer","global","Agent","createNodeSecureServer","cert","SecureAgent","rejectUnauthorized","message","allowedOriginArray","referer","allowedMethodArray","requestMethodName","allowedHeaderArray","requestHeaderNameArray","headerNameLowerCase"],"mappings":"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"}